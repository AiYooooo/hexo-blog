{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"themes/anisina/source/css/blog-style.css","path":"css/blog-style.css","modified":0,"renderable":1},{"_id":"themes/anisina/source/fonts/glyphicons-halflings-regular.eot","path":"fonts/glyphicons-halflings-regular.eot","modified":0,"renderable":1},{"_id":"themes/anisina/source/css/syntax.styl","path":"css/syntax.styl","modified":0,"renderable":1},{"_id":"themes/anisina/source/fonts/glyphicons-halflings-regular.woff","path":"fonts/glyphicons-halflings-regular.woff","modified":0,"renderable":1},{"_id":"themes/anisina/source/fonts/glyphicons-halflings-regular.ttf","path":"fonts/glyphicons-halflings-regular.ttf","modified":0,"renderable":1},{"_id":"themes/anisina/source/fonts/glyphicons-halflings-regular.woff2","path":"fonts/glyphicons-halflings-regular.woff2","modified":0,"renderable":1},{"_id":"themes/anisina/source/js/blog.js","path":"js/blog.js","modified":0,"renderable":1},{"_id":"themes/anisina/source/js/bootstrap.min.js","path":"js/bootstrap.min.js","modified":0,"renderable":1},{"_id":"themes/anisina/source/js/jquery.tagcloud.js","path":"js/jquery.tagcloud.js","modified":0,"renderable":1},{"_id":"themes/anisina/source/js/totop.js","path":"js/totop.js","modified":0,"renderable":1},{"_id":"themes/anisina/source/css/bootstrap.min.css","path":"css/bootstrap.min.css","modified":0,"renderable":1},{"_id":"themes/anisina/source/fonts/glyphicons-halflings-regular.svg","path":"fonts/glyphicons-halflings-regular.svg","modified":0,"renderable":1},{"_id":"themes/anisina/source/js/jquery.min.js","path":"js/jquery.min.js","modified":0,"renderable":1},{"_id":"themes/anisina/source/js/jquery.js","path":"js/jquery.js","modified":0,"renderable":1}],"Cache":[{"_id":"source/.DS_Store","hash":"b1d5e090ae1a4a5fac525c1398f2b7e0425eb9b5","modified":1516950808507},{"_id":"themes/anisina/LICENSE","hash":"2b209f06bebeb2a8c2b7e187e436f3e1e1fbc8a7","modified":1499966658000},{"_id":"themes/anisina/.DS_Store","hash":"18cbf78dfd705e831d9818e021dca1b62594072c","modified":1513596570583},{"_id":"themes/anisina/README.md","hash":"ebde4101f083169abf82f5d9aa6fa34959d5cf11","modified":1499966658000},{"_id":"themes/anisina/_config.yml","hash":"06bccfc42b143659f59ea78938f00c217ac5574d","modified":1499966658000},{"_id":"themes/anisina/package.json","hash":"12541fbf56f785e4f5d486a55b4939f3033f625b","modified":1499966658000},{"_id":"source/_posts/LeetCode_3.md","hash":"8921fb2905f969288d7a4c700adc03fd38e79013","modified":1515932463828},{"_id":"source/_posts/LeetCode_214.md","hash":"3b0e3a291ab7daaa18dbe3cc96c162b541b93a50","modified":1515932458360},{"_id":"source/_posts/.DS_Store","hash":"cd37e4d60c6387e2b26e180b6351e923990987e9","modified":1517126894384},{"_id":"source/_posts/koa1.md","hash":"6d04584cff2f7a26362bd228c9f4e5f2c1b1f076","modified":1516176650321},{"_id":"source/_posts/node_mongoose_1.md","hash":"5eaea86ea44c9fd92bf1fd101a96541db0959631","modified":1515932468849},{"_id":"themes/anisina/Screenshots/mobile-index.jpeg","hash":"cd75f77f5d865d42182e2233e354eeba9f114d98","modified":1499966658000},{"_id":"themes/anisina/layout/.DS_Store","hash":"f60423538e7d115abf8c86b365e85ad35b418b25","modified":1499966658000},{"_id":"themes/anisina/layout/404.ejs","hash":"1fe05722bd1b32bbe0ae4e3e880866f935e0ae11","modified":1499966658000},{"_id":"themes/anisina/layout/archive.ejs","hash":"9233a4713382432b315f337adbf1db2b63082971","modified":1499966658000},{"_id":"themes/anisina/layout/index.ejs","hash":"a94ac678f6b24a46824d45ec058b0ab2105a92c9","modified":1499966658000},{"_id":"themes/anisina/layout/about.ejs","hash":"d409109a84aa5c032e1a230c973a91b293765176","modified":1499966658000},{"_id":"themes/anisina/layout/layout.ejs","hash":"b728827bf3ec55baf96a882032397e6c74c65f34","modified":1499966658000},{"_id":"themes/anisina/layout/poetry.ejs","hash":"6c955d419050825e13d39c780d45aceafbf6552d","modified":1499966658000},{"_id":"themes/anisina/layout/post.ejs","hash":"9427ac91b2bc36c339b528d9a569c038f0b18efa","modified":1499966658000},{"_id":"themes/anisina/layout/works.ejs","hash":"1df954e54098cc4845295836374abed870789dcd","modified":1499966658000},{"_id":"themes/anisina/layout/page.ejs","hash":"95bbc74aa6d10cddddd7a5cd5d2a06482f5ea173","modified":1499966658000},{"_id":"themes/anisina/.idea/modules.xml","hash":"6f81355dee5b607683bdbd56595a930fb4b83c8b","modified":1499966658000},{"_id":"themes/anisina/.idea/Anisina.iml","hash":"4240dabdc746a36bae8a56eeec04a3a3fc59d842","modified":1499966658000},{"_id":"themes/anisina/.idea/vcs.xml","hash":"c92f3eb0ad1c70371e177a4d7d741f90af3f902c","modified":1499966658000},{"_id":"themes/anisina/layout/tags.ejs","hash":"ff363455eeddfd389ecf6c5ab090408e1d2ef4e6","modified":1499966658000},{"_id":"themes/anisina/languages_to_be_added/de.yml","hash":"424a9c1e6ab69334d7873f6574da02ca960aa572","modified":1499966658000},{"_id":"themes/anisina/.idea/workspace.xml","hash":"7c5d920658041056cc34836371895677b507001c","modified":1499966658000},{"_id":"themes/anisina/languages_to_be_added/default.yml","hash":"97326c9e6518d9f379778178b3b8f9a58434725d","modified":1499966658000},{"_id":"themes/anisina/languages_to_be_added/en.yml","hash":"97326c9e6518d9f379778178b3b8f9a58434725d","modified":1499966658000},{"_id":"themes/anisina/languages_to_be_added/es.yml","hash":"cb4eeca0ed3768a77e0cd216300f2b2549628b1b","modified":1499966658000},{"_id":"themes/anisina/languages_to_be_added/no.yml","hash":"8ca475a3b4f8efe6603030f0013aae39668230e1","modified":1499966658000},{"_id":"themes/anisina/languages_to_be_added/zh-TW.yml","hash":"9acac6cc4f8002c3fa53ff69fb8cf66c915bd016","modified":1499966658000},{"_id":"themes/anisina/languages_to_be_added/pl.yml","hash":"de7eb5850ae65ba7638e907c805fea90617a988c","modified":1499966658000},{"_id":"themes/anisina/languages_to_be_added/ru.yml","hash":"42df7afeb7a35dc46d272b7f4fb880a9d9ebcaa5","modified":1499966658000},{"_id":"themes/anisina/languages_to_be_added/zh-CN.yml","hash":"7bfcb0b8e97d7e5edcfca8ab26d55d9da2573c1c","modified":1499966658000},{"_id":"themes/anisina/source/.DS_Store","hash":"9ae5a2856d796fdb7b1849de5e23eb222df306e5","modified":1513596575587},{"_id":"themes/anisina/source/timg.jpeg","hash":"f2e04009c1e31b2ef4a6aa65ef5f81ca75ea0ea3","modified":1513596538995},{"_id":"source/Tags/index.md","hash":"1217b3da44d6a04111cde1c16e041b0c4f9ab985","modified":1513759639959},{"_id":"themes/anisina/Screenshots/Anisina.png","hash":"146dd991f55a827a514259e20a51de1e9b07a13d","modified":1499966658000},{"_id":"themes/anisina/layout/_partial/nav.ejs","hash":"3baa41d595e951efa1db34dd1789c6f8d3b094da","modified":1499966658000},{"_id":"themes/anisina/layout/_partial/head.ejs","hash":"4e0d96cac503d4e3a5b254d8b8175c392971ce38","modified":1499966658000},{"_id":"themes/anisina/layout/_partial/pagination.ejs","hash":"557d6bb069a1d48af49ae912994653f44b32a570","modified":1499966658000},{"_id":"themes/anisina/layout/_partial/footer.ejs","hash":"173de3c8462ae660aa815f001b86d1e58f8cb5da","modified":1513586316990},{"_id":"themes/anisina/.idea/inspectionProfiles/Project_Default.xml","hash":"cb98213afbdfab7620cd4b6ba8801035079b4ae5","modified":1499966658000},{"_id":"themes/anisina/source/css/blog-style.css","hash":"c6830e31138e412c2aa05228c4cd6035063fe651","modified":1499966658000},{"_id":"themes/anisina/source/fonts/glyphicons-halflings-regular.eot","hash":"86b6f62b7853e67d3e635f6512a5a5efc58ea3c3","modified":1499966658000},{"_id":"themes/anisina/source/css/syntax.styl","hash":"f3f9ff0d1ebc4f7fa18d7e367b2ba2f0899adbd4","modified":1499966658000},{"_id":"themes/anisina/source/fonts/glyphicons-halflings-regular.woff","hash":"278e49a86e634da6f2a02f3b47dd9d2a8f26210f","modified":1499966658000},{"_id":"themes/anisina/source/fonts/glyphicons-halflings-regular.ttf","hash":"44bc1850f570972267b169ae18f1cb06b611ffa2","modified":1499966658000},{"_id":"themes/anisina/source/fonts/glyphicons-halflings-regular.woff2","hash":"ca35b697d99cae4d1b60f2d60fcd37771987eb07","modified":1499966658000},{"_id":"themes/anisina/source/js/blog.js","hash":"0f805c744ef8a48c0abdd9d204cfc19ee6cafc14","modified":1499966658000},{"_id":"themes/anisina/source/js/bootstrap.min.js","hash":"b3f2ef9f985e7906c9360756b73cd64bf7733647","modified":1499966658000},{"_id":"themes/anisina/source/js/jquery.tagcloud.js","hash":"4e5fd0b07f3bd935f2e603710447e039e3677211","modified":1499966658000},{"_id":"themes/anisina/source/js/totop.js","hash":"11ede60fccb7c763d6973f80efc78b47c0843746","modified":1499966658000},{"_id":"themes/anisina/Screenshots/poetry-show.png","hash":"f5fdcd25026a87a0aafeebb1f19cdb3c0a81a666","modified":1499966658000},{"_id":"themes/anisina/source/css/bootstrap.min.css","hash":"c5db932e115ff97af7b4512b947cde3ba2964db8","modified":1499966658000},{"_id":"themes/anisina/source/fonts/glyphicons-halflings-regular.svg","hash":"de51a8494180a6db074af2dee2383f0a363c5b08","modified":1499966658000},{"_id":"themes/anisina/source/js/jquery.min.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1499966658000},{"_id":"themes/anisina/Screenshots/mobile-post.jpeg","hash":"2081cdff23a9a8c185a48d9aabcc9dc8e77833ec","modified":1499966658000},{"_id":"themes/anisina/source/js/jquery.js","hash":"1852661bd11a09ca9b9cb63d1aa6ff390fffaf4e","modified":1499966658000},{"_id":"themes/anisina/Screenshots/pc-index.png","hash":"b04094dac75cb656b4244c1dfaf246168a0f8926","modified":1499966658000},{"_id":"themes/anisina/Screenshots/pc-post.png","hash":"cde56c0797b6ff8dd555fb1f8c3f9b21bceaa3be","modified":1499966658000},{"_id":"public/Tags/index.html","hash":"e704bc3568f3e45738b6e7816d15ce9163d17dd7","modified":1517129934705},{"_id":"public/archives/index.html","hash":"c8d91742d18d41bdae96210a677cf9514addda31","modified":1517129934714},{"_id":"public/archives/2018/index.html","hash":"e0056f4078d07f717c26410e545b4ea43c84c287","modified":1517129934716},{"_id":"public/tags/LeetCode/index.html","hash":"c4d23be88893f5ceef85ca63a2aa1d2748c51cd0","modified":1517129934725},{"_id":"public/tags/Node-js/index.html","hash":"7847074171529e6666812a028c479787f97afd29","modified":1517129934723},{"_id":"public/tags/MongoDB/index.html","hash":"fbe4f570fd1e906cb3abf58daf976766e88090bd","modified":1517129934725},{"_id":"public/index.html","hash":"249f66ea29d7f86f86c3a1f3e90b5ab923326dee","modified":1517129934716},{"_id":"public/archives/2017/index.html","hash":"2a3cfa547aba0805e2ccee35d9bda67b8aed5b0f","modified":1517129934715},{"_id":"public/archives/2017/12/index.html","hash":"d8a0d8d52c1aa4cbd3e276a25e13fcd01fe0bc1b","modified":1517129934716},{"_id":"public/tags/Koa/index.html","hash":"ef9e67aaa3868dcf1e7f240d80a065a37c48b2d4","modified":1517129934725},{"_id":"public/2017/12/26/LeetCode_214/index.html","hash":"c092bef25846435dbf2d9edb82e4952a4638e4c9","modified":1516935295161},{"_id":"public/2017/12/24/node_mongoose_1/index.html","hash":"ae4b825f91d54c3f9355449a68cf141e541478ce","modified":1516935295161},{"_id":"public/2017/12/20/LeetCode_3/index.html","hash":"a5444fe4c139466e6606814c8410a772d96380ac","modified":1516935295161},{"_id":"public/archives/2018/01/index.html","hash":"e37851e9d7e7dd7e7ac22ab954fce8056c3c500c","modified":1517129934716},{"_id":"public/2018/01/01/koa1/index.html","hash":"7bc99ff4c400de59ac374850e6ae1d370e414c37","modified":1516956538824},{"_id":"public/fonts/glyphicons-halflings-regular.eot","hash":"86b6f62b7853e67d3e635f6512a5a5efc58ea3c3","modified":1516935295164},{"_id":"public/fonts/glyphicons-halflings-regular.woff","hash":"278e49a86e634da6f2a02f3b47dd9d2a8f26210f","modified":1516935295164},{"_id":"public/fonts/glyphicons-halflings-regular.ttf","hash":"44bc1850f570972267b169ae18f1cb06b611ffa2","modified":1516935295164},{"_id":"public/fonts/glyphicons-halflings-regular.woff2","hash":"ca35b697d99cae4d1b60f2d60fcd37771987eb07","modified":1516935295164},{"_id":"public/timg.jpeg","hash":"f2e04009c1e31b2ef4a6aa65ef5f81ca75ea0ea3","modified":1516935295164},{"_id":"public/fonts/glyphicons-halflings-regular.svg","hash":"de51a8494180a6db074af2dee2383f0a363c5b08","modified":1516935295292},{"_id":"public/css/syntax.css","hash":"4616879fec214c9cc4f5835615348f0bbeabf2a9","modified":1516935295296},{"_id":"public/js/blog.js","hash":"0f805c744ef8a48c0abdd9d204cfc19ee6cafc14","modified":1516935295297},{"_id":"public/js/jquery.tagcloud.js","hash":"4e5fd0b07f3bd935f2e603710447e039e3677211","modified":1516935295297},{"_id":"public/js/totop.js","hash":"11ede60fccb7c763d6973f80efc78b47c0843746","modified":1516935295297},{"_id":"public/css/blog-style.css","hash":"c6830e31138e412c2aa05228c4cd6035063fe651","modified":1516935295297},{"_id":"public/js/bootstrap.min.js","hash":"b3f2ef9f985e7906c9360756b73cd64bf7733647","modified":1516935295297},{"_id":"public/js/jquery.min.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1516935295297},{"_id":"public/css/bootstrap.min.css","hash":"c5db932e115ff97af7b4512b947cde3ba2964db8","modified":1516935295297},{"_id":"public/js/jquery.js","hash":"1852661bd11a09ca9b9cb63d1aa6ff390fffaf4e","modified":1516935295297},{"_id":"source/_posts/san1.md","hash":"358cda78ce7d304b1b77642a071cf7417f2e4cfa","modified":1517125779007},{"_id":"public/tags/San/index.html","hash":"877f99a19787c9e3717e18787b2b3360ea1d9616","modified":1517129934725},{"_id":"public/2018/01/05/san1/index.html","hash":"dbb7ca127946d5377cd22a17fbc97336fb3e8e27","modified":1517129934716},{"_id":"source/_posts/san2.md","hash":"b663a316cb3db4a666f0fc2c75ca995503c2a859","modified":1517129827472},{"_id":"public/2018/01/06/san2/index.html","hash":"fe87208a10a755d3d5da1002ed53c6d90ab446ec","modified":1517129934726}],"Category":[],"Data":[],"Page":[{"title":"Tags","header-img":"tags.jpeg","layout":"tags","_content":"","source":"Tags/index.md","raw":"---\ntitle: Tags\nheader-img: \"tags.jpeg\"\nlayout: tags\n---\n","date":"2017-12-20T08:47:19.959Z","updated":"2017-12-20T08:47:19.959Z","path":"Tags/index.html","comments":1,"_id":"cjciskget000gn3faj2v0rnxs","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"layout":"post","title":"LeetCode刷题系列(1)(question 3)","subtitle":"Longest Substring Without Repeating Characters","date":"2017-12-19T16:00:00.000Z","author":"Ai Shuangying","header-img":"hack.jpeg","cdn":"header-on","_content":"\n<!-- LeetCode刷题系列(1)(question 3)\n=================== -->\n\n\n这个系列将记载我在[LeetCode](https://leetcode.com)上遇见的有意思、有难度或者有其他精彩答案的题目。\n所用语言为JavaScript。\n\n----------\n\n\n### 题目号码：3（medium）\n-------------\n\n\n> **Longest Substring Without Repeating Characters:**\n> Given a string, find the length of the longest substring without repeating characters.\n> \n> **Examples:**\n> - Given \"abcabcbb\", the answer is \"abc\", which the length is 3.\n> - Given \"bbbbb\", the answer is \"b\", with the length of 1.\n> - Given \"pwwkew\", the answer is \"wke\", with the length of 3.\n\n#### 题意\n返回给出字符串中最长且不含重复字母的子字符串的长度\n\n-------------\n\n#### 思路\n从字符串开头开始分析，依次找到最长的不重复字母的子字符串存储下来，遍历结束后输出其长度。\n\n#### 我的解法\n```\n/**\n * @param {string} s\n * @return {number}\n */\nvar lengthOfLongestSubstring = function(s) {\n    var result = '';\n    var data = '';\n    for(let i=0; i<s.length; i++){\n        if(data.indexOf(s.substr(i,1)) == -1){\n            data += s.substr(i,1);\n        }else{\n            if(data.length > result.length){\n                result = data;\n            }\n            data = data.substr(data.indexOf(s.substr(i,1))+1);\n            data += s.substr(i,1);\n        }\n    }\n    if(data.length > result.length){\n        result = data;\n    }\n    return result.length;\n};\n```\n\n-------------\n\n#### 分析解法\n```\n/**\n * @param {string} s\n * @return {number}\n */\nvar lengthOfLongestSubstring = function(s) {\n    let map = Array(256).fill(-1) ,cur = 0, len = 0;\n    for(let i=0;i<s.length;i++){\n        let at = s[i].charCodeAt();\n        let map_at = map[at];\n        if(map_at !== -1){cur = map_at>cur?map_at:cur;}\n        let tm_len = i-cur+1;\n        len = len>tm_len?len:tm_len;\n        map[at] = i+1;\n    }\n    return len;\n};\n```\n##### 分析如下：\n\n\t1. 变量设置\n\t\t* map：一个256长度的数组，为字母对应的Unicode编码长度，存放每个字母出现的次数\n\t\t* cur：一个遍历中的变量，存储上一个相同字母点的位置\n\t\t* len：存储每次遍历中的最长字符串长度\n\t\t* tm_len：记录实时不重复子字符串的长度\n\t2. 开始遍历给定字符串的每个字符，首先根据这个字母的Unicode编码找到这个字母在map中对应的位置的值，\n    如果这个值不为-1，说明这个字母不是第一次出现，去查找此字母的map位上的数值，\n    对应最近一次出现此字母的位置，做减法，得到此时的不重复子字符串的长度，与历史最高长度len取最大值，直至遍历结束。\n\t3. 既然不需要返回此字符串，那么就应该将逻辑聚焦在长度上，通过数组合理存储最近一次的同字母位置来完成统计。","source":"_posts/LeetCode_3.md","raw":"---\nlayout: post\ntitle: \"LeetCode刷题系列(1)(question 3)\"\nsubtitle: \"Longest Substring Without Repeating Characters\"\ndate: 2017-12-20\nauthor: \"Ai Shuangying\"\nheader-img: \"hack.jpeg\"\ncdn: 'header-on'\ntags:\n\t- LeetCode\n---\n\n<!-- LeetCode刷题系列(1)(question 3)\n=================== -->\n\n\n这个系列将记载我在[LeetCode](https://leetcode.com)上遇见的有意思、有难度或者有其他精彩答案的题目。\n所用语言为JavaScript。\n\n----------\n\n\n### 题目号码：3（medium）\n-------------\n\n\n> **Longest Substring Without Repeating Characters:**\n> Given a string, find the length of the longest substring without repeating characters.\n> \n> **Examples:**\n> - Given \"abcabcbb\", the answer is \"abc\", which the length is 3.\n> - Given \"bbbbb\", the answer is \"b\", with the length of 1.\n> - Given \"pwwkew\", the answer is \"wke\", with the length of 3.\n\n#### 题意\n返回给出字符串中最长且不含重复字母的子字符串的长度\n\n-------------\n\n#### 思路\n从字符串开头开始分析，依次找到最长的不重复字母的子字符串存储下来，遍历结束后输出其长度。\n\n#### 我的解法\n```\n/**\n * @param {string} s\n * @return {number}\n */\nvar lengthOfLongestSubstring = function(s) {\n    var result = '';\n    var data = '';\n    for(let i=0; i<s.length; i++){\n        if(data.indexOf(s.substr(i,1)) == -1){\n            data += s.substr(i,1);\n        }else{\n            if(data.length > result.length){\n                result = data;\n            }\n            data = data.substr(data.indexOf(s.substr(i,1))+1);\n            data += s.substr(i,1);\n        }\n    }\n    if(data.length > result.length){\n        result = data;\n    }\n    return result.length;\n};\n```\n\n-------------\n\n#### 分析解法\n```\n/**\n * @param {string} s\n * @return {number}\n */\nvar lengthOfLongestSubstring = function(s) {\n    let map = Array(256).fill(-1) ,cur = 0, len = 0;\n    for(let i=0;i<s.length;i++){\n        let at = s[i].charCodeAt();\n        let map_at = map[at];\n        if(map_at !== -1){cur = map_at>cur?map_at:cur;}\n        let tm_len = i-cur+1;\n        len = len>tm_len?len:tm_len;\n        map[at] = i+1;\n    }\n    return len;\n};\n```\n##### 分析如下：\n\n\t1. 变量设置\n\t\t* map：一个256长度的数组，为字母对应的Unicode编码长度，存放每个字母出现的次数\n\t\t* cur：一个遍历中的变量，存储上一个相同字母点的位置\n\t\t* len：存储每次遍历中的最长字符串长度\n\t\t* tm_len：记录实时不重复子字符串的长度\n\t2. 开始遍历给定字符串的每个字符，首先根据这个字母的Unicode编码找到这个字母在map中对应的位置的值，\n    如果这个值不为-1，说明这个字母不是第一次出现，去查找此字母的map位上的数值，\n    对应最近一次出现此字母的位置，做减法，得到此时的不重复子字符串的长度，与历史最高长度len取最大值，直至遍历结束。\n\t3. 既然不需要返回此字符串，那么就应该将逻辑聚焦在长度上，通过数组合理存储最近一次的同字母位置来完成统计。","slug":"LeetCode_3","published":1,"updated":"2018-01-14T12:21:03.828Z","comments":1,"photos":[],"link":"","_id":"cjciskgdf0000n3fae346roxm","content":"<!-- LeetCode刷题系列(1)(question 3)\n=================== -->\n<p>这个系列将记载我在<a href=\"https://leetcode.com\" target=\"_blank\" rel=\"noopener\">LeetCode</a>上遇见的有意思、有难度或者有其他精彩答案的题目。<br>所用语言为JavaScript。</p>\n<hr>\n<h3 id=\"题目号码：3（medium）\"><a href=\"#题目号码：3（medium）\" class=\"headerlink\" title=\"题目号码：3（medium）\"></a>题目号码：3（medium）</h3><hr>\n<blockquote>\n<p><strong>Longest Substring Without Repeating Characters:</strong><br>Given a string, find the length of the longest substring without repeating characters.</p>\n<p><strong>Examples:</strong></p>\n<ul>\n<li>Given “abcabcbb”, the answer is “abc”, which the length is 3.</li>\n<li>Given “bbbbb”, the answer is “b”, with the length of 1.</li>\n<li>Given “pwwkew”, the answer is “wke”, with the length of 3.</li>\n</ul>\n</blockquote>\n<h4 id=\"题意\"><a href=\"#题意\" class=\"headerlink\" title=\"题意\"></a>题意</h4><p>返回给出字符串中最长且不含重复字母的子字符串的长度</p>\n<hr>\n<h4 id=\"思路\"><a href=\"#思路\" class=\"headerlink\" title=\"思路\"></a>思路</h4><p>从字符串开头开始分析，依次找到最长的不重复字母的子字符串存储下来，遍历结束后输出其长度。</p>\n<h4 id=\"我的解法\"><a href=\"#我的解法\" class=\"headerlink\" title=\"我的解法\"></a>我的解法</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/**</span><br><span class=\"line\"> * @param &#123;string&#125; s</span><br><span class=\"line\"> * @return &#123;number&#125;</span><br><span class=\"line\"> */</span><br><span class=\"line\">var lengthOfLongestSubstring = function(s) &#123;</span><br><span class=\"line\">    var result = &apos;&apos;;</span><br><span class=\"line\">    var data = &apos;&apos;;</span><br><span class=\"line\">    for(let i=0; i&lt;s.length; i++)&#123;</span><br><span class=\"line\">        if(data.indexOf(s.substr(i,1)) == -1)&#123;</span><br><span class=\"line\">            data += s.substr(i,1);</span><br><span class=\"line\">        &#125;else&#123;</span><br><span class=\"line\">            if(data.length &gt; result.length)&#123;</span><br><span class=\"line\">                result = data;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            data = data.substr(data.indexOf(s.substr(i,1))+1);</span><br><span class=\"line\">            data += s.substr(i,1);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    if(data.length &gt; result.length)&#123;</span><br><span class=\"line\">        result = data;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return result.length;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<hr>\n<h4 id=\"分析解法\"><a href=\"#分析解法\" class=\"headerlink\" title=\"分析解法\"></a>分析解法</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/**</span><br><span class=\"line\"> * @param &#123;string&#125; s</span><br><span class=\"line\"> * @return &#123;number&#125;</span><br><span class=\"line\"> */</span><br><span class=\"line\">var lengthOfLongestSubstring = function(s) &#123;</span><br><span class=\"line\">    let map = Array(256).fill(-1) ,cur = 0, len = 0;</span><br><span class=\"line\">    for(let i=0;i&lt;s.length;i++)&#123;</span><br><span class=\"line\">        let at = s[i].charCodeAt();</span><br><span class=\"line\">        let map_at = map[at];</span><br><span class=\"line\">        if(map_at !== -1)&#123;cur = map_at&gt;cur?map_at:cur;&#125;</span><br><span class=\"line\">        let tm_len = i-cur+1;</span><br><span class=\"line\">        len = len&gt;tm_len?len:tm_len;</span><br><span class=\"line\">        map[at] = i+1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return len;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h5 id=\"分析如下：\"><a href=\"#分析如下：\" class=\"headerlink\" title=\"分析如下：\"></a>分析如下：</h5><pre><code>1. 变量设置\n    * map：一个256长度的数组，为字母对应的Unicode编码长度，存放每个字母出现的次数\n    * cur：一个遍历中的变量，存储上一个相同字母点的位置\n    * len：存储每次遍历中的最长字符串长度\n    * tm_len：记录实时不重复子字符串的长度\n2. 开始遍历给定字符串的每个字符，首先根据这个字母的Unicode编码找到这个字母在map中对应的位置的值，\n如果这个值不为-1，说明这个字母不是第一次出现，去查找此字母的map位上的数值，\n对应最近一次出现此字母的位置，做减法，得到此时的不重复子字符串的长度，与历史最高长度len取最大值，直至遍历结束。\n3. 既然不需要返回此字符串，那么就应该将逻辑聚焦在长度上，通过数组合理存储最近一次的同字母位置来完成统计。\n</code></pre>","site":{"data":{}},"excerpt":"","more":"<!-- LeetCode刷题系列(1)(question 3)\n=================== -->\n<p>这个系列将记载我在<a href=\"https://leetcode.com\" target=\"_blank\" rel=\"noopener\">LeetCode</a>上遇见的有意思、有难度或者有其他精彩答案的题目。<br>所用语言为JavaScript。</p>\n<hr>\n<h3 id=\"题目号码：3（medium）\"><a href=\"#题目号码：3（medium）\" class=\"headerlink\" title=\"题目号码：3（medium）\"></a>题目号码：3（medium）</h3><hr>\n<blockquote>\n<p><strong>Longest Substring Without Repeating Characters:</strong><br>Given a string, find the length of the longest substring without repeating characters.</p>\n<p><strong>Examples:</strong></p>\n<ul>\n<li>Given “abcabcbb”, the answer is “abc”, which the length is 3.</li>\n<li>Given “bbbbb”, the answer is “b”, with the length of 1.</li>\n<li>Given “pwwkew”, the answer is “wke”, with the length of 3.</li>\n</ul>\n</blockquote>\n<h4 id=\"题意\"><a href=\"#题意\" class=\"headerlink\" title=\"题意\"></a>题意</h4><p>返回给出字符串中最长且不含重复字母的子字符串的长度</p>\n<hr>\n<h4 id=\"思路\"><a href=\"#思路\" class=\"headerlink\" title=\"思路\"></a>思路</h4><p>从字符串开头开始分析，依次找到最长的不重复字母的子字符串存储下来，遍历结束后输出其长度。</p>\n<h4 id=\"我的解法\"><a href=\"#我的解法\" class=\"headerlink\" title=\"我的解法\"></a>我的解法</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/**</span><br><span class=\"line\"> * @param &#123;string&#125; s</span><br><span class=\"line\"> * @return &#123;number&#125;</span><br><span class=\"line\"> */</span><br><span class=\"line\">var lengthOfLongestSubstring = function(s) &#123;</span><br><span class=\"line\">    var result = &apos;&apos;;</span><br><span class=\"line\">    var data = &apos;&apos;;</span><br><span class=\"line\">    for(let i=0; i&lt;s.length; i++)&#123;</span><br><span class=\"line\">        if(data.indexOf(s.substr(i,1)) == -1)&#123;</span><br><span class=\"line\">            data += s.substr(i,1);</span><br><span class=\"line\">        &#125;else&#123;</span><br><span class=\"line\">            if(data.length &gt; result.length)&#123;</span><br><span class=\"line\">                result = data;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            data = data.substr(data.indexOf(s.substr(i,1))+1);</span><br><span class=\"line\">            data += s.substr(i,1);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    if(data.length &gt; result.length)&#123;</span><br><span class=\"line\">        result = data;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return result.length;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<hr>\n<h4 id=\"分析解法\"><a href=\"#分析解法\" class=\"headerlink\" title=\"分析解法\"></a>分析解法</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/**</span><br><span class=\"line\"> * @param &#123;string&#125; s</span><br><span class=\"line\"> * @return &#123;number&#125;</span><br><span class=\"line\"> */</span><br><span class=\"line\">var lengthOfLongestSubstring = function(s) &#123;</span><br><span class=\"line\">    let map = Array(256).fill(-1) ,cur = 0, len = 0;</span><br><span class=\"line\">    for(let i=0;i&lt;s.length;i++)&#123;</span><br><span class=\"line\">        let at = s[i].charCodeAt();</span><br><span class=\"line\">        let map_at = map[at];</span><br><span class=\"line\">        if(map_at !== -1)&#123;cur = map_at&gt;cur?map_at:cur;&#125;</span><br><span class=\"line\">        let tm_len = i-cur+1;</span><br><span class=\"line\">        len = len&gt;tm_len?len:tm_len;</span><br><span class=\"line\">        map[at] = i+1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return len;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h5 id=\"分析如下：\"><a href=\"#分析如下：\" class=\"headerlink\" title=\"分析如下：\"></a>分析如下：</h5><pre><code>1. 变量设置\n    * map：一个256长度的数组，为字母对应的Unicode编码长度，存放每个字母出现的次数\n    * cur：一个遍历中的变量，存储上一个相同字母点的位置\n    * len：存储每次遍历中的最长字符串长度\n    * tm_len：记录实时不重复子字符串的长度\n2. 开始遍历给定字符串的每个字符，首先根据这个字母的Unicode编码找到这个字母在map中对应的位置的值，\n如果这个值不为-1，说明这个字母不是第一次出现，去查找此字母的map位上的数值，\n对应最近一次出现此字母的位置，做减法，得到此时的不重复子字符串的长度，与历史最高长度len取最大值，直至遍历结束。\n3. 既然不需要返回此字符串，那么就应该将逻辑聚焦在长度上，通过数组合理存储最近一次的同字母位置来完成统计。\n</code></pre>"},{"layout":"post","title":"LeetCode刷题系列(2)(question 214)","subtitle":"Shortest Palindrome","date":"2017-12-25T16:00:00.000Z","author":"Ai Shuangying","header-img":"hack.jpeg","cdn":"header-on","_content":"\n<!-- LeetCode刷题系列(1)(question 3)\n=================== -->\n\n\n这个系列将记载我在[LeetCode](https://leetcode.com)上遇见的有意思、有难度或者有其他精彩答案的题目。\n所用语言为JavaScript。\n\n----------\n\n\n### 题目号码：214（hard）\n-------------\n\n\n> **Shortest Palindrome:**\n> Given a string S, you are allowed to convert it to a palindrome by adding characters in front of it. \n> Find and return the shortest palindrome you can find by performing this transformation.\n> \n> **Examples:**\n> - Given \"aacecaaa\", return \"aaacecaaa\".\n> - Given \"abcd\", return \"dcbabcd\".\n\n#### 题意\n给定一个字符串S，可以通过在它前面添加字符将其转换为回文。通过执行这个转换，找到并返回最短的回文。\n\n-------------\n\n#### 思路\n从字符串结尾开始遍历，与字符串开头对应位置的字母进行比较，如果不一致则插入一个相同的字母来形成回文\n\n#### 我的解法\n```\n/**\n * @param {string} s\n * @return {number}\n */\nvar lengthOfLongestSubstring = function(s) {\n    for(var i=s.length-1; i>=0; i--){\n        if(s[i] !== s[s.length-1-i]){\n            var s1 = s.substr(0,s.length-1-i);\n            var s2 = s.substring(s.length-1-i);\n            var ss = s[i];\n            s = ''+s1+ss+s2;\n            i++;\n        }\n    }\n    return s;\n};\n```\n##### 分析如下：\n\n但是这种解法却没有通过测试，具体情况是：\n    - 给出字符串 \"aabba\"\n    - 我的输出结果为 \"abbabba\"\n    - 期望输出结果为 \"abbaabba\"\n\n乍一看仿佛是我的结果更准确，但是回过头仔细审题会发现题目中要求的是“在它前面添加字符”来形成回文，即我的解法思路是错的。\n-------------\n\n#### 思路\n既然只能在给定字符串开头插入，那么就是说我需要找到给出字符串中自开头最大的回文子串，然后把剩下的字符串颠倒顺序插入即可。\n\n#### 我的解法\n```\n/**\n * @param {string} s\n * @return {number}\n */\nvar findMaxIndex = function(s){\n    for(var i=s.length-1; i>=0; i--){\n        if(s[i] != s[s.length-1-i]){\n            return false;\n        }else{\n            continue;\n        }\n    }\n    return true;\n}\nvar shortestPalindrome = function(s) {\n    var index;\n    if(s.length == 1){ return s; }\n    for(var i=s.length; i>0; i--){\n        var s0 = s.substring(0,i);\n        if(!findMaxIndex(s0)){\n            continue;\n        }else{\n            index = i;\n            break;\n        }\n    }\n    var s1 = s.substr(0,index);\n    var s2 = s.substring(index);\n    var ss = s2.split(\"\").reverse().join(\"\");\n    return ss + s1 + s2;\n};\n```\n##### 分析如下：\n\n但是这种解法却没有通过测试，具体情况是：\n    - 超时，给出一个超长的\"aaaaaaa...aaa\"字符串\n这就要求我找到一个效率更高的解法。\n\n#### 分析解法\n```\n/**\n * @param {string} s\n * @return {number}\n */\nvar shortestPalindrome = function(s) {\n    var prefix = \"\";\n    var pos, head, tail;\n\n    for(pos = head = tail = parseInt(s.length / 2); pos > 0; head = tail = --pos){\n        while(head !== 0 && s[head - 1] === s[head]){\n            head--; pos--;\n        }\n        while(tail != s.length - 1 && s[tail + 1] === s[tail]){\n            tail++;\n        }\n        var isSame = true;\n        while(head >= 0){\n            if(s[head] !== s[tail]){\n                isSame = false;\n                break;\n            }\n            head--; tail++;\n        }\n        if(isSame){\n            break;\n        }\n    }\n\n    for(var k = s.length - 1; k >= tail && k !== 0; k--){\n        prefix += s[k];\n    }\n    return prefix + s;\n}\n```\n##### 分析如下：\n\n\t1. 思路：\n        * 取一个点，也就是期望的回文中心，把head和tail都指向它，先找前后相同的数，调整指针位置，然后head--, tail++这样找回文。\n        * 如果head等于0，说明找到了，倒着输出tail后面的字符加上input的字符串就是答案。\n        * 字符串中间和中间之前的点才有可能是回文的中心，后一半可以排除。\n        * 回文中心可能是单个或多个字母，如果是多个字母，他们肯定都是相同的。\n    2. 变量设置\n\t\t* prefix：用来存储原字符串中非回文部分的倒序\n\t\t* pos：回文中心点\n\t\t* head：回文头位置\n\t\t* tail：回文尾位置","source":"_posts/LeetCode_214.md","raw":"---\nlayout: post\ntitle: \"LeetCode刷题系列(2)(question 214)\"\nsubtitle: \"Shortest Palindrome\"\ndate: 2017-12-26\nauthor: \"Ai Shuangying\"\nheader-img: \"hack.jpeg\"\ncdn: 'header-on'\ntags:\n\t- LeetCode\n---\n\n<!-- LeetCode刷题系列(1)(question 3)\n=================== -->\n\n\n这个系列将记载我在[LeetCode](https://leetcode.com)上遇见的有意思、有难度或者有其他精彩答案的题目。\n所用语言为JavaScript。\n\n----------\n\n\n### 题目号码：214（hard）\n-------------\n\n\n> **Shortest Palindrome:**\n> Given a string S, you are allowed to convert it to a palindrome by adding characters in front of it. \n> Find and return the shortest palindrome you can find by performing this transformation.\n> \n> **Examples:**\n> - Given \"aacecaaa\", return \"aaacecaaa\".\n> - Given \"abcd\", return \"dcbabcd\".\n\n#### 题意\n给定一个字符串S，可以通过在它前面添加字符将其转换为回文。通过执行这个转换，找到并返回最短的回文。\n\n-------------\n\n#### 思路\n从字符串结尾开始遍历，与字符串开头对应位置的字母进行比较，如果不一致则插入一个相同的字母来形成回文\n\n#### 我的解法\n```\n/**\n * @param {string} s\n * @return {number}\n */\nvar lengthOfLongestSubstring = function(s) {\n    for(var i=s.length-1; i>=0; i--){\n        if(s[i] !== s[s.length-1-i]){\n            var s1 = s.substr(0,s.length-1-i);\n            var s2 = s.substring(s.length-1-i);\n            var ss = s[i];\n            s = ''+s1+ss+s2;\n            i++;\n        }\n    }\n    return s;\n};\n```\n##### 分析如下：\n\n但是这种解法却没有通过测试，具体情况是：\n    - 给出字符串 \"aabba\"\n    - 我的输出结果为 \"abbabba\"\n    - 期望输出结果为 \"abbaabba\"\n\n乍一看仿佛是我的结果更准确，但是回过头仔细审题会发现题目中要求的是“在它前面添加字符”来形成回文，即我的解法思路是错的。\n-------------\n\n#### 思路\n既然只能在给定字符串开头插入，那么就是说我需要找到给出字符串中自开头最大的回文子串，然后把剩下的字符串颠倒顺序插入即可。\n\n#### 我的解法\n```\n/**\n * @param {string} s\n * @return {number}\n */\nvar findMaxIndex = function(s){\n    for(var i=s.length-1; i>=0; i--){\n        if(s[i] != s[s.length-1-i]){\n            return false;\n        }else{\n            continue;\n        }\n    }\n    return true;\n}\nvar shortestPalindrome = function(s) {\n    var index;\n    if(s.length == 1){ return s; }\n    for(var i=s.length; i>0; i--){\n        var s0 = s.substring(0,i);\n        if(!findMaxIndex(s0)){\n            continue;\n        }else{\n            index = i;\n            break;\n        }\n    }\n    var s1 = s.substr(0,index);\n    var s2 = s.substring(index);\n    var ss = s2.split(\"\").reverse().join(\"\");\n    return ss + s1 + s2;\n};\n```\n##### 分析如下：\n\n但是这种解法却没有通过测试，具体情况是：\n    - 超时，给出一个超长的\"aaaaaaa...aaa\"字符串\n这就要求我找到一个效率更高的解法。\n\n#### 分析解法\n```\n/**\n * @param {string} s\n * @return {number}\n */\nvar shortestPalindrome = function(s) {\n    var prefix = \"\";\n    var pos, head, tail;\n\n    for(pos = head = tail = parseInt(s.length / 2); pos > 0; head = tail = --pos){\n        while(head !== 0 && s[head - 1] === s[head]){\n            head--; pos--;\n        }\n        while(tail != s.length - 1 && s[tail + 1] === s[tail]){\n            tail++;\n        }\n        var isSame = true;\n        while(head >= 0){\n            if(s[head] !== s[tail]){\n                isSame = false;\n                break;\n            }\n            head--; tail++;\n        }\n        if(isSame){\n            break;\n        }\n    }\n\n    for(var k = s.length - 1; k >= tail && k !== 0; k--){\n        prefix += s[k];\n    }\n    return prefix + s;\n}\n```\n##### 分析如下：\n\n\t1. 思路：\n        * 取一个点，也就是期望的回文中心，把head和tail都指向它，先找前后相同的数，调整指针位置，然后head--, tail++这样找回文。\n        * 如果head等于0，说明找到了，倒着输出tail后面的字符加上input的字符串就是答案。\n        * 字符串中间和中间之前的点才有可能是回文的中心，后一半可以排除。\n        * 回文中心可能是单个或多个字母，如果是多个字母，他们肯定都是相同的。\n    2. 变量设置\n\t\t* prefix：用来存储原字符串中非回文部分的倒序\n\t\t* pos：回文中心点\n\t\t* head：回文头位置\n\t\t* tail：回文尾位置","slug":"LeetCode_214","published":1,"updated":"2018-01-14T12:20:58.360Z","comments":1,"photos":[],"link":"","_id":"cjciskgdk0001n3fa8l72gip3","content":"<!-- LeetCode刷题系列(1)(question 3)\n=================== -->\n<p>这个系列将记载我在<a href=\"https://leetcode.com\" target=\"_blank\" rel=\"noopener\">LeetCode</a>上遇见的有意思、有难度或者有其他精彩答案的题目。<br>所用语言为JavaScript。</p>\n<hr>\n<h3 id=\"题目号码：214（hard）\"><a href=\"#题目号码：214（hard）\" class=\"headerlink\" title=\"题目号码：214（hard）\"></a>题目号码：214（hard）</h3><hr>\n<blockquote>\n<p><strong>Shortest Palindrome:</strong><br>Given a string S, you are allowed to convert it to a palindrome by adding characters in front of it.<br>Find and return the shortest palindrome you can find by performing this transformation.</p>\n<p><strong>Examples:</strong></p>\n<ul>\n<li>Given “aacecaaa”, return “aaacecaaa”.</li>\n<li>Given “abcd”, return “dcbabcd”.</li>\n</ul>\n</blockquote>\n<h4 id=\"题意\"><a href=\"#题意\" class=\"headerlink\" title=\"题意\"></a>题意</h4><p>给定一个字符串S，可以通过在它前面添加字符将其转换为回文。通过执行这个转换，找到并返回最短的回文。</p>\n<hr>\n<h4 id=\"思路\"><a href=\"#思路\" class=\"headerlink\" title=\"思路\"></a>思路</h4><p>从字符串结尾开始遍历，与字符串开头对应位置的字母进行比较，如果不一致则插入一个相同的字母来形成回文</p>\n<h4 id=\"我的解法\"><a href=\"#我的解法\" class=\"headerlink\" title=\"我的解法\"></a>我的解法</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/**</span><br><span class=\"line\"> * @param &#123;string&#125; s</span><br><span class=\"line\"> * @return &#123;number&#125;</span><br><span class=\"line\"> */</span><br><span class=\"line\">var lengthOfLongestSubstring = function(s) &#123;</span><br><span class=\"line\">    for(var i=s.length-1; i&gt;=0; i--)&#123;</span><br><span class=\"line\">        if(s[i] !== s[s.length-1-i])&#123;</span><br><span class=\"line\">            var s1 = s.substr(0,s.length-1-i);</span><br><span class=\"line\">            var s2 = s.substring(s.length-1-i);</span><br><span class=\"line\">            var ss = s[i];</span><br><span class=\"line\">            s = &apos;&apos;+s1+ss+s2;</span><br><span class=\"line\">            i++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return s;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h5 id=\"分析如下：\"><a href=\"#分析如下：\" class=\"headerlink\" title=\"分析如下：\"></a>分析如下：</h5><p>但是这种解法却没有通过测试，具体情况是：</p>\n<pre><code>- 给出字符串 &quot;aabba&quot;\n- 我的输出结果为 &quot;abbabba&quot;\n- 期望输出结果为 &quot;abbaabba&quot;\n</code></pre><h2 id=\"乍一看仿佛是我的结果更准确，但是回过头仔细审题会发现题目中要求的是“在它前面添加字符”来形成回文，即我的解法思路是错的。\"><a href=\"#乍一看仿佛是我的结果更准确，但是回过头仔细审题会发现题目中要求的是“在它前面添加字符”来形成回文，即我的解法思路是错的。\" class=\"headerlink\" title=\"乍一看仿佛是我的结果更准确，但是回过头仔细审题会发现题目中要求的是“在它前面添加字符”来形成回文，即我的解法思路是错的。\"></a>乍一看仿佛是我的结果更准确，但是回过头仔细审题会发现题目中要求的是“在它前面添加字符”来形成回文，即我的解法思路是错的。</h2><h4 id=\"思路-1\"><a href=\"#思路-1\" class=\"headerlink\" title=\"思路\"></a>思路</h4><p>既然只能在给定字符串开头插入，那么就是说我需要找到给出字符串中自开头最大的回文子串，然后把剩下的字符串颠倒顺序插入即可。</p>\n<h4 id=\"我的解法-1\"><a href=\"#我的解法-1\" class=\"headerlink\" title=\"我的解法\"></a>我的解法</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/**</span><br><span class=\"line\"> * @param &#123;string&#125; s</span><br><span class=\"line\"> * @return &#123;number&#125;</span><br><span class=\"line\"> */</span><br><span class=\"line\">var findMaxIndex = function(s)&#123;</span><br><span class=\"line\">    for(var i=s.length-1; i&gt;=0; i--)&#123;</span><br><span class=\"line\">        if(s[i] != s[s.length-1-i])&#123;</span><br><span class=\"line\">            return false;</span><br><span class=\"line\">        &#125;else&#123;</span><br><span class=\"line\">            continue;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return true;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">var shortestPalindrome = function(s) &#123;</span><br><span class=\"line\">    var index;</span><br><span class=\"line\">    if(s.length == 1)&#123; return s; &#125;</span><br><span class=\"line\">    for(var i=s.length; i&gt;0; i--)&#123;</span><br><span class=\"line\">        var s0 = s.substring(0,i);</span><br><span class=\"line\">        if(!findMaxIndex(s0))&#123;</span><br><span class=\"line\">            continue;</span><br><span class=\"line\">        &#125;else&#123;</span><br><span class=\"line\">            index = i;</span><br><span class=\"line\">            break;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    var s1 = s.substr(0,index);</span><br><span class=\"line\">    var s2 = s.substring(index);</span><br><span class=\"line\">    var ss = s2.split(&quot;&quot;).reverse().join(&quot;&quot;);</span><br><span class=\"line\">    return ss + s1 + s2;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h5 id=\"分析如下：-1\"><a href=\"#分析如下：-1\" class=\"headerlink\" title=\"分析如下：\"></a>分析如下：</h5><p>但是这种解法却没有通过测试，具体情况是：</p>\n<pre><code>- 超时，给出一个超长的&quot;aaaaaaa...aaa&quot;字符串\n</code></pre><p>这就要求我找到一个效率更高的解法。</p>\n<h4 id=\"分析解法\"><a href=\"#分析解法\" class=\"headerlink\" title=\"分析解法\"></a>分析解法</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/**</span><br><span class=\"line\"> * @param &#123;string&#125; s</span><br><span class=\"line\"> * @return &#123;number&#125;</span><br><span class=\"line\"> */</span><br><span class=\"line\">var shortestPalindrome = function(s) &#123;</span><br><span class=\"line\">    var prefix = &quot;&quot;;</span><br><span class=\"line\">    var pos, head, tail;</span><br><span class=\"line\"></span><br><span class=\"line\">    for(pos = head = tail = parseInt(s.length / 2); pos &gt; 0; head = tail = --pos)&#123;</span><br><span class=\"line\">        while(head !== 0 &amp;&amp; s[head - 1] === s[head])&#123;</span><br><span class=\"line\">            head--; pos--;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        while(tail != s.length - 1 &amp;&amp; s[tail + 1] === s[tail])&#123;</span><br><span class=\"line\">            tail++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        var isSame = true;</span><br><span class=\"line\">        while(head &gt;= 0)&#123;</span><br><span class=\"line\">            if(s[head] !== s[tail])&#123;</span><br><span class=\"line\">                isSame = false;</span><br><span class=\"line\">                break;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            head--; tail++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        if(isSame)&#123;</span><br><span class=\"line\">            break;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    for(var k = s.length - 1; k &gt;= tail &amp;&amp; k !== 0; k--)&#123;</span><br><span class=\"line\">        prefix += s[k];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return prefix + s;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"分析如下：-2\"><a href=\"#分析如下：-2\" class=\"headerlink\" title=\"分析如下：\"></a>分析如下：</h5><pre><code>1. 思路：\n    * 取一个点，也就是期望的回文中心，把head和tail都指向它，先找前后相同的数，调整指针位置，然后head--, tail++这样找回文。\n    * 如果head等于0，说明找到了，倒着输出tail后面的字符加上input的字符串就是答案。\n    * 字符串中间和中间之前的点才有可能是回文的中心，后一半可以排除。\n    * 回文中心可能是单个或多个字母，如果是多个字母，他们肯定都是相同的。\n2. 变量设置\n    * prefix：用来存储原字符串中非回文部分的倒序\n    * pos：回文中心点\n    * head：回文头位置\n    * tail：回文尾位置\n</code></pre>","site":{"data":{}},"excerpt":"","more":"<!-- LeetCode刷题系列(1)(question 3)\n=================== -->\n<p>这个系列将记载我在<a href=\"https://leetcode.com\" target=\"_blank\" rel=\"noopener\">LeetCode</a>上遇见的有意思、有难度或者有其他精彩答案的题目。<br>所用语言为JavaScript。</p>\n<hr>\n<h3 id=\"题目号码：214（hard）\"><a href=\"#题目号码：214（hard）\" class=\"headerlink\" title=\"题目号码：214（hard）\"></a>题目号码：214（hard）</h3><hr>\n<blockquote>\n<p><strong>Shortest Palindrome:</strong><br>Given a string S, you are allowed to convert it to a palindrome by adding characters in front of it.<br>Find and return the shortest palindrome you can find by performing this transformation.</p>\n<p><strong>Examples:</strong></p>\n<ul>\n<li>Given “aacecaaa”, return “aaacecaaa”.</li>\n<li>Given “abcd”, return “dcbabcd”.</li>\n</ul>\n</blockquote>\n<h4 id=\"题意\"><a href=\"#题意\" class=\"headerlink\" title=\"题意\"></a>题意</h4><p>给定一个字符串S，可以通过在它前面添加字符将其转换为回文。通过执行这个转换，找到并返回最短的回文。</p>\n<hr>\n<h4 id=\"思路\"><a href=\"#思路\" class=\"headerlink\" title=\"思路\"></a>思路</h4><p>从字符串结尾开始遍历，与字符串开头对应位置的字母进行比较，如果不一致则插入一个相同的字母来形成回文</p>\n<h4 id=\"我的解法\"><a href=\"#我的解法\" class=\"headerlink\" title=\"我的解法\"></a>我的解法</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/**</span><br><span class=\"line\"> * @param &#123;string&#125; s</span><br><span class=\"line\"> * @return &#123;number&#125;</span><br><span class=\"line\"> */</span><br><span class=\"line\">var lengthOfLongestSubstring = function(s) &#123;</span><br><span class=\"line\">    for(var i=s.length-1; i&gt;=0; i--)&#123;</span><br><span class=\"line\">        if(s[i] !== s[s.length-1-i])&#123;</span><br><span class=\"line\">            var s1 = s.substr(0,s.length-1-i);</span><br><span class=\"line\">            var s2 = s.substring(s.length-1-i);</span><br><span class=\"line\">            var ss = s[i];</span><br><span class=\"line\">            s = &apos;&apos;+s1+ss+s2;</span><br><span class=\"line\">            i++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return s;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h5 id=\"分析如下：\"><a href=\"#分析如下：\" class=\"headerlink\" title=\"分析如下：\"></a>分析如下：</h5><p>但是这种解法却没有通过测试，具体情况是：</p>\n<pre><code>- 给出字符串 &quot;aabba&quot;\n- 我的输出结果为 &quot;abbabba&quot;\n- 期望输出结果为 &quot;abbaabba&quot;\n</code></pre><h2 id=\"乍一看仿佛是我的结果更准确，但是回过头仔细审题会发现题目中要求的是“在它前面添加字符”来形成回文，即我的解法思路是错的。\"><a href=\"#乍一看仿佛是我的结果更准确，但是回过头仔细审题会发现题目中要求的是“在它前面添加字符”来形成回文，即我的解法思路是错的。\" class=\"headerlink\" title=\"乍一看仿佛是我的结果更准确，但是回过头仔细审题会发现题目中要求的是“在它前面添加字符”来形成回文，即我的解法思路是错的。\"></a>乍一看仿佛是我的结果更准确，但是回过头仔细审题会发现题目中要求的是“在它前面添加字符”来形成回文，即我的解法思路是错的。</h2><h4 id=\"思路-1\"><a href=\"#思路-1\" class=\"headerlink\" title=\"思路\"></a>思路</h4><p>既然只能在给定字符串开头插入，那么就是说我需要找到给出字符串中自开头最大的回文子串，然后把剩下的字符串颠倒顺序插入即可。</p>\n<h4 id=\"我的解法-1\"><a href=\"#我的解法-1\" class=\"headerlink\" title=\"我的解法\"></a>我的解法</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/**</span><br><span class=\"line\"> * @param &#123;string&#125; s</span><br><span class=\"line\"> * @return &#123;number&#125;</span><br><span class=\"line\"> */</span><br><span class=\"line\">var findMaxIndex = function(s)&#123;</span><br><span class=\"line\">    for(var i=s.length-1; i&gt;=0; i--)&#123;</span><br><span class=\"line\">        if(s[i] != s[s.length-1-i])&#123;</span><br><span class=\"line\">            return false;</span><br><span class=\"line\">        &#125;else&#123;</span><br><span class=\"line\">            continue;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return true;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">var shortestPalindrome = function(s) &#123;</span><br><span class=\"line\">    var index;</span><br><span class=\"line\">    if(s.length == 1)&#123; return s; &#125;</span><br><span class=\"line\">    for(var i=s.length; i&gt;0; i--)&#123;</span><br><span class=\"line\">        var s0 = s.substring(0,i);</span><br><span class=\"line\">        if(!findMaxIndex(s0))&#123;</span><br><span class=\"line\">            continue;</span><br><span class=\"line\">        &#125;else&#123;</span><br><span class=\"line\">            index = i;</span><br><span class=\"line\">            break;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    var s1 = s.substr(0,index);</span><br><span class=\"line\">    var s2 = s.substring(index);</span><br><span class=\"line\">    var ss = s2.split(&quot;&quot;).reverse().join(&quot;&quot;);</span><br><span class=\"line\">    return ss + s1 + s2;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h5 id=\"分析如下：-1\"><a href=\"#分析如下：-1\" class=\"headerlink\" title=\"分析如下：\"></a>分析如下：</h5><p>但是这种解法却没有通过测试，具体情况是：</p>\n<pre><code>- 超时，给出一个超长的&quot;aaaaaaa...aaa&quot;字符串\n</code></pre><p>这就要求我找到一个效率更高的解法。</p>\n<h4 id=\"分析解法\"><a href=\"#分析解法\" class=\"headerlink\" title=\"分析解法\"></a>分析解法</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/**</span><br><span class=\"line\"> * @param &#123;string&#125; s</span><br><span class=\"line\"> * @return &#123;number&#125;</span><br><span class=\"line\"> */</span><br><span class=\"line\">var shortestPalindrome = function(s) &#123;</span><br><span class=\"line\">    var prefix = &quot;&quot;;</span><br><span class=\"line\">    var pos, head, tail;</span><br><span class=\"line\"></span><br><span class=\"line\">    for(pos = head = tail = parseInt(s.length / 2); pos &gt; 0; head = tail = --pos)&#123;</span><br><span class=\"line\">        while(head !== 0 &amp;&amp; s[head - 1] === s[head])&#123;</span><br><span class=\"line\">            head--; pos--;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        while(tail != s.length - 1 &amp;&amp; s[tail + 1] === s[tail])&#123;</span><br><span class=\"line\">            tail++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        var isSame = true;</span><br><span class=\"line\">        while(head &gt;= 0)&#123;</span><br><span class=\"line\">            if(s[head] !== s[tail])&#123;</span><br><span class=\"line\">                isSame = false;</span><br><span class=\"line\">                break;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            head--; tail++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        if(isSame)&#123;</span><br><span class=\"line\">            break;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    for(var k = s.length - 1; k &gt;= tail &amp;&amp; k !== 0; k--)&#123;</span><br><span class=\"line\">        prefix += s[k];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return prefix + s;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h5 id=\"分析如下：-2\"><a href=\"#分析如下：-2\" class=\"headerlink\" title=\"分析如下：\"></a>分析如下：</h5><pre><code>1. 思路：\n    * 取一个点，也就是期望的回文中心，把head和tail都指向它，先找前后相同的数，调整指针位置，然后head--, tail++这样找回文。\n    * 如果head等于0，说明找到了，倒着输出tail后面的字符加上input的字符串就是答案。\n    * 字符串中间和中间之前的点才有可能是回文的中心，后一半可以排除。\n    * 回文中心可能是单个或多个字母，如果是多个字母，他们肯定都是相同的。\n2. 变量设置\n    * prefix：用来存储原字符串中非回文部分的倒序\n    * pos：回文中心点\n    * head：回文头位置\n    * tail：回文尾位置\n</code></pre>"},{"layout":"post","title":"Koa学习笔记 一","subtitle":"基本用法","date":"2017-12-31T16:00:00.000Z","author":"Ai Shuangying","header-img":"hack.jpeg","cdn":"header-on","_content":"\n\n这个系列将记载我在学习Koa过程中需要记录下来的重点和遇到的问题。\n[中文文档](https://koa.bootcss.com/)\n[英文文档](http://koajs.com)\n\n----------\n\n### 安装koa\n-------------\n\nKoa 依赖 node v7.6.0 或 ES2015及更高版本和 async 方法支持\n\n这里提供将升级本地node版本的方法\n\n先查看本机node.js版本：\n\n```\n    $ node -v\n```\n\n清除node.js的cache：(此步会要求输入密码)\n\n```\n    $ sudo npm cache clean -f\n```\n\n安装 n 工具，这个工具是专门用来管理node.js版本的\n\n```\n    $ sudo npm install -g n\n```\n\n安装最新版本的node.js\n\n```\n    $ sudo n stable\n```\n\n再次查看本机的node.js版本：(本文采用的node版本为9.4.0)\n\n```\n    $ node -v\n```\n\n安装koa\n\n```\n    $ npm i koa\n```\n\n\n### 架设HTTP服务\n-------------\n\n```\n    const Koa = require('koa');\n\tconst app = new Koa();\n\n\tapp.listen(3000);\n```\n\n这里的 app.listen(...) 方法只是以下方法的语法糖:\n\n```\n    const http = require('http');\n\tconst Koa = require('koa');\n\tconst app = new Koa();\n\thttp.createServer(app.callback()).listen(3000);\n```\n\n这意味着您可以将同一个应用程序同时作为 HTTP 和 HTTPS 或多个地址：\n\n```\n    const http = require('http');\n\tconst https = require('https');\n\tconst Koa = require('koa');\n\tconst app = new Koa();\n\thttp.createServer(app.callback()).listen(3000);\n\thttps.createServer(app.callback()).listen(3001);\n```\n\n\n### 上下文对象 Context\n-------------\n\nKoa 提供一个 Context 对象，表示一次对话的上下文（包括 HTTP 请求和 HTTP 回复）。通过加工这个对象，就可以控制返回给用户的内容。\n\n```\n\tapp.use(async ctx => {\n\t  \tctx; \t\t\t// 这是 Context\n\t  \tctx.req; \t\t// 这是 Node Request\n\t  \tctx.res; \t\t// 这是 Node Response  绕过 Koa 的 response 处理是 不被支持的. \n\t  \tctx.request; \t// 这是 koa Request\n\t  \tctx.response; \t// 这是 koa Response\n\n\t  \tctx.request.header   \t//请求标头对象。\n\t  \tctx.request.header=   \t//设置请求标头对象。\n\t  \tctx.request.method   \t//请求方法。\n\t  \tctx.request.method=   \t//设置请求方法，对于实现诸如 methodOverride() 的中间件是有用的。\n\t  \tctx.request.length   \t//返回以数字返回请求的 Content-Length，或 undefined。\n\t  \tctx.request.url   \t\t//获取请求 URL.\n\t  \tctx.request.url=    \t//设置请求 URL, 对 url 重写有用。\n\t  \tctx.request.origin   \t//获取URL的来源，包括 protocol 和 host。\n\t  \tctx.request.href    \t//获取完整的请求URL，包括 protocol，host 和 url。\n\t  \tctx.request.path   \t    //获取请求路径名。\n\t  \tctx.request.querystring //根据 ? 获取原始查询字符串.\n\t  \tctx.request.search   \t//使用 ? 获取原始查询字符串。\n\t  \tctx.request.query   \t//获取解析的查询字符串, 当没有查询字符串时，返回一个空对象。请注意，此 getter 不 支持嵌套解析。\n\t});\n```\n\nContext.response.body属性就是发送给用户的内容。\n\n```\n    const Koa = require('koa');\n\tconst app = new Koa();\n\tconst main = ctx => {\n\t  \tctx.response.body = 'Hello World';\n\t};\n\tapp.use(main);\n\tapp.listen(3000);\n```\n\n```\n    ctx.response.type = 'json / xml / html / text'; //这些都是response的类型\n```\n\n```\n    const main = ctx => {\n\t  \tctx.response.type = 'html';\n\t  \tctx.response.body = fs.createReadStream('./demos/template.html');\n\t};    //返回一个网页模板\n```\n\nctx.cookies用来读写 Cookie\n\n```\n\tconst main = function(ctx) {\n  \t\tconst n = Number(ctx.cookies.get('view') || 0) + 1;\n  \t\tctx.cookies.set('view', n);\n  \t\tctx.response.body = n + ' views';\n\t}\n```\n\n### 路由\n-------------\n\n这里使用koa自带的koa-route 模块\n\n```\n    const route = require('koa-route');\n\n\tconst about = ctx => {\n\t  \tctx.response.type = 'html';\n\t  \tctx.response.body = '<a href=\"/\">Index Page</a>';\n\t};\n\n\tconst main = ctx => {\n\t  \tctx.response.body = 'Hello World';\n\t};\n\n\tapp.use(route.get('/', main));\n\tapp.use(route.get('/about', about));\n```\n\n静态资源访问则使用koa自带的koa-static模块\n\n```\n    const path = require('path');\n\tconst serve = require('koa-static');\n\n\tconst main = serve(path.join(__dirname));\n\tapp.use(main);\n```\n\n重定向\n\n```\n    const redirect = ctx => {\n  \t\tctx.response.redirect('/');\n  \t\tctx.response.body = '<a href=\"/\">Index Page</a>';\n\t};\n\n\tapp.use(route.get('/redirect', redirect));  //访问'/redirect'的请求会被重定向到'/'\n```\n\n\n### 中间件\n-------------\n\n基本上，Koa 所有的功能都是通过中间件实现的。\n中间件的实现很简单，所谓中间件可以看做是有两个参数的函数，用来在 HTTP Request 和 HTTP Response 中间实现某种功能。\n\n```\n\t//一个非常简单的输出log的中间件函数\n    const logger = (ctx, next) => {\n  \t\tconsole.log(`${Date.now()} ${ctx.request.method} ${ctx.request.url}`);\n  \t\tnext();\n\t}\n\tapp.use(logger);\n```\n\n如果对进程添加很多中间件的话会怎么样呢？\n多个中间件会形成一个栈结构（middle stack），以\"先进后出\"（first-in-last-out）的顺序执行。\n\n也就是说，会从上至下依次进入每个中间件，但只有在最内层中间件执行完毕后才会一层层返回到最外层中间件，示例如下：\n\n```\n\tconst one = (ctx, next) => {\n\t  \tconsole.log('>> one');\n\t  \tnext();\n\t  \tconsole.log('<< one');\n\t}\n\tconst two = (ctx, next) => {\n\t  \tconsole.log('>> two');\n\t  \tnext(); \n\t  \tconsole.log('<< two');\n\t}\n\tconst three = (ctx, next) => {\n\t  \tconsole.log('>> three');\n\t  \tnext();\n\t  \tconsole.log('<< three');\n\t}\n\n\tapp.use(one);\n\tapp.use(two);\n\tapp.use(three);\n```\n\n此时的输出应该是\n\n```\n\t>> one\n\t>> two\n\t>> three\n\t<< three\n\t<< two\n\t<< one\n```\n\n这是全同步中间件的执行流程，如果这些中间件中包含异步操作，那么执行的流程就会发生变化\n\n首先，包含异步操作的中间件必须写成async函数\n\n```\n\t//这就是一个异步中间件\n\tconst main = async function (ctx, next) {\n\t  \tctx.response.type = 'html';\n\t  \tctx.response.body = await fs.readFile('./demos/template.html', 'utf8');\n\t};\n\n\tapp.use(main);\n```\n\n中间件的合成则可以使用 koa-compose 模块\n\n```\n\tconst compose = require('koa-compose');\n\n\tconst logger = (ctx, next) => {\n\t  \tconsole.log(`${Date.now()} ${ctx.request.method} ${ctx.request.url}`);\n\t  \tnext();\n\t}\n\n\tconst main = ctx => {\n\t  \tctx.response.body = 'Hello World';\n\t};\n\n\tconst middlewares = compose([logger, main]);\n\tapp.use(middlewares);\n```\n\n从 POST 请求的数据体里面提取键值对使用 koa-body 模块\n\n```\n\tconst koaBody = require('koa-body');\n\n\tconst main = async function(ctx) {\n\t  \tconst body = ctx.request.body;\n\t  \tif (!body.name) ctx.throw(400, '.name required');\n\t  \tctx.body = { name: body.name };\n\t};\n\n\tapp.use(koaBody());\n```\n\n\n\n### 错误处理\n-------------\n\n直接抛出错误\n\n```\n\tconst main = ctx => {\n  \t\tctx.throw(500);\n\t};\n```\n\n返回错误\n\n```\n\tconst main = ctx => {\n  \t\tctx.response.status = 404;\n  \t\tctx.response.body = 'Page Not Found';\n\t};\n```\n\n为了方便处理错误，最好使用try...catch将其捕获。但是，为每个中间件都写try...catch太麻烦，我们可以让最外层的中间件，负责所有中间件的错误处理。\n\n```\n\tconst handler = async (ctx, next) => {\n\t  \ttry {\n\t    \tawait next();\n\t  \t}catch (err) {\n\t    \tctx.response.status = err.statusCode || err.status || 500;\n\t    \tctx.response.body = {\n\t      \t\tmessage: err.message\n\t    \t};\n\t  \t}\n\t};\n\n\tconst main = ctx => {\n\t  \tctx.throw(500);\n\t};\n\n\tapp.use(handler);\n\tapp.use(main);\n```\n\napp监听错误的处理方法\n\n```\n\tapp.on('error', (err, ctx) =>\n  \t\tconsole.error('server error', err);\n\t);\n```\n\n需要注意的是，如果错误被try...catch捕获，就不会触发error事件。这时，必须调用ctx.app.emit()，手动释放error事件，才能让监听函数生效。\n\n```\n\tconst handler = async (ctx, next) => {\n\t  \ttry {\n\t    \tawait next();\n\t  \t} catch (err) {\n\t    \tctx.response.status = err.statusCode || err.status || 500;\n\t    \tctx.response.type = 'html';\n\t    \tctx.response.body = '<p>Something wrong, please contact administrator.</p>';\n\t    \tctx.app.emit('error', err, ctx);\n\t  \t}\n\t};\n```\n\n\n参考：\n[阮一峰koa教程](http://www.ruanyifeng.com/blog/2017/08/koa.html)\n","source":"_posts/koa1.md","raw":"---\nlayout: post\ntitle: \"Koa学习笔记 一\"\nsubtitle: \"基本用法\"\ndate: 2018-1-1\nauthor: \"Ai Shuangying\"\nheader-img: \"hack.jpeg\"\ncdn: 'header-on'\ntags: \n    - Node.js\n    - Koa\n---\n\n\n这个系列将记载我在学习Koa过程中需要记录下来的重点和遇到的问题。\n[中文文档](https://koa.bootcss.com/)\n[英文文档](http://koajs.com)\n\n----------\n\n### 安装koa\n-------------\n\nKoa 依赖 node v7.6.0 或 ES2015及更高版本和 async 方法支持\n\n这里提供将升级本地node版本的方法\n\n先查看本机node.js版本：\n\n```\n    $ node -v\n```\n\n清除node.js的cache：(此步会要求输入密码)\n\n```\n    $ sudo npm cache clean -f\n```\n\n安装 n 工具，这个工具是专门用来管理node.js版本的\n\n```\n    $ sudo npm install -g n\n```\n\n安装最新版本的node.js\n\n```\n    $ sudo n stable\n```\n\n再次查看本机的node.js版本：(本文采用的node版本为9.4.0)\n\n```\n    $ node -v\n```\n\n安装koa\n\n```\n    $ npm i koa\n```\n\n\n### 架设HTTP服务\n-------------\n\n```\n    const Koa = require('koa');\n\tconst app = new Koa();\n\n\tapp.listen(3000);\n```\n\n这里的 app.listen(...) 方法只是以下方法的语法糖:\n\n```\n    const http = require('http');\n\tconst Koa = require('koa');\n\tconst app = new Koa();\n\thttp.createServer(app.callback()).listen(3000);\n```\n\n这意味着您可以将同一个应用程序同时作为 HTTP 和 HTTPS 或多个地址：\n\n```\n    const http = require('http');\n\tconst https = require('https');\n\tconst Koa = require('koa');\n\tconst app = new Koa();\n\thttp.createServer(app.callback()).listen(3000);\n\thttps.createServer(app.callback()).listen(3001);\n```\n\n\n### 上下文对象 Context\n-------------\n\nKoa 提供一个 Context 对象，表示一次对话的上下文（包括 HTTP 请求和 HTTP 回复）。通过加工这个对象，就可以控制返回给用户的内容。\n\n```\n\tapp.use(async ctx => {\n\t  \tctx; \t\t\t// 这是 Context\n\t  \tctx.req; \t\t// 这是 Node Request\n\t  \tctx.res; \t\t// 这是 Node Response  绕过 Koa 的 response 处理是 不被支持的. \n\t  \tctx.request; \t// 这是 koa Request\n\t  \tctx.response; \t// 这是 koa Response\n\n\t  \tctx.request.header   \t//请求标头对象。\n\t  \tctx.request.header=   \t//设置请求标头对象。\n\t  \tctx.request.method   \t//请求方法。\n\t  \tctx.request.method=   \t//设置请求方法，对于实现诸如 methodOverride() 的中间件是有用的。\n\t  \tctx.request.length   \t//返回以数字返回请求的 Content-Length，或 undefined。\n\t  \tctx.request.url   \t\t//获取请求 URL.\n\t  \tctx.request.url=    \t//设置请求 URL, 对 url 重写有用。\n\t  \tctx.request.origin   \t//获取URL的来源，包括 protocol 和 host。\n\t  \tctx.request.href    \t//获取完整的请求URL，包括 protocol，host 和 url。\n\t  \tctx.request.path   \t    //获取请求路径名。\n\t  \tctx.request.querystring //根据 ? 获取原始查询字符串.\n\t  \tctx.request.search   \t//使用 ? 获取原始查询字符串。\n\t  \tctx.request.query   \t//获取解析的查询字符串, 当没有查询字符串时，返回一个空对象。请注意，此 getter 不 支持嵌套解析。\n\t});\n```\n\nContext.response.body属性就是发送给用户的内容。\n\n```\n    const Koa = require('koa');\n\tconst app = new Koa();\n\tconst main = ctx => {\n\t  \tctx.response.body = 'Hello World';\n\t};\n\tapp.use(main);\n\tapp.listen(3000);\n```\n\n```\n    ctx.response.type = 'json / xml / html / text'; //这些都是response的类型\n```\n\n```\n    const main = ctx => {\n\t  \tctx.response.type = 'html';\n\t  \tctx.response.body = fs.createReadStream('./demos/template.html');\n\t};    //返回一个网页模板\n```\n\nctx.cookies用来读写 Cookie\n\n```\n\tconst main = function(ctx) {\n  \t\tconst n = Number(ctx.cookies.get('view') || 0) + 1;\n  \t\tctx.cookies.set('view', n);\n  \t\tctx.response.body = n + ' views';\n\t}\n```\n\n### 路由\n-------------\n\n这里使用koa自带的koa-route 模块\n\n```\n    const route = require('koa-route');\n\n\tconst about = ctx => {\n\t  \tctx.response.type = 'html';\n\t  \tctx.response.body = '<a href=\"/\">Index Page</a>';\n\t};\n\n\tconst main = ctx => {\n\t  \tctx.response.body = 'Hello World';\n\t};\n\n\tapp.use(route.get('/', main));\n\tapp.use(route.get('/about', about));\n```\n\n静态资源访问则使用koa自带的koa-static模块\n\n```\n    const path = require('path');\n\tconst serve = require('koa-static');\n\n\tconst main = serve(path.join(__dirname));\n\tapp.use(main);\n```\n\n重定向\n\n```\n    const redirect = ctx => {\n  \t\tctx.response.redirect('/');\n  \t\tctx.response.body = '<a href=\"/\">Index Page</a>';\n\t};\n\n\tapp.use(route.get('/redirect', redirect));  //访问'/redirect'的请求会被重定向到'/'\n```\n\n\n### 中间件\n-------------\n\n基本上，Koa 所有的功能都是通过中间件实现的。\n中间件的实现很简单，所谓中间件可以看做是有两个参数的函数，用来在 HTTP Request 和 HTTP Response 中间实现某种功能。\n\n```\n\t//一个非常简单的输出log的中间件函数\n    const logger = (ctx, next) => {\n  \t\tconsole.log(`${Date.now()} ${ctx.request.method} ${ctx.request.url}`);\n  \t\tnext();\n\t}\n\tapp.use(logger);\n```\n\n如果对进程添加很多中间件的话会怎么样呢？\n多个中间件会形成一个栈结构（middle stack），以\"先进后出\"（first-in-last-out）的顺序执行。\n\n也就是说，会从上至下依次进入每个中间件，但只有在最内层中间件执行完毕后才会一层层返回到最外层中间件，示例如下：\n\n```\n\tconst one = (ctx, next) => {\n\t  \tconsole.log('>> one');\n\t  \tnext();\n\t  \tconsole.log('<< one');\n\t}\n\tconst two = (ctx, next) => {\n\t  \tconsole.log('>> two');\n\t  \tnext(); \n\t  \tconsole.log('<< two');\n\t}\n\tconst three = (ctx, next) => {\n\t  \tconsole.log('>> three');\n\t  \tnext();\n\t  \tconsole.log('<< three');\n\t}\n\n\tapp.use(one);\n\tapp.use(two);\n\tapp.use(three);\n```\n\n此时的输出应该是\n\n```\n\t>> one\n\t>> two\n\t>> three\n\t<< three\n\t<< two\n\t<< one\n```\n\n这是全同步中间件的执行流程，如果这些中间件中包含异步操作，那么执行的流程就会发生变化\n\n首先，包含异步操作的中间件必须写成async函数\n\n```\n\t//这就是一个异步中间件\n\tconst main = async function (ctx, next) {\n\t  \tctx.response.type = 'html';\n\t  \tctx.response.body = await fs.readFile('./demos/template.html', 'utf8');\n\t};\n\n\tapp.use(main);\n```\n\n中间件的合成则可以使用 koa-compose 模块\n\n```\n\tconst compose = require('koa-compose');\n\n\tconst logger = (ctx, next) => {\n\t  \tconsole.log(`${Date.now()} ${ctx.request.method} ${ctx.request.url}`);\n\t  \tnext();\n\t}\n\n\tconst main = ctx => {\n\t  \tctx.response.body = 'Hello World';\n\t};\n\n\tconst middlewares = compose([logger, main]);\n\tapp.use(middlewares);\n```\n\n从 POST 请求的数据体里面提取键值对使用 koa-body 模块\n\n```\n\tconst koaBody = require('koa-body');\n\n\tconst main = async function(ctx) {\n\t  \tconst body = ctx.request.body;\n\t  \tif (!body.name) ctx.throw(400, '.name required');\n\t  \tctx.body = { name: body.name };\n\t};\n\n\tapp.use(koaBody());\n```\n\n\n\n### 错误处理\n-------------\n\n直接抛出错误\n\n```\n\tconst main = ctx => {\n  \t\tctx.throw(500);\n\t};\n```\n\n返回错误\n\n```\n\tconst main = ctx => {\n  \t\tctx.response.status = 404;\n  \t\tctx.response.body = 'Page Not Found';\n\t};\n```\n\n为了方便处理错误，最好使用try...catch将其捕获。但是，为每个中间件都写try...catch太麻烦，我们可以让最外层的中间件，负责所有中间件的错误处理。\n\n```\n\tconst handler = async (ctx, next) => {\n\t  \ttry {\n\t    \tawait next();\n\t  \t}catch (err) {\n\t    \tctx.response.status = err.statusCode || err.status || 500;\n\t    \tctx.response.body = {\n\t      \t\tmessage: err.message\n\t    \t};\n\t  \t}\n\t};\n\n\tconst main = ctx => {\n\t  \tctx.throw(500);\n\t};\n\n\tapp.use(handler);\n\tapp.use(main);\n```\n\napp监听错误的处理方法\n\n```\n\tapp.on('error', (err, ctx) =>\n  \t\tconsole.error('server error', err);\n\t);\n```\n\n需要注意的是，如果错误被try...catch捕获，就不会触发error事件。这时，必须调用ctx.app.emit()，手动释放error事件，才能让监听函数生效。\n\n```\n\tconst handler = async (ctx, next) => {\n\t  \ttry {\n\t    \tawait next();\n\t  \t} catch (err) {\n\t    \tctx.response.status = err.statusCode || err.status || 500;\n\t    \tctx.response.type = 'html';\n\t    \tctx.response.body = '<p>Something wrong, please contact administrator.</p>';\n\t    \tctx.app.emit('error', err, ctx);\n\t  \t}\n\t};\n```\n\n\n参考：\n[阮一峰koa教程](http://www.ruanyifeng.com/blog/2017/08/koa.html)\n","slug":"koa1","published":1,"updated":"2018-01-17T08:10:50.321Z","comments":1,"photos":[],"link":"","_id":"cjciskgdo0003n3facwxcti62","content":"<p>这个系列将记载我在学习Koa过程中需要记录下来的重点和遇到的问题。<br><a href=\"https://koa.bootcss.com/\" target=\"_blank\" rel=\"noopener\">中文文档</a><br><a href=\"http://koajs.com\" target=\"_blank\" rel=\"noopener\">英文文档</a></p>\n<hr>\n<h3 id=\"安装koa\"><a href=\"#安装koa\" class=\"headerlink\" title=\"安装koa\"></a>安装koa</h3><hr>\n<p>Koa 依赖 node v7.6.0 或 ES2015及更高版本和 async 方法支持</p>\n<p>这里提供将升级本地node版本的方法</p>\n<p>先查看本机node.js版本：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ node -v</span><br></pre></td></tr></table></figure>\n<p>清除node.js的cache：(此步会要求输入密码)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo npm cache clean -f</span><br></pre></td></tr></table></figure>\n<p>安装 n 工具，这个工具是专门用来管理node.js版本的</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo npm install -g n</span><br></pre></td></tr></table></figure>\n<p>安装最新版本的node.js</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo n stable</span><br></pre></td></tr></table></figure>\n<p>再次查看本机的node.js版本：(本文采用的node版本为9.4.0)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ node -v</span><br></pre></td></tr></table></figure>\n<p>安装koa</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm i koa</span><br></pre></td></tr></table></figure>\n<h3 id=\"架设HTTP服务\"><a href=\"#架设HTTP服务\" class=\"headerlink\" title=\"架设HTTP服务\"></a>架设HTTP服务</h3><hr>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   const Koa = require(&apos;koa&apos;);</span><br><span class=\"line\">const app = new Koa();</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(3000);</span><br></pre></td></tr></table></figure>\n<p>这里的 app.listen(…) 方法只是以下方法的语法糖:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   const http = require(&apos;http&apos;);</span><br><span class=\"line\">const Koa = require(&apos;koa&apos;);</span><br><span class=\"line\">const app = new Koa();</span><br><span class=\"line\">http.createServer(app.callback()).listen(3000);</span><br></pre></td></tr></table></figure>\n<p>这意味着您可以将同一个应用程序同时作为 HTTP 和 HTTPS 或多个地址：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   const http = require(&apos;http&apos;);</span><br><span class=\"line\">const https = require(&apos;https&apos;);</span><br><span class=\"line\">const Koa = require(&apos;koa&apos;);</span><br><span class=\"line\">const app = new Koa();</span><br><span class=\"line\">http.createServer(app.callback()).listen(3000);</span><br><span class=\"line\">https.createServer(app.callback()).listen(3001);</span><br></pre></td></tr></table></figure>\n<h3 id=\"上下文对象-Context\"><a href=\"#上下文对象-Context\" class=\"headerlink\" title=\"上下文对象 Context\"></a>上下文对象 Context</h3><hr>\n<p>Koa 提供一个 Context 对象，表示一次对话的上下文（包括 HTTP 请求和 HTTP 回复）。通过加工这个对象，就可以控制返回给用户的内容。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.use(async ctx =&gt; &#123;</span><br><span class=\"line\">  \tctx; \t\t\t// 这是 Context</span><br><span class=\"line\">  \tctx.req; \t\t// 这是 Node Request</span><br><span class=\"line\">  \tctx.res; \t\t// 这是 Node Response  绕过 Koa 的 response 处理是 不被支持的. </span><br><span class=\"line\">  \tctx.request; \t// 这是 koa Request</span><br><span class=\"line\">  \tctx.response; \t// 这是 koa Response</span><br><span class=\"line\"></span><br><span class=\"line\">  \tctx.request.header   \t//请求标头对象。</span><br><span class=\"line\">  \tctx.request.header=   \t//设置请求标头对象。</span><br><span class=\"line\">  \tctx.request.method   \t//请求方法。</span><br><span class=\"line\">  \tctx.request.method=   \t//设置请求方法，对于实现诸如 methodOverride() 的中间件是有用的。</span><br><span class=\"line\">  \tctx.request.length   \t//返回以数字返回请求的 Content-Length，或 undefined。</span><br><span class=\"line\">  \tctx.request.url   \t\t//获取请求 URL.</span><br><span class=\"line\">  \tctx.request.url=    \t//设置请求 URL, 对 url 重写有用。</span><br><span class=\"line\">  \tctx.request.origin   \t//获取URL的来源，包括 protocol 和 host。</span><br><span class=\"line\">  \tctx.request.href    \t//获取完整的请求URL，包括 protocol，host 和 url。</span><br><span class=\"line\">  \tctx.request.path   \t    //获取请求路径名。</span><br><span class=\"line\">  \tctx.request.querystring //根据 ? 获取原始查询字符串.</span><br><span class=\"line\">  \tctx.request.search   \t//使用 ? 获取原始查询字符串。</span><br><span class=\"line\">  \tctx.request.query   \t//获取解析的查询字符串, 当没有查询字符串时，返回一个空对象。请注意，此 getter 不 支持嵌套解析。</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>Context.response.body属性就是发送给用户的内容。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   const Koa = require(&apos;koa&apos;);</span><br><span class=\"line\">const app = new Koa();</span><br><span class=\"line\">const main = ctx =&gt; &#123;</span><br><span class=\"line\">  \tctx.response.body = &apos;Hello World&apos;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">app.use(main);</span><br><span class=\"line\">app.listen(3000);</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ctx.response.type = &apos;json / xml / html / text&apos;; //这些都是response的类型</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   const main = ctx =&gt; &#123;</span><br><span class=\"line\">  \tctx.response.type = &apos;html&apos;;</span><br><span class=\"line\">  \tctx.response.body = fs.createReadStream(&apos;./demos/template.html&apos;);</span><br><span class=\"line\">&#125;;    //返回一个网页模板</span><br></pre></td></tr></table></figure>\n<p>ctx.cookies用来读写 Cookie</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const main = function(ctx) &#123;</span><br><span class=\"line\"> \t\tconst n = Number(ctx.cookies.get(&apos;view&apos;) || 0) + 1;</span><br><span class=\"line\"> \t\tctx.cookies.set(&apos;view&apos;, n);</span><br><span class=\"line\"> \t\tctx.response.body = n + &apos; views&apos;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"路由\"><a href=\"#路由\" class=\"headerlink\" title=\"路由\"></a>路由</h3><hr>\n<p>这里使用koa自带的koa-route 模块</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   const route = require(&apos;koa-route&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">const about = ctx =&gt; &#123;</span><br><span class=\"line\">  \tctx.response.type = &apos;html&apos;;</span><br><span class=\"line\">  \tctx.response.body = &apos;&lt;a href=&quot;/&quot;&gt;Index Page&lt;/a&gt;&apos;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">const main = ctx =&gt; &#123;</span><br><span class=\"line\">  \tctx.response.body = &apos;Hello World&apos;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(route.get(&apos;/&apos;, main));</span><br><span class=\"line\">app.use(route.get(&apos;/about&apos;, about));</span><br></pre></td></tr></table></figure>\n<p>静态资源访问则使用koa自带的koa-static模块</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   const path = require(&apos;path&apos;);</span><br><span class=\"line\">const serve = require(&apos;koa-static&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">const main = serve(path.join(__dirname));</span><br><span class=\"line\">app.use(main);</span><br></pre></td></tr></table></figure>\n<p>重定向</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   const redirect = ctx =&gt; &#123;</span><br><span class=\"line\"> \t\tctx.response.redirect(&apos;/&apos;);</span><br><span class=\"line\"> \t\tctx.response.body = &apos;&lt;a href=&quot;/&quot;&gt;Index Page&lt;/a&gt;&apos;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(route.get(&apos;/redirect&apos;, redirect));  //访问&apos;/redirect&apos;的请求会被重定向到&apos;/&apos;</span><br></pre></td></tr></table></figure>\n<h3 id=\"中间件\"><a href=\"#中间件\" class=\"headerlink\" title=\"中间件\"></a>中间件</h3><hr>\n<p>基本上，Koa 所有的功能都是通过中间件实现的。<br>中间件的实现很简单，所谓中间件可以看做是有两个参数的函数，用来在 HTTP Request 和 HTTP Response 中间实现某种功能。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//一个非常简单的输出log的中间件函数</span><br><span class=\"line\">   const logger = (ctx, next) =&gt; &#123;</span><br><span class=\"line\"> \t\tconsole.log(`$&#123;Date.now()&#125; $&#123;ctx.request.method&#125; $&#123;ctx.request.url&#125;`);</span><br><span class=\"line\"> \t\tnext();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">app.use(logger);</span><br></pre></td></tr></table></figure>\n<p>如果对进程添加很多中间件的话会怎么样呢？<br>多个中间件会形成一个栈结构（middle stack），以”先进后出”（first-in-last-out）的顺序执行。</p>\n<p>也就是说，会从上至下依次进入每个中间件，但只有在最内层中间件执行完毕后才会一层层返回到最外层中间件，示例如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const one = (ctx, next) =&gt; &#123;</span><br><span class=\"line\">  \tconsole.log(&apos;&gt;&gt; one&apos;);</span><br><span class=\"line\">  \tnext();</span><br><span class=\"line\">  \tconsole.log(&apos;&lt;&lt; one&apos;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">const two = (ctx, next) =&gt; &#123;</span><br><span class=\"line\">  \tconsole.log(&apos;&gt;&gt; two&apos;);</span><br><span class=\"line\">  \tnext(); </span><br><span class=\"line\">  \tconsole.log(&apos;&lt;&lt; two&apos;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">const three = (ctx, next) =&gt; &#123;</span><br><span class=\"line\">  \tconsole.log(&apos;&gt;&gt; three&apos;);</span><br><span class=\"line\">  \tnext();</span><br><span class=\"line\">  \tconsole.log(&apos;&lt;&lt; three&apos;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(one);</span><br><span class=\"line\">app.use(two);</span><br><span class=\"line\">app.use(three);</span><br></pre></td></tr></table></figure>\n<p>此时的输出应该是</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt; one</span><br><span class=\"line\">&gt;&gt; two</span><br><span class=\"line\">&gt;&gt; three</span><br><span class=\"line\">&lt;&lt; three</span><br><span class=\"line\">&lt;&lt; two</span><br><span class=\"line\">&lt;&lt; one</span><br></pre></td></tr></table></figure>\n<p>这是全同步中间件的执行流程，如果这些中间件中包含异步操作，那么执行的流程就会发生变化</p>\n<p>首先，包含异步操作的中间件必须写成async函数</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//这就是一个异步中间件</span><br><span class=\"line\">const main = async function (ctx, next) &#123;</span><br><span class=\"line\">  \tctx.response.type = &apos;html&apos;;</span><br><span class=\"line\">  \tctx.response.body = await fs.readFile(&apos;./demos/template.html&apos;, &apos;utf8&apos;);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(main);</span><br></pre></td></tr></table></figure>\n<p>中间件的合成则可以使用 koa-compose 模块</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const compose = require(&apos;koa-compose&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">const logger = (ctx, next) =&gt; &#123;</span><br><span class=\"line\">  \tconsole.log(`$&#123;Date.now()&#125; $&#123;ctx.request.method&#125; $&#123;ctx.request.url&#125;`);</span><br><span class=\"line\">  \tnext();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">const main = ctx =&gt; &#123;</span><br><span class=\"line\">  \tctx.response.body = &apos;Hello World&apos;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">const middlewares = compose([logger, main]);</span><br><span class=\"line\">app.use(middlewares);</span><br></pre></td></tr></table></figure>\n<p>从 POST 请求的数据体里面提取键值对使用 koa-body 模块</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const koaBody = require(&apos;koa-body&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">const main = async function(ctx) &#123;</span><br><span class=\"line\">  \tconst body = ctx.request.body;</span><br><span class=\"line\">  \tif (!body.name) ctx.throw(400, &apos;.name required&apos;);</span><br><span class=\"line\">  \tctx.body = &#123; name: body.name &#125;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(koaBody());</span><br></pre></td></tr></table></figure>\n<h3 id=\"错误处理\"><a href=\"#错误处理\" class=\"headerlink\" title=\"错误处理\"></a>错误处理</h3><hr>\n<p>直接抛出错误</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const main = ctx =&gt; &#123;</span><br><span class=\"line\"> \t\tctx.throw(500);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>返回错误</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const main = ctx =&gt; &#123;</span><br><span class=\"line\"> \t\tctx.response.status = 404;</span><br><span class=\"line\"> \t\tctx.response.body = &apos;Page Not Found&apos;;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>为了方便处理错误，最好使用try…catch将其捕获。但是，为每个中间件都写try…catch太麻烦，我们可以让最外层的中间件，负责所有中间件的错误处理。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const handler = async (ctx, next) =&gt; &#123;</span><br><span class=\"line\">  \ttry &#123;</span><br><span class=\"line\">    \tawait next();</span><br><span class=\"line\">  \t&#125;catch (err) &#123;</span><br><span class=\"line\">    \tctx.response.status = err.statusCode || err.status || 500;</span><br><span class=\"line\">    \tctx.response.body = &#123;</span><br><span class=\"line\">      \t\tmessage: err.message</span><br><span class=\"line\">    \t&#125;;</span><br><span class=\"line\">  \t&#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">const main = ctx =&gt; &#123;</span><br><span class=\"line\">  \tctx.throw(500);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(handler);</span><br><span class=\"line\">app.use(main);</span><br></pre></td></tr></table></figure>\n<p>app监听错误的处理方法</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.on(&apos;error&apos;, (err, ctx) =&gt;</span><br><span class=\"line\"> \t\tconsole.error(&apos;server error&apos;, err);</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<p>需要注意的是，如果错误被try…catch捕获，就不会触发error事件。这时，必须调用ctx.app.emit()，手动释放error事件，才能让监听函数生效。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const handler = async (ctx, next) =&gt; &#123;</span><br><span class=\"line\">  \ttry &#123;</span><br><span class=\"line\">    \tawait next();</span><br><span class=\"line\">  \t&#125; catch (err) &#123;</span><br><span class=\"line\">    \tctx.response.status = err.statusCode || err.status || 500;</span><br><span class=\"line\">    \tctx.response.type = &apos;html&apos;;</span><br><span class=\"line\">    \tctx.response.body = &apos;&lt;p&gt;Something wrong, please contact administrator.&lt;/p&gt;&apos;;</span><br><span class=\"line\">    \tctx.app.emit(&apos;error&apos;, err, ctx);</span><br><span class=\"line\">  \t&#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>参考：<br><a href=\"http://www.ruanyifeng.com/blog/2017/08/koa.html\" target=\"_blank\" rel=\"noopener\">阮一峰koa教程</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>这个系列将记载我在学习Koa过程中需要记录下来的重点和遇到的问题。<br><a href=\"https://koa.bootcss.com/\" target=\"_blank\" rel=\"noopener\">中文文档</a><br><a href=\"http://koajs.com\" target=\"_blank\" rel=\"noopener\">英文文档</a></p>\n<hr>\n<h3 id=\"安装koa\"><a href=\"#安装koa\" class=\"headerlink\" title=\"安装koa\"></a>安装koa</h3><hr>\n<p>Koa 依赖 node v7.6.0 或 ES2015及更高版本和 async 方法支持</p>\n<p>这里提供将升级本地node版本的方法</p>\n<p>先查看本机node.js版本：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ node -v</span><br></pre></td></tr></table></figure>\n<p>清除node.js的cache：(此步会要求输入密码)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo npm cache clean -f</span><br></pre></td></tr></table></figure>\n<p>安装 n 工具，这个工具是专门用来管理node.js版本的</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo npm install -g n</span><br></pre></td></tr></table></figure>\n<p>安装最新版本的node.js</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ sudo n stable</span><br></pre></td></tr></table></figure>\n<p>再次查看本机的node.js版本：(本文采用的node版本为9.4.0)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ node -v</span><br></pre></td></tr></table></figure>\n<p>安装koa</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ npm i koa</span><br></pre></td></tr></table></figure>\n<h3 id=\"架设HTTP服务\"><a href=\"#架设HTTP服务\" class=\"headerlink\" title=\"架设HTTP服务\"></a>架设HTTP服务</h3><hr>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   const Koa = require(&apos;koa&apos;);</span><br><span class=\"line\">const app = new Koa();</span><br><span class=\"line\"></span><br><span class=\"line\">app.listen(3000);</span><br></pre></td></tr></table></figure>\n<p>这里的 app.listen(…) 方法只是以下方法的语法糖:</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   const http = require(&apos;http&apos;);</span><br><span class=\"line\">const Koa = require(&apos;koa&apos;);</span><br><span class=\"line\">const app = new Koa();</span><br><span class=\"line\">http.createServer(app.callback()).listen(3000);</span><br></pre></td></tr></table></figure>\n<p>这意味着您可以将同一个应用程序同时作为 HTTP 和 HTTPS 或多个地址：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   const http = require(&apos;http&apos;);</span><br><span class=\"line\">const https = require(&apos;https&apos;);</span><br><span class=\"line\">const Koa = require(&apos;koa&apos;);</span><br><span class=\"line\">const app = new Koa();</span><br><span class=\"line\">http.createServer(app.callback()).listen(3000);</span><br><span class=\"line\">https.createServer(app.callback()).listen(3001);</span><br></pre></td></tr></table></figure>\n<h3 id=\"上下文对象-Context\"><a href=\"#上下文对象-Context\" class=\"headerlink\" title=\"上下文对象 Context\"></a>上下文对象 Context</h3><hr>\n<p>Koa 提供一个 Context 对象，表示一次对话的上下文（包括 HTTP 请求和 HTTP 回复）。通过加工这个对象，就可以控制返回给用户的内容。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.use(async ctx =&gt; &#123;</span><br><span class=\"line\">  \tctx; \t\t\t// 这是 Context</span><br><span class=\"line\">  \tctx.req; \t\t// 这是 Node Request</span><br><span class=\"line\">  \tctx.res; \t\t// 这是 Node Response  绕过 Koa 的 response 处理是 不被支持的. </span><br><span class=\"line\">  \tctx.request; \t// 这是 koa Request</span><br><span class=\"line\">  \tctx.response; \t// 这是 koa Response</span><br><span class=\"line\"></span><br><span class=\"line\">  \tctx.request.header   \t//请求标头对象。</span><br><span class=\"line\">  \tctx.request.header=   \t//设置请求标头对象。</span><br><span class=\"line\">  \tctx.request.method   \t//请求方法。</span><br><span class=\"line\">  \tctx.request.method=   \t//设置请求方法，对于实现诸如 methodOverride() 的中间件是有用的。</span><br><span class=\"line\">  \tctx.request.length   \t//返回以数字返回请求的 Content-Length，或 undefined。</span><br><span class=\"line\">  \tctx.request.url   \t\t//获取请求 URL.</span><br><span class=\"line\">  \tctx.request.url=    \t//设置请求 URL, 对 url 重写有用。</span><br><span class=\"line\">  \tctx.request.origin   \t//获取URL的来源，包括 protocol 和 host。</span><br><span class=\"line\">  \tctx.request.href    \t//获取完整的请求URL，包括 protocol，host 和 url。</span><br><span class=\"line\">  \tctx.request.path   \t    //获取请求路径名。</span><br><span class=\"line\">  \tctx.request.querystring //根据 ? 获取原始查询字符串.</span><br><span class=\"line\">  \tctx.request.search   \t//使用 ? 获取原始查询字符串。</span><br><span class=\"line\">  \tctx.request.query   \t//获取解析的查询字符串, 当没有查询字符串时，返回一个空对象。请注意，此 getter 不 支持嵌套解析。</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>Context.response.body属性就是发送给用户的内容。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   const Koa = require(&apos;koa&apos;);</span><br><span class=\"line\">const app = new Koa();</span><br><span class=\"line\">const main = ctx =&gt; &#123;</span><br><span class=\"line\">  \tctx.response.body = &apos;Hello World&apos;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">app.use(main);</span><br><span class=\"line\">app.listen(3000);</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ctx.response.type = &apos;json / xml / html / text&apos;; //这些都是response的类型</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   const main = ctx =&gt; &#123;</span><br><span class=\"line\">  \tctx.response.type = &apos;html&apos;;</span><br><span class=\"line\">  \tctx.response.body = fs.createReadStream(&apos;./demos/template.html&apos;);</span><br><span class=\"line\">&#125;;    //返回一个网页模板</span><br></pre></td></tr></table></figure>\n<p>ctx.cookies用来读写 Cookie</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const main = function(ctx) &#123;</span><br><span class=\"line\"> \t\tconst n = Number(ctx.cookies.get(&apos;view&apos;) || 0) + 1;</span><br><span class=\"line\"> \t\tctx.cookies.set(&apos;view&apos;, n);</span><br><span class=\"line\"> \t\tctx.response.body = n + &apos; views&apos;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"路由\"><a href=\"#路由\" class=\"headerlink\" title=\"路由\"></a>路由</h3><hr>\n<p>这里使用koa自带的koa-route 模块</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   const route = require(&apos;koa-route&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">const about = ctx =&gt; &#123;</span><br><span class=\"line\">  \tctx.response.type = &apos;html&apos;;</span><br><span class=\"line\">  \tctx.response.body = &apos;&lt;a href=&quot;/&quot;&gt;Index Page&lt;/a&gt;&apos;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">const main = ctx =&gt; &#123;</span><br><span class=\"line\">  \tctx.response.body = &apos;Hello World&apos;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(route.get(&apos;/&apos;, main));</span><br><span class=\"line\">app.use(route.get(&apos;/about&apos;, about));</span><br></pre></td></tr></table></figure>\n<p>静态资源访问则使用koa自带的koa-static模块</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   const path = require(&apos;path&apos;);</span><br><span class=\"line\">const serve = require(&apos;koa-static&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">const main = serve(path.join(__dirname));</span><br><span class=\"line\">app.use(main);</span><br></pre></td></tr></table></figure>\n<p>重定向</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   const redirect = ctx =&gt; &#123;</span><br><span class=\"line\"> \t\tctx.response.redirect(&apos;/&apos;);</span><br><span class=\"line\"> \t\tctx.response.body = &apos;&lt;a href=&quot;/&quot;&gt;Index Page&lt;/a&gt;&apos;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(route.get(&apos;/redirect&apos;, redirect));  //访问&apos;/redirect&apos;的请求会被重定向到&apos;/&apos;</span><br></pre></td></tr></table></figure>\n<h3 id=\"中间件\"><a href=\"#中间件\" class=\"headerlink\" title=\"中间件\"></a>中间件</h3><hr>\n<p>基本上，Koa 所有的功能都是通过中间件实现的。<br>中间件的实现很简单，所谓中间件可以看做是有两个参数的函数，用来在 HTTP Request 和 HTTP Response 中间实现某种功能。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//一个非常简单的输出log的中间件函数</span><br><span class=\"line\">   const logger = (ctx, next) =&gt; &#123;</span><br><span class=\"line\"> \t\tconsole.log(`$&#123;Date.now()&#125; $&#123;ctx.request.method&#125; $&#123;ctx.request.url&#125;`);</span><br><span class=\"line\"> \t\tnext();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">app.use(logger);</span><br></pre></td></tr></table></figure>\n<p>如果对进程添加很多中间件的话会怎么样呢？<br>多个中间件会形成一个栈结构（middle stack），以”先进后出”（first-in-last-out）的顺序执行。</p>\n<p>也就是说，会从上至下依次进入每个中间件，但只有在最内层中间件执行完毕后才会一层层返回到最外层中间件，示例如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const one = (ctx, next) =&gt; &#123;</span><br><span class=\"line\">  \tconsole.log(&apos;&gt;&gt; one&apos;);</span><br><span class=\"line\">  \tnext();</span><br><span class=\"line\">  \tconsole.log(&apos;&lt;&lt; one&apos;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">const two = (ctx, next) =&gt; &#123;</span><br><span class=\"line\">  \tconsole.log(&apos;&gt;&gt; two&apos;);</span><br><span class=\"line\">  \tnext(); </span><br><span class=\"line\">  \tconsole.log(&apos;&lt;&lt; two&apos;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">const three = (ctx, next) =&gt; &#123;</span><br><span class=\"line\">  \tconsole.log(&apos;&gt;&gt; three&apos;);</span><br><span class=\"line\">  \tnext();</span><br><span class=\"line\">  \tconsole.log(&apos;&lt;&lt; three&apos;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(one);</span><br><span class=\"line\">app.use(two);</span><br><span class=\"line\">app.use(three);</span><br></pre></td></tr></table></figure>\n<p>此时的输出应该是</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt;&gt; one</span><br><span class=\"line\">&gt;&gt; two</span><br><span class=\"line\">&gt;&gt; three</span><br><span class=\"line\">&lt;&lt; three</span><br><span class=\"line\">&lt;&lt; two</span><br><span class=\"line\">&lt;&lt; one</span><br></pre></td></tr></table></figure>\n<p>这是全同步中间件的执行流程，如果这些中间件中包含异步操作，那么执行的流程就会发生变化</p>\n<p>首先，包含异步操作的中间件必须写成async函数</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//这就是一个异步中间件</span><br><span class=\"line\">const main = async function (ctx, next) &#123;</span><br><span class=\"line\">  \tctx.response.type = &apos;html&apos;;</span><br><span class=\"line\">  \tctx.response.body = await fs.readFile(&apos;./demos/template.html&apos;, &apos;utf8&apos;);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(main);</span><br></pre></td></tr></table></figure>\n<p>中间件的合成则可以使用 koa-compose 模块</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const compose = require(&apos;koa-compose&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">const logger = (ctx, next) =&gt; &#123;</span><br><span class=\"line\">  \tconsole.log(`$&#123;Date.now()&#125; $&#123;ctx.request.method&#125; $&#123;ctx.request.url&#125;`);</span><br><span class=\"line\">  \tnext();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">const main = ctx =&gt; &#123;</span><br><span class=\"line\">  \tctx.response.body = &apos;Hello World&apos;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">const middlewares = compose([logger, main]);</span><br><span class=\"line\">app.use(middlewares);</span><br></pre></td></tr></table></figure>\n<p>从 POST 请求的数据体里面提取键值对使用 koa-body 模块</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const koaBody = require(&apos;koa-body&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">const main = async function(ctx) &#123;</span><br><span class=\"line\">  \tconst body = ctx.request.body;</span><br><span class=\"line\">  \tif (!body.name) ctx.throw(400, &apos;.name required&apos;);</span><br><span class=\"line\">  \tctx.body = &#123; name: body.name &#125;;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(koaBody());</span><br></pre></td></tr></table></figure>\n<h3 id=\"错误处理\"><a href=\"#错误处理\" class=\"headerlink\" title=\"错误处理\"></a>错误处理</h3><hr>\n<p>直接抛出错误</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const main = ctx =&gt; &#123;</span><br><span class=\"line\"> \t\tctx.throw(500);</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>返回错误</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const main = ctx =&gt; &#123;</span><br><span class=\"line\"> \t\tctx.response.status = 404;</span><br><span class=\"line\"> \t\tctx.response.body = &apos;Page Not Found&apos;;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>为了方便处理错误，最好使用try…catch将其捕获。但是，为每个中间件都写try…catch太麻烦，我们可以让最外层的中间件，负责所有中间件的错误处理。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const handler = async (ctx, next) =&gt; &#123;</span><br><span class=\"line\">  \ttry &#123;</span><br><span class=\"line\">    \tawait next();</span><br><span class=\"line\">  \t&#125;catch (err) &#123;</span><br><span class=\"line\">    \tctx.response.status = err.statusCode || err.status || 500;</span><br><span class=\"line\">    \tctx.response.body = &#123;</span><br><span class=\"line\">      \t\tmessage: err.message</span><br><span class=\"line\">    \t&#125;;</span><br><span class=\"line\">  \t&#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">const main = ctx =&gt; &#123;</span><br><span class=\"line\">  \tctx.throw(500);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">app.use(handler);</span><br><span class=\"line\">app.use(main);</span><br></pre></td></tr></table></figure>\n<p>app监听错误的处理方法</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.on(&apos;error&apos;, (err, ctx) =&gt;</span><br><span class=\"line\"> \t\tconsole.error(&apos;server error&apos;, err);</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n<p>需要注意的是，如果错误被try…catch捕获，就不会触发error事件。这时，必须调用ctx.app.emit()，手动释放error事件，才能让监听函数生效。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const handler = async (ctx, next) =&gt; &#123;</span><br><span class=\"line\">  \ttry &#123;</span><br><span class=\"line\">    \tawait next();</span><br><span class=\"line\">  \t&#125; catch (err) &#123;</span><br><span class=\"line\">    \tctx.response.status = err.statusCode || err.status || 500;</span><br><span class=\"line\">    \tctx.response.type = &apos;html&apos;;</span><br><span class=\"line\">    \tctx.response.body = &apos;&lt;p&gt;Something wrong, please contact administrator.&lt;/p&gt;&apos;;</span><br><span class=\"line\">    \tctx.app.emit(&apos;error&apos;, err, ctx);</span><br><span class=\"line\">  \t&#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>参考：<br><a href=\"http://www.ruanyifeng.com/blog/2017/08/koa.html\" target=\"_blank\" rel=\"noopener\">阮一峰koa教程</a></p>\n"},{"layout":"post","title":"Node.js系列(mongoose的学习笔记 一)","subtitle":"mongoose的基础知识","date":"2017-12-23T16:00:00.000Z","author":"Ai Shuangying","header-img":"hack.jpeg","cdn":"header-on","_content":"\n<!-- LeetCode刷题系列(1)(question 3)\n=================== -->\n\n\n这个系列将记载我在学习Node.js中常用的包相关的内容，作为以后工作中的备忘笔记。\n[官方文档](http://mongoosejs.com/docs/api.html)\n[社区文档](http://www.nodeclass.com/api/mongoose.html)\n\n----------\n\n\n### 安装mongoose\n-------------\n\n```\n    npm install mongoose\n```\n\n### 连接mongoose\n-------------\n\n```\n    var mongoose = require('mongoose');\n\n    mongoose.connect('mongodb://<dbuser>:<dbpassword>@ds147681.mlab.com:47681/aishuangying');\n\n    var db = mongoose.connection;\n\n    db.on('error', console.error.bind(console, 'connection error:'));\n    db.once('open', function (callback) {\n        console.log('connect success');\n    });\n```\n[点击这里](http://www.nodeclass.com/api/mongoose.html#connection-js)文档了解更多connection事件\n\n### Schema\n-------------\nSchema是mongoose的定义表结构的数据模式。\n每个Schema会映射到mongodb中的一个collection，但是它不具备操作数据库的能力。\n定义Schema\n\n```\n    var Schema = mongoose.Schema;         //这里的mongoose就是上面初始化好的mongoose变量\n\n    var OneSchema = new Schema({          \n        username : { type: String },\n        userpwd: {type: String},\n        userage: {type: Number},\n        logindate : { type: Date}\n    });\n```\n[点击这里](http://www.nodeclass.com/api/mongoose.html#schematype-js)文档了解更多Schema类型\n\n### Model\n-------------\n定义好Schema之后生成Model\nmodel是由schema生成的模型，可以对数据库的操作\n我们对上面的定义的user的schema生成一个User的model并导出，修改后代码如下\n\n```\n    var oneModel = mongoose.model('newUser',OneSchema);\n```\n这里的'User'就是数据库中对应的Collection名称\n\n### 常用的数据库操作\n-------------\n\n插入数据库\n\n```\n    function insert() {\n        var one = new oneModel({\n            username : 'Tracy McGrady',                 //用户账号\n            userpwd: 'abcd',                            //密码\n            userage: 37,                                //年龄\n            logindate : new Date(),                      //最近登录时间\n            updateTime : new Date()\n        });\n        one.save(function (err, res) {\n            if (err) {\n                console.log(\"Error:\" + err);\n            }\n            else {\n                console.log(\"Res:\" + res);\n            }\n        });\n    }\n    insert();\n```\n更新数据库\n\n```\n    function update(){\n        var wherestr = {'username' : 'Tracy McGrady'}\n        var updateinfo = {'updateTime' : new Date()};\n        \n        oneModel.update(wherestr, updateinfo , function(err, res){\n            if (err) {\n                console.log(\"Error:\" + err);\n            }\n            else {\n                console.log(\"Res:\" + res);\n            }\n        })\n    }\n    update();\n```\n更新规则，在这类model中按名称来更新updateTime属性。\n查询\n\n```\n    function getByConditions(){\n        var wherestr = {'username' : 'Tracy McGrady'};\n    \n        oneModel.find(wherestr, function(err, res){\n            if (err) {\n                console.log(\"Error:\" + err);\n            }\n            else {\n                console.log(\"Res:\" + res);\n            }\n        })\n    }   \n    getByConditions();\n```\n返回的res为\n```\n    { \n        _id: 5a3f6664b2938f0517a2fa2e,\n        username: 'Tracy McGrady',\n        userpwd: 'abcd',\n        userage: 37,\n        logindate: 2017-12-24T08:33:40.714Z,\n        updateTime: 2017-12-24T08:35:48.898Z,\n        __v: 0 \n    }\n```\n第2个参数可以设置要查询输出的字段,比如 var opt = {\"username\": 1 ,\"_id\": 0};\n返回的res为\n```\n    { username: 'Tracy McGrady' }\n```\n比如我要查询年龄范围条件应该怎么写呢？\n```\n    oneModel.find({userage: {$gte: 21, $lte: 65}}, callback);    //这表示查询年龄大于等21而且小于等于65岁\n```\n其实类似的还有：　\n\n　　$or　　　　       或关系\n　　$nor　　　        或关系取反\n　　$gt　　　　       大于\n　　$gte　　　        大于等于\n　　$lt　　　　       小于\n　　$lte　　　        小于等于\n　　$ne              不等于\n　　$in              在多个值范围内\n　　$nin             不在多个值范围内\n　　$all             匹配数组中多个值\n　　$regex　　        正则，用于模糊查询\n　　$size　　　       匹配数组大小\n　　$maxDistance　   范围查询，距离（基于LBS）\n　　$mod　　         取模运算\n　　$near　　　       邻域查询，查询附近的位置（基于LBS）\n　　$exists　　      字段是否存在\n　　$elemMatch　　   匹配内数组内的元素\n　　$within　　      范围查询（基于LBS）\n　　$box　　　       范围查询，矩形范围（基于LBS）\n　　$center         范围醒询，圆形范围（基于LBS）\n　　$centerSphere　　范围查询，球形范围（基于LBS）\n　　$slice　　　　    查询字段集合中的元素（比如从第几个之后，第N到第M个元素）\n建索引和设置默认值\n\n```\n    var UserSchema = new Schema({          \n        username : { type: String , index: true},  \n        userpwd: {type: String},                    \n        userage: {type: Number},                   \n        logindate : { type: Date, default:Date.now} \n    });\n```\n　\n\n更多的操作，查询[官方文档](http://www.nodeclass.com/api/mongoose.html#model-js)","source":"_posts/node_mongoose_1.md","raw":"---\nlayout: post\ntitle: \"Node.js系列(mongoose的学习笔记 一)\"\nsubtitle: \"mongoose的基础知识\"\ndate: 2017-12-24\nauthor: \"Ai Shuangying\"\nheader-img: \"hack.jpeg\"\ncdn: 'header-on'\ntags: \n    - Node.js\n    - MongoDB\n---\n\n<!-- LeetCode刷题系列(1)(question 3)\n=================== -->\n\n\n这个系列将记载我在学习Node.js中常用的包相关的内容，作为以后工作中的备忘笔记。\n[官方文档](http://mongoosejs.com/docs/api.html)\n[社区文档](http://www.nodeclass.com/api/mongoose.html)\n\n----------\n\n\n### 安装mongoose\n-------------\n\n```\n    npm install mongoose\n```\n\n### 连接mongoose\n-------------\n\n```\n    var mongoose = require('mongoose');\n\n    mongoose.connect('mongodb://<dbuser>:<dbpassword>@ds147681.mlab.com:47681/aishuangying');\n\n    var db = mongoose.connection;\n\n    db.on('error', console.error.bind(console, 'connection error:'));\n    db.once('open', function (callback) {\n        console.log('connect success');\n    });\n```\n[点击这里](http://www.nodeclass.com/api/mongoose.html#connection-js)文档了解更多connection事件\n\n### Schema\n-------------\nSchema是mongoose的定义表结构的数据模式。\n每个Schema会映射到mongodb中的一个collection，但是它不具备操作数据库的能力。\n定义Schema\n\n```\n    var Schema = mongoose.Schema;         //这里的mongoose就是上面初始化好的mongoose变量\n\n    var OneSchema = new Schema({          \n        username : { type: String },\n        userpwd: {type: String},\n        userage: {type: Number},\n        logindate : { type: Date}\n    });\n```\n[点击这里](http://www.nodeclass.com/api/mongoose.html#schematype-js)文档了解更多Schema类型\n\n### Model\n-------------\n定义好Schema之后生成Model\nmodel是由schema生成的模型，可以对数据库的操作\n我们对上面的定义的user的schema生成一个User的model并导出，修改后代码如下\n\n```\n    var oneModel = mongoose.model('newUser',OneSchema);\n```\n这里的'User'就是数据库中对应的Collection名称\n\n### 常用的数据库操作\n-------------\n\n插入数据库\n\n```\n    function insert() {\n        var one = new oneModel({\n            username : 'Tracy McGrady',                 //用户账号\n            userpwd: 'abcd',                            //密码\n            userage: 37,                                //年龄\n            logindate : new Date(),                      //最近登录时间\n            updateTime : new Date()\n        });\n        one.save(function (err, res) {\n            if (err) {\n                console.log(\"Error:\" + err);\n            }\n            else {\n                console.log(\"Res:\" + res);\n            }\n        });\n    }\n    insert();\n```\n更新数据库\n\n```\n    function update(){\n        var wherestr = {'username' : 'Tracy McGrady'}\n        var updateinfo = {'updateTime' : new Date()};\n        \n        oneModel.update(wherestr, updateinfo , function(err, res){\n            if (err) {\n                console.log(\"Error:\" + err);\n            }\n            else {\n                console.log(\"Res:\" + res);\n            }\n        })\n    }\n    update();\n```\n更新规则，在这类model中按名称来更新updateTime属性。\n查询\n\n```\n    function getByConditions(){\n        var wherestr = {'username' : 'Tracy McGrady'};\n    \n        oneModel.find(wherestr, function(err, res){\n            if (err) {\n                console.log(\"Error:\" + err);\n            }\n            else {\n                console.log(\"Res:\" + res);\n            }\n        })\n    }   \n    getByConditions();\n```\n返回的res为\n```\n    { \n        _id: 5a3f6664b2938f0517a2fa2e,\n        username: 'Tracy McGrady',\n        userpwd: 'abcd',\n        userage: 37,\n        logindate: 2017-12-24T08:33:40.714Z,\n        updateTime: 2017-12-24T08:35:48.898Z,\n        __v: 0 \n    }\n```\n第2个参数可以设置要查询输出的字段,比如 var opt = {\"username\": 1 ,\"_id\": 0};\n返回的res为\n```\n    { username: 'Tracy McGrady' }\n```\n比如我要查询年龄范围条件应该怎么写呢？\n```\n    oneModel.find({userage: {$gte: 21, $lte: 65}}, callback);    //这表示查询年龄大于等21而且小于等于65岁\n```\n其实类似的还有：　\n\n　　$or　　　　       或关系\n　　$nor　　　        或关系取反\n　　$gt　　　　       大于\n　　$gte　　　        大于等于\n　　$lt　　　　       小于\n　　$lte　　　        小于等于\n　　$ne              不等于\n　　$in              在多个值范围内\n　　$nin             不在多个值范围内\n　　$all             匹配数组中多个值\n　　$regex　　        正则，用于模糊查询\n　　$size　　　       匹配数组大小\n　　$maxDistance　   范围查询，距离（基于LBS）\n　　$mod　　         取模运算\n　　$near　　　       邻域查询，查询附近的位置（基于LBS）\n　　$exists　　      字段是否存在\n　　$elemMatch　　   匹配内数组内的元素\n　　$within　　      范围查询（基于LBS）\n　　$box　　　       范围查询，矩形范围（基于LBS）\n　　$center         范围醒询，圆形范围（基于LBS）\n　　$centerSphere　　范围查询，球形范围（基于LBS）\n　　$slice　　　　    查询字段集合中的元素（比如从第几个之后，第N到第M个元素）\n建索引和设置默认值\n\n```\n    var UserSchema = new Schema({          \n        username : { type: String , index: true},  \n        userpwd: {type: String},                    \n        userage: {type: Number},                   \n        logindate : { type: Date, default:Date.now} \n    });\n```\n　\n\n更多的操作，查询[官方文档](http://www.nodeclass.com/api/mongoose.html#model-js)","slug":"node_mongoose_1","published":1,"updated":"2018-01-14T12:21:08.849Z","comments":1,"photos":[],"link":"","_id":"cjciskgdq0004n3farkuz5mof","content":"<!-- LeetCode刷题系列(1)(question 3)\n=================== -->\n<p>这个系列将记载我在学习Node.js中常用的包相关的内容，作为以后工作中的备忘笔记。<br><a href=\"http://mongoosejs.com/docs/api.html\" target=\"_blank\" rel=\"noopener\">官方文档</a><br><a href=\"http://www.nodeclass.com/api/mongoose.html\" target=\"_blank\" rel=\"noopener\">社区文档</a></p>\n<hr>\n<h3 id=\"安装mongoose\"><a href=\"#安装mongoose\" class=\"headerlink\" title=\"安装mongoose\"></a>安装mongoose</h3><hr>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install mongoose</span><br></pre></td></tr></table></figure>\n<h3 id=\"连接mongoose\"><a href=\"#连接mongoose\" class=\"headerlink\" title=\"连接mongoose\"></a>连接mongoose</h3><hr>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var mongoose = require(&apos;mongoose&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">mongoose.connect(&apos;mongodb://&lt;dbuser&gt;:&lt;dbpassword&gt;@ds147681.mlab.com:47681/aishuangying&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">var db = mongoose.connection;</span><br><span class=\"line\"></span><br><span class=\"line\">db.on(&apos;error&apos;, console.error.bind(console, &apos;connection error:&apos;));</span><br><span class=\"line\">db.once(&apos;open&apos;, function (callback) &#123;</span><br><span class=\"line\">    console.log(&apos;connect success&apos;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p><a href=\"http://www.nodeclass.com/api/mongoose.html#connection-js\" target=\"_blank\" rel=\"noopener\">点击这里</a>文档了解更多connection事件</p>\n<h3 id=\"Schema\"><a href=\"#Schema\" class=\"headerlink\" title=\"Schema\"></a>Schema</h3><hr>\n<p>Schema是mongoose的定义表结构的数据模式。<br>每个Schema会映射到mongodb中的一个collection，但是它不具备操作数据库的能力。<br>定义Schema</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var Schema = mongoose.Schema;         //这里的mongoose就是上面初始化好的mongoose变量</span><br><span class=\"line\"></span><br><span class=\"line\">var OneSchema = new Schema(&#123;          </span><br><span class=\"line\">    username : &#123; type: String &#125;,</span><br><span class=\"line\">    userpwd: &#123;type: String&#125;,</span><br><span class=\"line\">    userage: &#123;type: Number&#125;,</span><br><span class=\"line\">    logindate : &#123; type: Date&#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p><a href=\"http://www.nodeclass.com/api/mongoose.html#schematype-js\" target=\"_blank\" rel=\"noopener\">点击这里</a>文档了解更多Schema类型</p>\n<h3 id=\"Model\"><a href=\"#Model\" class=\"headerlink\" title=\"Model\"></a>Model</h3><hr>\n<p>定义好Schema之后生成Model<br>model是由schema生成的模型，可以对数据库的操作<br>我们对上面的定义的user的schema生成一个User的model并导出，修改后代码如下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var oneModel = mongoose.model(&apos;newUser&apos;,OneSchema);</span><br></pre></td></tr></table></figure>\n<p>这里的’User’就是数据库中对应的Collection名称</p>\n<h3 id=\"常用的数据库操作\"><a href=\"#常用的数据库操作\" class=\"headerlink\" title=\"常用的数据库操作\"></a>常用的数据库操作</h3><hr>\n<p>插入数据库</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function insert() &#123;</span><br><span class=\"line\">    var one = new oneModel(&#123;</span><br><span class=\"line\">        username : &apos;Tracy McGrady&apos;,                 //用户账号</span><br><span class=\"line\">        userpwd: &apos;abcd&apos;,                            //密码</span><br><span class=\"line\">        userage: 37,                                //年龄</span><br><span class=\"line\">        logindate : new Date(),                      //最近登录时间</span><br><span class=\"line\">        updateTime : new Date()</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    one.save(function (err, res) &#123;</span><br><span class=\"line\">        if (err) &#123;</span><br><span class=\"line\">            console.log(&quot;Error:&quot; + err);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        else &#123;</span><br><span class=\"line\">            console.log(&quot;Res:&quot; + res);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">insert();</span><br></pre></td></tr></table></figure>\n<p>更新数据库</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function update()&#123;</span><br><span class=\"line\">    var wherestr = &#123;&apos;username&apos; : &apos;Tracy McGrady&apos;&#125;</span><br><span class=\"line\">    var updateinfo = &#123;&apos;updateTime&apos; : new Date()&#125;;</span><br><span class=\"line\">    </span><br><span class=\"line\">    oneModel.update(wherestr, updateinfo , function(err, res)&#123;</span><br><span class=\"line\">        if (err) &#123;</span><br><span class=\"line\">            console.log(&quot;Error:&quot; + err);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        else &#123;</span><br><span class=\"line\">            console.log(&quot;Res:&quot; + res);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">update();</span><br></pre></td></tr></table></figure>\n<p>更新规则，在这类model中按名称来更新updateTime属性。<br>查询</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function getByConditions()&#123;</span><br><span class=\"line\">    var wherestr = &#123;&apos;username&apos; : &apos;Tracy McGrady&apos;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    oneModel.find(wherestr, function(err, res)&#123;</span><br><span class=\"line\">        if (err) &#123;</span><br><span class=\"line\">            console.log(&quot;Error:&quot; + err);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        else &#123;</span><br><span class=\"line\">            console.log(&quot;Res:&quot; + res);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;   </span><br><span class=\"line\">getByConditions();</span><br></pre></td></tr></table></figure>\n<p>返回的res为<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123; </span><br><span class=\"line\">    _id: 5a3f6664b2938f0517a2fa2e,</span><br><span class=\"line\">    username: &apos;Tracy McGrady&apos;,</span><br><span class=\"line\">    userpwd: &apos;abcd&apos;,</span><br><span class=\"line\">    userage: 37,</span><br><span class=\"line\">    logindate: 2017-12-24T08:33:40.714Z,</span><br><span class=\"line\">    updateTime: 2017-12-24T08:35:48.898Z,</span><br><span class=\"line\">    __v: 0 </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>第2个参数可以设置要查询输出的字段,比如 var opt = {“username”: 1 ,”_id”: 0};<br>返回的res为<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123; username: &apos;Tracy McGrady&apos; &#125;</span><br></pre></td></tr></table></figure></p>\n<p>比如我要查询年龄范围条件应该怎么写呢？<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">oneModel.find(&#123;userage: &#123;$gte: 21, $lte: 65&#125;&#125;, callback);    //这表示查询年龄大于等21而且小于等于65岁</span><br></pre></td></tr></table></figure></p>\n<p>其实类似的还有：　</p>\n<p>　　$or　　　　       或关系<br>　　$nor　　　        或关系取反<br>　　$gt　　　　       大于<br>　　$gte　　　        大于等于<br>　　$lt　　　　       小于<br>　　$lte　　　        小于等于<br>　　$ne              不等于<br>　　$in              在多个值范围内<br>　　$nin             不在多个值范围内<br>　　$all             匹配数组中多个值<br>　　$regex　　        正则，用于模糊查询<br>　　$size　　　       匹配数组大小<br>　　$maxDistance　   范围查询，距离（基于LBS）<br>　　$mod　　         取模运算<br>　　$near　　　       邻域查询，查询附近的位置（基于LBS）<br>　　$exists　　      字段是否存在<br>　　$elemMatch　　   匹配内数组内的元素<br>　　$within　　      范围查询（基于LBS）<br>　　$box　　　       范围查询，矩形范围（基于LBS）<br>　　$center         范围醒询，圆形范围（基于LBS）<br>　　$centerSphere　　范围查询，球形范围（基于LBS）<br>　　$slice　　　　    查询字段集合中的元素（比如从第几个之后，第N到第M个元素）<br>建索引和设置默认值</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var UserSchema = new Schema(&#123;          </span><br><span class=\"line\">    username : &#123; type: String , index: true&#125;,  </span><br><span class=\"line\">    userpwd: &#123;type: String&#125;,                    </span><br><span class=\"line\">    userage: &#123;type: Number&#125;,                   </span><br><span class=\"line\">    logindate : &#123; type: Date, default:Date.now&#125; </span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>　</p>\n<p>更多的操作，查询<a href=\"http://www.nodeclass.com/api/mongoose.html#model-js\" target=\"_blank\" rel=\"noopener\">官方文档</a></p>\n","site":{"data":{}},"excerpt":"","more":"<!-- LeetCode刷题系列(1)(question 3)\n=================== -->\n<p>这个系列将记载我在学习Node.js中常用的包相关的内容，作为以后工作中的备忘笔记。<br><a href=\"http://mongoosejs.com/docs/api.html\" target=\"_blank\" rel=\"noopener\">官方文档</a><br><a href=\"http://www.nodeclass.com/api/mongoose.html\" target=\"_blank\" rel=\"noopener\">社区文档</a></p>\n<hr>\n<h3 id=\"安装mongoose\"><a href=\"#安装mongoose\" class=\"headerlink\" title=\"安装mongoose\"></a>安装mongoose</h3><hr>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install mongoose</span><br></pre></td></tr></table></figure>\n<h3 id=\"连接mongoose\"><a href=\"#连接mongoose\" class=\"headerlink\" title=\"连接mongoose\"></a>连接mongoose</h3><hr>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var mongoose = require(&apos;mongoose&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">mongoose.connect(&apos;mongodb://&lt;dbuser&gt;:&lt;dbpassword&gt;@ds147681.mlab.com:47681/aishuangying&apos;);</span><br><span class=\"line\"></span><br><span class=\"line\">var db = mongoose.connection;</span><br><span class=\"line\"></span><br><span class=\"line\">db.on(&apos;error&apos;, console.error.bind(console, &apos;connection error:&apos;));</span><br><span class=\"line\">db.once(&apos;open&apos;, function (callback) &#123;</span><br><span class=\"line\">    console.log(&apos;connect success&apos;);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p><a href=\"http://www.nodeclass.com/api/mongoose.html#connection-js\" target=\"_blank\" rel=\"noopener\">点击这里</a>文档了解更多connection事件</p>\n<h3 id=\"Schema\"><a href=\"#Schema\" class=\"headerlink\" title=\"Schema\"></a>Schema</h3><hr>\n<p>Schema是mongoose的定义表结构的数据模式。<br>每个Schema会映射到mongodb中的一个collection，但是它不具备操作数据库的能力。<br>定义Schema</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var Schema = mongoose.Schema;         //这里的mongoose就是上面初始化好的mongoose变量</span><br><span class=\"line\"></span><br><span class=\"line\">var OneSchema = new Schema(&#123;          </span><br><span class=\"line\">    username : &#123; type: String &#125;,</span><br><span class=\"line\">    userpwd: &#123;type: String&#125;,</span><br><span class=\"line\">    userage: &#123;type: Number&#125;,</span><br><span class=\"line\">    logindate : &#123; type: Date&#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p><a href=\"http://www.nodeclass.com/api/mongoose.html#schematype-js\" target=\"_blank\" rel=\"noopener\">点击这里</a>文档了解更多Schema类型</p>\n<h3 id=\"Model\"><a href=\"#Model\" class=\"headerlink\" title=\"Model\"></a>Model</h3><hr>\n<p>定义好Schema之后生成Model<br>model是由schema生成的模型，可以对数据库的操作<br>我们对上面的定义的user的schema生成一个User的model并导出，修改后代码如下</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var oneModel = mongoose.model(&apos;newUser&apos;,OneSchema);</span><br></pre></td></tr></table></figure>\n<p>这里的’User’就是数据库中对应的Collection名称</p>\n<h3 id=\"常用的数据库操作\"><a href=\"#常用的数据库操作\" class=\"headerlink\" title=\"常用的数据库操作\"></a>常用的数据库操作</h3><hr>\n<p>插入数据库</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function insert() &#123;</span><br><span class=\"line\">    var one = new oneModel(&#123;</span><br><span class=\"line\">        username : &apos;Tracy McGrady&apos;,                 //用户账号</span><br><span class=\"line\">        userpwd: &apos;abcd&apos;,                            //密码</span><br><span class=\"line\">        userage: 37,                                //年龄</span><br><span class=\"line\">        logindate : new Date(),                      //最近登录时间</span><br><span class=\"line\">        updateTime : new Date()</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    one.save(function (err, res) &#123;</span><br><span class=\"line\">        if (err) &#123;</span><br><span class=\"line\">            console.log(&quot;Error:&quot; + err);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        else &#123;</span><br><span class=\"line\">            console.log(&quot;Res:&quot; + res);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">insert();</span><br></pre></td></tr></table></figure>\n<p>更新数据库</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function update()&#123;</span><br><span class=\"line\">    var wherestr = &#123;&apos;username&apos; : &apos;Tracy McGrady&apos;&#125;</span><br><span class=\"line\">    var updateinfo = &#123;&apos;updateTime&apos; : new Date()&#125;;</span><br><span class=\"line\">    </span><br><span class=\"line\">    oneModel.update(wherestr, updateinfo , function(err, res)&#123;</span><br><span class=\"line\">        if (err) &#123;</span><br><span class=\"line\">            console.log(&quot;Error:&quot; + err);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        else &#123;</span><br><span class=\"line\">            console.log(&quot;Res:&quot; + res);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">update();</span><br></pre></td></tr></table></figure>\n<p>更新规则，在这类model中按名称来更新updateTime属性。<br>查询</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function getByConditions()&#123;</span><br><span class=\"line\">    var wherestr = &#123;&apos;username&apos; : &apos;Tracy McGrady&apos;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    oneModel.find(wherestr, function(err, res)&#123;</span><br><span class=\"line\">        if (err) &#123;</span><br><span class=\"line\">            console.log(&quot;Error:&quot; + err);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        else &#123;</span><br><span class=\"line\">            console.log(&quot;Res:&quot; + res);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;   </span><br><span class=\"line\">getByConditions();</span><br></pre></td></tr></table></figure>\n<p>返回的res为<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123; </span><br><span class=\"line\">    _id: 5a3f6664b2938f0517a2fa2e,</span><br><span class=\"line\">    username: &apos;Tracy McGrady&apos;,</span><br><span class=\"line\">    userpwd: &apos;abcd&apos;,</span><br><span class=\"line\">    userage: 37,</span><br><span class=\"line\">    logindate: 2017-12-24T08:33:40.714Z,</span><br><span class=\"line\">    updateTime: 2017-12-24T08:35:48.898Z,</span><br><span class=\"line\">    __v: 0 </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>第2个参数可以设置要查询输出的字段,比如 var opt = {“username”: 1 ,”_id”: 0};<br>返回的res为<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123; username: &apos;Tracy McGrady&apos; &#125;</span><br></pre></td></tr></table></figure></p>\n<p>比如我要查询年龄范围条件应该怎么写呢？<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">oneModel.find(&#123;userage: &#123;$gte: 21, $lte: 65&#125;&#125;, callback);    //这表示查询年龄大于等21而且小于等于65岁</span><br></pre></td></tr></table></figure></p>\n<p>其实类似的还有：　</p>\n<p>　　$or　　　　       或关系<br>　　$nor　　　        或关系取反<br>　　$gt　　　　       大于<br>　　$gte　　　        大于等于<br>　　$lt　　　　       小于<br>　　$lte　　　        小于等于<br>　　$ne              不等于<br>　　$in              在多个值范围内<br>　　$nin             不在多个值范围内<br>　　$all             匹配数组中多个值<br>　　$regex　　        正则，用于模糊查询<br>　　$size　　　       匹配数组大小<br>　　$maxDistance　   范围查询，距离（基于LBS）<br>　　$mod　　         取模运算<br>　　$near　　　       邻域查询，查询附近的位置（基于LBS）<br>　　$exists　　      字段是否存在<br>　　$elemMatch　　   匹配内数组内的元素<br>　　$within　　      范围查询（基于LBS）<br>　　$box　　　       范围查询，矩形范围（基于LBS）<br>　　$center         范围醒询，圆形范围（基于LBS）<br>　　$centerSphere　　范围查询，球形范围（基于LBS）<br>　　$slice　　　　    查询字段集合中的元素（比如从第几个之后，第N到第M个元素）<br>建索引和设置默认值</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var UserSchema = new Schema(&#123;          </span><br><span class=\"line\">    username : &#123; type: String , index: true&#125;,  </span><br><span class=\"line\">    userpwd: &#123;type: String&#125;,                    </span><br><span class=\"line\">    userage: &#123;type: Number&#125;,                   </span><br><span class=\"line\">    logindate : &#123; type: Date, default:Date.now&#125; </span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>　</p>\n<p>更多的操作，查询<a href=\"http://www.nodeclass.com/api/mongoose.html#model-js\" target=\"_blank\" rel=\"noopener\">官方文档</a></p>\n"},{"layout":"post","title":"San学习笔记 一","subtitle":"基本用法","date":"2018-01-04T16:00:00.000Z","author":"Ai Shuangying","header-img":"hack.jpeg","cdn":"header-on","_content":"\n\n最近关注了一个极简MVVM框架San，翻了一遍San的文档，做些笔记。\n[中文文档](https://ecomfe.github.io/san/tutorial/start/)\n\n----------\n\n### 数据相关\n-------------\n\n\n```\n    var MyApp = san.defineComponent({\n\t    template: '<p>Hello {{name}}!</p>',\n\n\t    initData: function () {\n\t        return {\n\t            name: 'San'\n\t        };\n\t    }\n\t});\n\n\tvar myApp = new MyApp();\n\tmyApp.attach(document.body);\n```\n\n可以看到，通常情况实用 San 会经过这么几步：\n\n* 我们先定义了一个 San 的组件，在定义时指定了组件的 内容模板 与 初始数据 。\n* 初始化组件对象\n* 让组件在相应的地方渲染\n\n列表渲染(s-for)\n\n```\n    var MyApp = san.defineComponent({\n\t    template: '<ul><li s-for=\"item in list\">{{item}}</li></ul>',\n\n\t    attached: function () {\n\t        this.data.set('list', ['san', 'er', 'esui', 'etpl', 'esl']);\n\t    }\n\t});\n\n\tvar myApp = new MyApp();\n\tmyApp.attach(document.body);\n```\n\n列表渲染(s-if)\n\nSan 的条件判断不是严格的 === false。所以，一切 JavaScript 的假值都会认为条件不成立：0、空字符串、null、undefined、NaN等。\n\n```\n    <span s-if=\"isOK\">Hello San!</span>\n```\n\ns-elif 指令可以给 s-if 增加一个额外条件分支块。s-elif 指令的值可以是任何类型的表达式。\n\n```\n    <span s-if=\"isActive\">Active</span>\n\t<span s-elif=\"isOnline\">Pending</span>\n\t<span s-else>Offline</span>\n```\n\n虚拟元素 template ，在渲染时不会包含自身，只会渲染其内容。\n\n```\n    <template s-if=\"num > 10000\">\n        <h2>biiig</h2>\n        <p>{{num}}</p>\n    </template>\n```\n\n\n#### 数据的绑定\n\n双向绑定({=  =})\n\n```\n    var MyApp = san.defineComponent({\n\t    template: ''\n\t        + '<div>'\n\t        +   '<input value=\"{= name =}\" placeholder=\"please input\">'\n\t        +   'Hello {{name}}!'\n\t        + '</div>'\n\t});\n\n\tvar myApp = new MyApp();\n\tmyApp.attach(document.body);\n\n\t<input type=\"text\" value=\"{= name =}\">\n\n\t<select value=\"{= online =}\">\n\t    <option value=\"errorrik\">errorrik</option>\n\t    <option value=\"otakustay\">otakustay</option>\n\t    <option value=\"firede\">firede</option>\n\t</select>\n```\n\n属性绑定\n\n```\n    <ui-label text=\"{{jokeName}}\"></ui-label>\n```\n\n输出原封不动的 HTML，不希望经过 HTML 转义。\n\n```\n    <p s-html=\"rawHTML\"></p>    //通过指令 s-html\n\t<p>{{rawHTML | raw}}</p>\t//通过过滤器raw\n```\n\n\n#### 数据的操作\n-------------\n\ninitData 方法：可以在定义组件时指定组件初始化时的数据。initData 方法返回组件实例的初始化数据。\n\n```\n    san.defineComponent({\n\t    initData: function () {\n\t        return {\n\t            width: 200,\n\t            top: 100,\n\t            left: -1000\n\t        };\n\t    }\n\t});\n```\n\nset 方法：是最常用的操作数据的方法，作用相当于 JavaScript 中的赋值 (=)。\n\n```\n    san.defineComponent({\n\t    attached: function () {\n\t        requestUser().then(this.userReceived.bind(this));\n\t    },\n\n\t    userReceived: function (data) {\n\t        this.data.set('user', data);\n\t    },\n\n\t    changeEmail: function (email) {\n\t        this.data.set('user.email', email);\n\t    }\n\t});\n```\n\nmerge 方法：将目标数据对象（target）和传入数据对象（source）的键进行合并。\n\n```\n    san.defineComponent({\n\t    attached: function () {\n\t        requestUser().then(this.updateUserInfo.bind(this));\n\t    },\n\n\t    updateUserInfo: function (data) {\n\t        this.data.merge('user', data);\n\t    }\n\t});\n```\n\napply 方法：接受一个函数作为参数，传入当前的值到函数，然后用新返回的值更新它。\n\n```\n    san.defineComponent({\n\t    attached: function () {\n\t        this.data.set('number', {\n\t            value: 1\n\t        });\n\t        this.updateNumber();\n\t    },\n\n\t    updateNumber: function (data) {\n\t        this.data.apply('number', function (number) {\n\t            return {\n\t                value: number.value * 2\n\t            };\n\t        })\n\t    }\n\t});\n```\n\n还有一些数组方法：\n\n修改数组项还是直接使用 set 方法。\n\npush：在数组末尾插入一条数据。\n\n```\n    san.defineComponent({\n\t    addUser: function (name) {\n\t        this.data.push('users', {name: name});\n\t    }\n\t});\n```\n\npop：在数组末尾弹出一条数据。\n\n```\n    san.defineComponent({\n\t    rmLast: function () {\n\t        this.data.pop('users');\n\t    }\n\t});\n```\n\nunshift：在数组开始插入一条数据。\n\n```\n    san.defineComponent({\n\t    addUser: function (name) {\n\t        this.data.unshift('users', {name: name});\n\t    }\n\t});\n```\n\nshift：在数组开始弹出一条数据。\n\n```\n    san.defineComponent({\n\t    rmFirst: function () {\n\t        this.data.shift('users');\n\t    }\n\t});\n```\n\nremove：移除一条数据。只有当数组项与传入项完全相等(===)时，数组项才会被移除。\n\n```\n    san.defineComponent({\n\t    rm: function (user) {\n\t        this.data.remove('users', user);\n\t    }\n\t});\n```\n\nremoveAt：通过数据项的索引移除一条数据。\n\n```\n    san.defineComponent({\n\t    rmAt: function (index) {\n\t        this.data.removeAt('users', index);\n\t    }\n\t});\n```\n\nsplice：向数组中添加或删除项目。\n\n```\n    san.defineComponent({\n\t    rm: function (index, deleteCount) {\n\t        this.data.splice('users', [index, deleteCount]);\n\t    }\n\t});\n```\n\n\n#### 数据的校验\n-------------\n\n指定校验规则，需要使用 DataTypes 进行声明：\n\n```\n    import san, {DataTypes} from 'san';\n\n\tlet MyComponent = san.defineComponent({\n\n\t    dataTypes: {\n\t        name: DataTypes.string\n\t    }\n\n\t});\n```\n\n","source":"_posts/san1.md","raw":"---\nlayout: post\ntitle: \"San学习笔记 一\"\nsubtitle: \"基本用法\"\ndate: 2018-1-5\nauthor: \"Ai Shuangying\"\nheader-img: \"hack.jpeg\"\ncdn: 'header-on'\ntags: \n    - San\n---\n\n\n最近关注了一个极简MVVM框架San，翻了一遍San的文档，做些笔记。\n[中文文档](https://ecomfe.github.io/san/tutorial/start/)\n\n----------\n\n### 数据相关\n-------------\n\n\n```\n    var MyApp = san.defineComponent({\n\t    template: '<p>Hello {{name}}!</p>',\n\n\t    initData: function () {\n\t        return {\n\t            name: 'San'\n\t        };\n\t    }\n\t});\n\n\tvar myApp = new MyApp();\n\tmyApp.attach(document.body);\n```\n\n可以看到，通常情况实用 San 会经过这么几步：\n\n* 我们先定义了一个 San 的组件，在定义时指定了组件的 内容模板 与 初始数据 。\n* 初始化组件对象\n* 让组件在相应的地方渲染\n\n列表渲染(s-for)\n\n```\n    var MyApp = san.defineComponent({\n\t    template: '<ul><li s-for=\"item in list\">{{item}}</li></ul>',\n\n\t    attached: function () {\n\t        this.data.set('list', ['san', 'er', 'esui', 'etpl', 'esl']);\n\t    }\n\t});\n\n\tvar myApp = new MyApp();\n\tmyApp.attach(document.body);\n```\n\n列表渲染(s-if)\n\nSan 的条件判断不是严格的 === false。所以，一切 JavaScript 的假值都会认为条件不成立：0、空字符串、null、undefined、NaN等。\n\n```\n    <span s-if=\"isOK\">Hello San!</span>\n```\n\ns-elif 指令可以给 s-if 增加一个额外条件分支块。s-elif 指令的值可以是任何类型的表达式。\n\n```\n    <span s-if=\"isActive\">Active</span>\n\t<span s-elif=\"isOnline\">Pending</span>\n\t<span s-else>Offline</span>\n```\n\n虚拟元素 template ，在渲染时不会包含自身，只会渲染其内容。\n\n```\n    <template s-if=\"num > 10000\">\n        <h2>biiig</h2>\n        <p>{{num}}</p>\n    </template>\n```\n\n\n#### 数据的绑定\n\n双向绑定({=  =})\n\n```\n    var MyApp = san.defineComponent({\n\t    template: ''\n\t        + '<div>'\n\t        +   '<input value=\"{= name =}\" placeholder=\"please input\">'\n\t        +   'Hello {{name}}!'\n\t        + '</div>'\n\t});\n\n\tvar myApp = new MyApp();\n\tmyApp.attach(document.body);\n\n\t<input type=\"text\" value=\"{= name =}\">\n\n\t<select value=\"{= online =}\">\n\t    <option value=\"errorrik\">errorrik</option>\n\t    <option value=\"otakustay\">otakustay</option>\n\t    <option value=\"firede\">firede</option>\n\t</select>\n```\n\n属性绑定\n\n```\n    <ui-label text=\"{{jokeName}}\"></ui-label>\n```\n\n输出原封不动的 HTML，不希望经过 HTML 转义。\n\n```\n    <p s-html=\"rawHTML\"></p>    //通过指令 s-html\n\t<p>{{rawHTML | raw}}</p>\t//通过过滤器raw\n```\n\n\n#### 数据的操作\n-------------\n\ninitData 方法：可以在定义组件时指定组件初始化时的数据。initData 方法返回组件实例的初始化数据。\n\n```\n    san.defineComponent({\n\t    initData: function () {\n\t        return {\n\t            width: 200,\n\t            top: 100,\n\t            left: -1000\n\t        };\n\t    }\n\t});\n```\n\nset 方法：是最常用的操作数据的方法，作用相当于 JavaScript 中的赋值 (=)。\n\n```\n    san.defineComponent({\n\t    attached: function () {\n\t        requestUser().then(this.userReceived.bind(this));\n\t    },\n\n\t    userReceived: function (data) {\n\t        this.data.set('user', data);\n\t    },\n\n\t    changeEmail: function (email) {\n\t        this.data.set('user.email', email);\n\t    }\n\t});\n```\n\nmerge 方法：将目标数据对象（target）和传入数据对象（source）的键进行合并。\n\n```\n    san.defineComponent({\n\t    attached: function () {\n\t        requestUser().then(this.updateUserInfo.bind(this));\n\t    },\n\n\t    updateUserInfo: function (data) {\n\t        this.data.merge('user', data);\n\t    }\n\t});\n```\n\napply 方法：接受一个函数作为参数，传入当前的值到函数，然后用新返回的值更新它。\n\n```\n    san.defineComponent({\n\t    attached: function () {\n\t        this.data.set('number', {\n\t            value: 1\n\t        });\n\t        this.updateNumber();\n\t    },\n\n\t    updateNumber: function (data) {\n\t        this.data.apply('number', function (number) {\n\t            return {\n\t                value: number.value * 2\n\t            };\n\t        })\n\t    }\n\t});\n```\n\n还有一些数组方法：\n\n修改数组项还是直接使用 set 方法。\n\npush：在数组末尾插入一条数据。\n\n```\n    san.defineComponent({\n\t    addUser: function (name) {\n\t        this.data.push('users', {name: name});\n\t    }\n\t});\n```\n\npop：在数组末尾弹出一条数据。\n\n```\n    san.defineComponent({\n\t    rmLast: function () {\n\t        this.data.pop('users');\n\t    }\n\t});\n```\n\nunshift：在数组开始插入一条数据。\n\n```\n    san.defineComponent({\n\t    addUser: function (name) {\n\t        this.data.unshift('users', {name: name});\n\t    }\n\t});\n```\n\nshift：在数组开始弹出一条数据。\n\n```\n    san.defineComponent({\n\t    rmFirst: function () {\n\t        this.data.shift('users');\n\t    }\n\t});\n```\n\nremove：移除一条数据。只有当数组项与传入项完全相等(===)时，数组项才会被移除。\n\n```\n    san.defineComponent({\n\t    rm: function (user) {\n\t        this.data.remove('users', user);\n\t    }\n\t});\n```\n\nremoveAt：通过数据项的索引移除一条数据。\n\n```\n    san.defineComponent({\n\t    rmAt: function (index) {\n\t        this.data.removeAt('users', index);\n\t    }\n\t});\n```\n\nsplice：向数组中添加或删除项目。\n\n```\n    san.defineComponent({\n\t    rm: function (index, deleteCount) {\n\t        this.data.splice('users', [index, deleteCount]);\n\t    }\n\t});\n```\n\n\n#### 数据的校验\n-------------\n\n指定校验规则，需要使用 DataTypes 进行声明：\n\n```\n    import san, {DataTypes} from 'san';\n\n\tlet MyComponent = san.defineComponent({\n\n\t    dataTypes: {\n\t        name: DataTypes.string\n\t    }\n\n\t});\n```\n\n","slug":"san1","published":1,"updated":"2018-01-28T07:49:39.007Z","_id":"cjcvor88n0000jjfalz106v6h","comments":1,"photos":[],"link":"","content":"<p>最近关注了一个极简MVVM框架San，翻了一遍San的文档，做些笔记。<br><a href=\"https://ecomfe.github.io/san/tutorial/start/\" target=\"_blank\" rel=\"noopener\">中文文档</a></p>\n<hr>\n<h3 id=\"数据相关\"><a href=\"#数据相关\" class=\"headerlink\" title=\"数据相关\"></a>数据相关</h3><hr>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   var MyApp = san.defineComponent(&#123;</span><br><span class=\"line\">    template: &apos;&lt;p&gt;Hello &#123;&#123;name&#125;&#125;!&lt;/p&gt;&apos;,</span><br><span class=\"line\"></span><br><span class=\"line\">    initData: function () &#123;</span><br><span class=\"line\">        return &#123;</span><br><span class=\"line\">            name: &apos;San&apos;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">var myApp = new MyApp();</span><br><span class=\"line\">myApp.attach(document.body);</span><br></pre></td></tr></table></figure>\n<p>可以看到，通常情况实用 San 会经过这么几步：</p>\n<ul>\n<li>我们先定义了一个 San 的组件，在定义时指定了组件的 内容模板 与 初始数据 。</li>\n<li>初始化组件对象</li>\n<li>让组件在相应的地方渲染</li>\n</ul>\n<p>列表渲染(s-for)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   var MyApp = san.defineComponent(&#123;</span><br><span class=\"line\">    template: &apos;&lt;ul&gt;&lt;li s-for=&quot;item in list&quot;&gt;&#123;&#123;item&#125;&#125;&lt;/li&gt;&lt;/ul&gt;&apos;,</span><br><span class=\"line\"></span><br><span class=\"line\">    attached: function () &#123;</span><br><span class=\"line\">        this.data.set(&apos;list&apos;, [&apos;san&apos;, &apos;er&apos;, &apos;esui&apos;, &apos;etpl&apos;, &apos;esl&apos;]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">var myApp = new MyApp();</span><br><span class=\"line\">myApp.attach(document.body);</span><br></pre></td></tr></table></figure>\n<p>列表渲染(s-if)</p>\n<p>San 的条件判断不是严格的 === false。所以，一切 JavaScript 的假值都会认为条件不成立：0、空字符串、null、undefined、NaN等。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;span s-if=&quot;isOK&quot;&gt;Hello San!&lt;/span&gt;</span><br></pre></td></tr></table></figure>\n<p>s-elif 指令可以给 s-if 增加一个额外条件分支块。s-elif 指令的值可以是任何类型的表达式。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   &lt;span s-if=&quot;isActive&quot;&gt;Active&lt;/span&gt;</span><br><span class=\"line\">&lt;span s-elif=&quot;isOnline&quot;&gt;Pending&lt;/span&gt;</span><br><span class=\"line\">&lt;span s-else&gt;Offline&lt;/span&gt;</span><br></pre></td></tr></table></figure>\n<p>虚拟元素 template ，在渲染时不会包含自身，只会渲染其内容。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template s-if=&quot;num &gt; 10000&quot;&gt;</span><br><span class=\"line\">    &lt;h2&gt;biiig&lt;/h2&gt;</span><br><span class=\"line\">    &lt;p&gt;&#123;&#123;num&#125;&#125;&lt;/p&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br></pre></td></tr></table></figure>\n<h4 id=\"数据的绑定\"><a href=\"#数据的绑定\" class=\"headerlink\" title=\"数据的绑定\"></a>数据的绑定</h4><p>双向绑定({=  =})</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   var MyApp = san.defineComponent(&#123;</span><br><span class=\"line\">    template: &apos;&apos;</span><br><span class=\"line\">        + &apos;&lt;div&gt;&apos;</span><br><span class=\"line\">        +   &apos;&lt;input value=&quot;&#123;= name =&#125;&quot; placeholder=&quot;please input&quot;&gt;&apos;</span><br><span class=\"line\">        +   &apos;Hello &#123;&#123;name&#125;&#125;!&apos;</span><br><span class=\"line\">        + &apos;&lt;/div&gt;&apos;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">var myApp = new MyApp();</span><br><span class=\"line\">myApp.attach(document.body);</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;input type=&quot;text&quot; value=&quot;&#123;= name =&#125;&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;select value=&quot;&#123;= online =&#125;&quot;&gt;</span><br><span class=\"line\">    &lt;option value=&quot;errorrik&quot;&gt;errorrik&lt;/option&gt;</span><br><span class=\"line\">    &lt;option value=&quot;otakustay&quot;&gt;otakustay&lt;/option&gt;</span><br><span class=\"line\">    &lt;option value=&quot;firede&quot;&gt;firede&lt;/option&gt;</span><br><span class=\"line\">&lt;/select&gt;</span><br></pre></td></tr></table></figure>\n<p>属性绑定</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;ui-label text=&quot;&#123;&#123;jokeName&#125;&#125;&quot;&gt;&lt;/ui-label&gt;</span><br></pre></td></tr></table></figure>\n<p>输出原封不动的 HTML，不希望经过 HTML 转义。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   &lt;p s-html=&quot;rawHTML&quot;&gt;&lt;/p&gt;    //通过指令 s-html</span><br><span class=\"line\">&lt;p&gt;&#123;&#123;rawHTML | raw&#125;&#125;&lt;/p&gt;\t//通过过滤器raw</span><br></pre></td></tr></table></figure>\n<h4 id=\"数据的操作\"><a href=\"#数据的操作\" class=\"headerlink\" title=\"数据的操作\"></a>数据的操作</h4><hr>\n<p>initData 方法：可以在定义组件时指定组件初始化时的数据。initData 方法返回组件实例的初始化数据。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   san.defineComponent(&#123;</span><br><span class=\"line\">    initData: function () &#123;</span><br><span class=\"line\">        return &#123;</span><br><span class=\"line\">            width: 200,</span><br><span class=\"line\">            top: 100,</span><br><span class=\"line\">            left: -1000</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>set 方法：是最常用的操作数据的方法，作用相当于 JavaScript 中的赋值 (=)。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   san.defineComponent(&#123;</span><br><span class=\"line\">    attached: function () &#123;</span><br><span class=\"line\">        requestUser().then(this.userReceived.bind(this));</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    userReceived: function (data) &#123;</span><br><span class=\"line\">        this.data.set(&apos;user&apos;, data);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    changeEmail: function (email) &#123;</span><br><span class=\"line\">        this.data.set(&apos;user.email&apos;, email);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>merge 方法：将目标数据对象（target）和传入数据对象（source）的键进行合并。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   san.defineComponent(&#123;</span><br><span class=\"line\">    attached: function () &#123;</span><br><span class=\"line\">        requestUser().then(this.updateUserInfo.bind(this));</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    updateUserInfo: function (data) &#123;</span><br><span class=\"line\">        this.data.merge(&apos;user&apos;, data);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>apply 方法：接受一个函数作为参数，传入当前的值到函数，然后用新返回的值更新它。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   san.defineComponent(&#123;</span><br><span class=\"line\">    attached: function () &#123;</span><br><span class=\"line\">        this.data.set(&apos;number&apos;, &#123;</span><br><span class=\"line\">            value: 1</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        this.updateNumber();</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    updateNumber: function (data) &#123;</span><br><span class=\"line\">        this.data.apply(&apos;number&apos;, function (number) &#123;</span><br><span class=\"line\">            return &#123;</span><br><span class=\"line\">                value: number.value * 2</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>还有一些数组方法：</p>\n<p>修改数组项还是直接使用 set 方法。</p>\n<p>push：在数组末尾插入一条数据。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   san.defineComponent(&#123;</span><br><span class=\"line\">    addUser: function (name) &#123;</span><br><span class=\"line\">        this.data.push(&apos;users&apos;, &#123;name: name&#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>pop：在数组末尾弹出一条数据。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   san.defineComponent(&#123;</span><br><span class=\"line\">    rmLast: function () &#123;</span><br><span class=\"line\">        this.data.pop(&apos;users&apos;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>unshift：在数组开始插入一条数据。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   san.defineComponent(&#123;</span><br><span class=\"line\">    addUser: function (name) &#123;</span><br><span class=\"line\">        this.data.unshift(&apos;users&apos;, &#123;name: name&#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>shift：在数组开始弹出一条数据。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   san.defineComponent(&#123;</span><br><span class=\"line\">    rmFirst: function () &#123;</span><br><span class=\"line\">        this.data.shift(&apos;users&apos;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>remove：移除一条数据。只有当数组项与传入项完全相等(===)时，数组项才会被移除。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   san.defineComponent(&#123;</span><br><span class=\"line\">    rm: function (user) &#123;</span><br><span class=\"line\">        this.data.remove(&apos;users&apos;, user);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>removeAt：通过数据项的索引移除一条数据。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   san.defineComponent(&#123;</span><br><span class=\"line\">    rmAt: function (index) &#123;</span><br><span class=\"line\">        this.data.removeAt(&apos;users&apos;, index);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>splice：向数组中添加或删除项目。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   san.defineComponent(&#123;</span><br><span class=\"line\">    rm: function (index, deleteCount) &#123;</span><br><span class=\"line\">        this.data.splice(&apos;users&apos;, [index, deleteCount]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h4 id=\"数据的校验\"><a href=\"#数据的校验\" class=\"headerlink\" title=\"数据的校验\"></a>数据的校验</h4><hr>\n<p>指定校验规则，需要使用 DataTypes 进行声明：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   import san, &#123;DataTypes&#125; from &apos;san&apos;;</span><br><span class=\"line\"></span><br><span class=\"line\">let MyComponent = san.defineComponent(&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    dataTypes: &#123;</span><br><span class=\"line\">        name: DataTypes.string</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"","more":"<p>最近关注了一个极简MVVM框架San，翻了一遍San的文档，做些笔记。<br><a href=\"https://ecomfe.github.io/san/tutorial/start/\" target=\"_blank\" rel=\"noopener\">中文文档</a></p>\n<hr>\n<h3 id=\"数据相关\"><a href=\"#数据相关\" class=\"headerlink\" title=\"数据相关\"></a>数据相关</h3><hr>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   var MyApp = san.defineComponent(&#123;</span><br><span class=\"line\">    template: &apos;&lt;p&gt;Hello &#123;&#123;name&#125;&#125;!&lt;/p&gt;&apos;,</span><br><span class=\"line\"></span><br><span class=\"line\">    initData: function () &#123;</span><br><span class=\"line\">        return &#123;</span><br><span class=\"line\">            name: &apos;San&apos;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">var myApp = new MyApp();</span><br><span class=\"line\">myApp.attach(document.body);</span><br></pre></td></tr></table></figure>\n<p>可以看到，通常情况实用 San 会经过这么几步：</p>\n<ul>\n<li>我们先定义了一个 San 的组件，在定义时指定了组件的 内容模板 与 初始数据 。</li>\n<li>初始化组件对象</li>\n<li>让组件在相应的地方渲染</li>\n</ul>\n<p>列表渲染(s-for)</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   var MyApp = san.defineComponent(&#123;</span><br><span class=\"line\">    template: &apos;&lt;ul&gt;&lt;li s-for=&quot;item in list&quot;&gt;&#123;&#123;item&#125;&#125;&lt;/li&gt;&lt;/ul&gt;&apos;,</span><br><span class=\"line\"></span><br><span class=\"line\">    attached: function () &#123;</span><br><span class=\"line\">        this.data.set(&apos;list&apos;, [&apos;san&apos;, &apos;er&apos;, &apos;esui&apos;, &apos;etpl&apos;, &apos;esl&apos;]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">var myApp = new MyApp();</span><br><span class=\"line\">myApp.attach(document.body);</span><br></pre></td></tr></table></figure>\n<p>列表渲染(s-if)</p>\n<p>San 的条件判断不是严格的 === false。所以，一切 JavaScript 的假值都会认为条件不成立：0、空字符串、null、undefined、NaN等。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;span s-if=&quot;isOK&quot;&gt;Hello San!&lt;/span&gt;</span><br></pre></td></tr></table></figure>\n<p>s-elif 指令可以给 s-if 增加一个额外条件分支块。s-elif 指令的值可以是任何类型的表达式。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   &lt;span s-if=&quot;isActive&quot;&gt;Active&lt;/span&gt;</span><br><span class=\"line\">&lt;span s-elif=&quot;isOnline&quot;&gt;Pending&lt;/span&gt;</span><br><span class=\"line\">&lt;span s-else&gt;Offline&lt;/span&gt;</span><br></pre></td></tr></table></figure>\n<p>虚拟元素 template ，在渲染时不会包含自身，只会渲染其内容。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template s-if=&quot;num &gt; 10000&quot;&gt;</span><br><span class=\"line\">    &lt;h2&gt;biiig&lt;/h2&gt;</span><br><span class=\"line\">    &lt;p&gt;&#123;&#123;num&#125;&#125;&lt;/p&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br></pre></td></tr></table></figure>\n<h4 id=\"数据的绑定\"><a href=\"#数据的绑定\" class=\"headerlink\" title=\"数据的绑定\"></a>数据的绑定</h4><p>双向绑定({=  =})</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   var MyApp = san.defineComponent(&#123;</span><br><span class=\"line\">    template: &apos;&apos;</span><br><span class=\"line\">        + &apos;&lt;div&gt;&apos;</span><br><span class=\"line\">        +   &apos;&lt;input value=&quot;&#123;= name =&#125;&quot; placeholder=&quot;please input&quot;&gt;&apos;</span><br><span class=\"line\">        +   &apos;Hello &#123;&#123;name&#125;&#125;!&apos;</span><br><span class=\"line\">        + &apos;&lt;/div&gt;&apos;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">var myApp = new MyApp();</span><br><span class=\"line\">myApp.attach(document.body);</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;input type=&quot;text&quot; value=&quot;&#123;= name =&#125;&quot;&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;select value=&quot;&#123;= online =&#125;&quot;&gt;</span><br><span class=\"line\">    &lt;option value=&quot;errorrik&quot;&gt;errorrik&lt;/option&gt;</span><br><span class=\"line\">    &lt;option value=&quot;otakustay&quot;&gt;otakustay&lt;/option&gt;</span><br><span class=\"line\">    &lt;option value=&quot;firede&quot;&gt;firede&lt;/option&gt;</span><br><span class=\"line\">&lt;/select&gt;</span><br></pre></td></tr></table></figure>\n<p>属性绑定</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;ui-label text=&quot;&#123;&#123;jokeName&#125;&#125;&quot;&gt;&lt;/ui-label&gt;</span><br></pre></td></tr></table></figure>\n<p>输出原封不动的 HTML，不希望经过 HTML 转义。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   &lt;p s-html=&quot;rawHTML&quot;&gt;&lt;/p&gt;    //通过指令 s-html</span><br><span class=\"line\">&lt;p&gt;&#123;&#123;rawHTML | raw&#125;&#125;&lt;/p&gt;\t//通过过滤器raw</span><br></pre></td></tr></table></figure>\n<h4 id=\"数据的操作\"><a href=\"#数据的操作\" class=\"headerlink\" title=\"数据的操作\"></a>数据的操作</h4><hr>\n<p>initData 方法：可以在定义组件时指定组件初始化时的数据。initData 方法返回组件实例的初始化数据。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   san.defineComponent(&#123;</span><br><span class=\"line\">    initData: function () &#123;</span><br><span class=\"line\">        return &#123;</span><br><span class=\"line\">            width: 200,</span><br><span class=\"line\">            top: 100,</span><br><span class=\"line\">            left: -1000</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>set 方法：是最常用的操作数据的方法，作用相当于 JavaScript 中的赋值 (=)。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   san.defineComponent(&#123;</span><br><span class=\"line\">    attached: function () &#123;</span><br><span class=\"line\">        requestUser().then(this.userReceived.bind(this));</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    userReceived: function (data) &#123;</span><br><span class=\"line\">        this.data.set(&apos;user&apos;, data);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    changeEmail: function (email) &#123;</span><br><span class=\"line\">        this.data.set(&apos;user.email&apos;, email);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>merge 方法：将目标数据对象（target）和传入数据对象（source）的键进行合并。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   san.defineComponent(&#123;</span><br><span class=\"line\">    attached: function () &#123;</span><br><span class=\"line\">        requestUser().then(this.updateUserInfo.bind(this));</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    updateUserInfo: function (data) &#123;</span><br><span class=\"line\">        this.data.merge(&apos;user&apos;, data);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>apply 方法：接受一个函数作为参数，传入当前的值到函数，然后用新返回的值更新它。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   san.defineComponent(&#123;</span><br><span class=\"line\">    attached: function () &#123;</span><br><span class=\"line\">        this.data.set(&apos;number&apos;, &#123;</span><br><span class=\"line\">            value: 1</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        this.updateNumber();</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    updateNumber: function (data) &#123;</span><br><span class=\"line\">        this.data.apply(&apos;number&apos;, function (number) &#123;</span><br><span class=\"line\">            return &#123;</span><br><span class=\"line\">                value: number.value * 2</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>还有一些数组方法：</p>\n<p>修改数组项还是直接使用 set 方法。</p>\n<p>push：在数组末尾插入一条数据。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   san.defineComponent(&#123;</span><br><span class=\"line\">    addUser: function (name) &#123;</span><br><span class=\"line\">        this.data.push(&apos;users&apos;, &#123;name: name&#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>pop：在数组末尾弹出一条数据。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   san.defineComponent(&#123;</span><br><span class=\"line\">    rmLast: function () &#123;</span><br><span class=\"line\">        this.data.pop(&apos;users&apos;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>unshift：在数组开始插入一条数据。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   san.defineComponent(&#123;</span><br><span class=\"line\">    addUser: function (name) &#123;</span><br><span class=\"line\">        this.data.unshift(&apos;users&apos;, &#123;name: name&#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>shift：在数组开始弹出一条数据。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   san.defineComponent(&#123;</span><br><span class=\"line\">    rmFirst: function () &#123;</span><br><span class=\"line\">        this.data.shift(&apos;users&apos;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>remove：移除一条数据。只有当数组项与传入项完全相等(===)时，数组项才会被移除。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   san.defineComponent(&#123;</span><br><span class=\"line\">    rm: function (user) &#123;</span><br><span class=\"line\">        this.data.remove(&apos;users&apos;, user);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>removeAt：通过数据项的索引移除一条数据。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   san.defineComponent(&#123;</span><br><span class=\"line\">    rmAt: function (index) &#123;</span><br><span class=\"line\">        this.data.removeAt(&apos;users&apos;, index);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>splice：向数组中添加或删除项目。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   san.defineComponent(&#123;</span><br><span class=\"line\">    rm: function (index, deleteCount) &#123;</span><br><span class=\"line\">        this.data.splice(&apos;users&apos;, [index, deleteCount]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h4 id=\"数据的校验\"><a href=\"#数据的校验\" class=\"headerlink\" title=\"数据的校验\"></a>数据的校验</h4><hr>\n<p>指定校验规则，需要使用 DataTypes 进行声明：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   import san, &#123;DataTypes&#125; from &apos;san&apos;;</span><br><span class=\"line\"></span><br><span class=\"line\">let MyComponent = san.defineComponent(&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    dataTypes: &#123;</span><br><span class=\"line\">        name: DataTypes.string</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n"},{"layout":"post","title":"San学习笔记 二","subtitle":"事件处理及表单提交","date":"2018-01-05T16:00:00.000Z","author":"Ai Shuangying","header-img":"hack.jpeg","cdn":"header-on","_content":"\n\n最近关注了一个极简MVVM框架San，翻了一遍San的文档，做些笔记。\n[中文文档](https://ecomfe.github.io/san/tutorial/start/)\n\n----------\n\n### 事件处理\n-------------\n\n通过 on- 前缀，可以将事件的处理绑定到组件的方法上，无论是 DOM 事件还是组件的自定义事件，都通过 on- 前缀绑定，没有语法区分。\n\non- + 事件名 将 DOM 元素的事件绑定到组件方法上。当 DOM 事件触发时，组件方法将被调用，this 指向组件实例。\n\n```\n    san.defineComponent({\n\t    template: '\n\t    \t<ul>\n\t\t\t    <li s-for=\"item, index in todos\">\n\t\t\t        <h3>{{ item.title }}</h3>\n\t\t\t        <p>{{ item.desc }}</p>\n\t\t\t        <i class=\"fa fa-trash-o\" on-click=\"rmTodo(item)\"></i>\n\t\t\t    </li>\n\t\t\t</ul>',\n\n\t    rmTodo: function (todo) {\n\t        service.rmTodo(todo.id);\n\t        this.data.remove('todos', todo);\n\t    }\n\t});\n```\n\n$event 是 San 保留的一个特殊变量，指定 $event 将引用到 DOM Event 对象。从而你可以拿到事件触发的 DOM 对象、鼠标事件的鼠标位置等事件信息。\n\n```\n\tsan.defineComponent({\n\t    template: '<button type=\"button\" on-click=\"clicker($event)\">click here</button>',\n\n\t    clicker: function (e) {\n\t        alert(e.target.tagName); // BUTTON\n\t    }\n\t});\n```\n\n\n自定义事件的绑定\n\n```\n\t//定义一个Label组件，此组件会通过调用 fire 方法来派发一个事件\n\tvar Label = san.defineComponent({\n\t    template: '<template class=\"ui-label\" title=\"{{text}}\">{{text}}</template>',\n\n\t    attached: function () {\n\t        this.fire('done', this.data.get('text') + ' done');\n\t    }\n\t});\n\n\tvar MyComponent = san.defineComponent({\n    \tcomponents: {\n\t        'ui-label': Label  \t//这里引入自定义组件Label\n\t    },\n\n\t    template: '<div><ui-label bind-text=\"name\" on-done=\"labelDone($event)\"></ui-label></div>',\n\t    //这里绑定了text为字符串name，绑定了done事件\n\n\t    labelDone: function (doneMsg) {\n\t        alert(doneMsg);\t//组件自身的done事件会派发一个事件，发出一个字符串\n\t    }\n\t});\t\n```\n\n\n\n#### 修饰符\n\n在元素的事件声明中使用 capture 修饰符，事件将被绑定到捕获阶段。\n\n```\n    var MyComponent = san.defineComponent({\n\t    template: ''\n\t        + '<div on-click=\"capture:mainClick\">'\n\t            + '<button on-click=\"capture:btnClick\">click</button>'\n\t        + '</div>',\n\n\t    mainClick: function (title) {\n\t        alert('Main');\n\t    },\n\n\t    btnClick: function (title) {\n\t        alert('Button');\n\t    }\n\t});\n\t// 会先触发mainClick事件再触发btnClick事件，因为是按点击事件的捕获顺序执行的\n```\n\n在组件的事件声明中使用 native 修饰符，事件将被绑定到组件根元素的 DOM 事件。\n\n```\n    var Button = san.defineComponent({\n\t    template: '<a class=\"my-button\"><slot/></a>'\n\t});\n\n\tvar MyComponent = san.defineComponent({\n\t    components: {\n\t        'ui-button': Button\n\t    },\n\n\t    template: '<div><ui-button on-click=\"native:clicker(title)\">{{title}}</ui-button></div>',\n\n\t    initData: function () {\n            return {\n                title: 'San'\n            };\n        },\n\n\t    clicker: function (title) {\n\t        alert(title);\n\t    }\n\t});\n\t//点击会显示：San\n```\n\n\n#### 表单\n-------------\n\n输入框的绑定方法比较简单，直接对输入框的 value 属性应用双向绑定就行了。\n\n```\n    <input type=\"text\" value=\"{= name =}\">\n```\n\ncheckbox\n\ncheckbox 常见的使用场景是分组，在组件模板中，我们把需要分组的 checkbox 将 checked 属性双向绑定到同名的组件数据中。\n\n我们期望 checkbox 绑定到的数据项是一个 Array<string> 。当 checkbox 被选中时，其 value 会被添加到绑定的数据项中；当 checkbox 被取消选中时，其 value 会从绑定数据项中移除。\n\n```\n    san.defineComponent({\n\t    template: '<div>\n\t\t    <label><input type=\"checkbox\" on-click=\"chooseone\" value=\"errorrik\" checked=\"{= online =}\">errorrik</label>\n\t\t    <label><input type=\"checkbox\" on-click=\"chooseone\" value=\"otakustay\" checked=\"{= online =}\">otakustay</label>\n\t\t    <label><input type=\"checkbox\" on-click=\"chooseone\" value=\"firede\" checked=\"{= online =}\">firede</label>\n\t\t</div>',\n\n\t    initData: function () {\n\t        return {\n\t            online: []\n\t        };\n\t    },\n\n\t    chooseone: function () {\n            console.log(this.data.get('online'));\n        },\n\n\t    attached: function () {\n\t        this.data.set('online', ['errorrik', 'otakustay']);\n\t    }\n\t});\n```\n\nradio\n\n与 checkbox 类似，我们在组件模板中，把需要分组的 radio 将 checked 属性绑定到同名的组件数据中。\n\n你需要手工指定分组 radio 的 name 属性，使浏览器能处理 radio 选择的互斥。可以把它设置成与绑定数据的名称相同。\n\n我们期望 radio 绑定到的数据项是一个 string 。当 radio 被选中时，绑定的数据项值被设置成选中的 radio 的 value 属性值。\n\n```\n    san.defineComponent({\n\t    template: '<div>\n\t\t    <label><input type=\"radio\" on-click=\"chooseone\" value=\"errorrik\"  checked=\"{= online =}\" name=\"online\">errorrik</label>\n\t\t    <label><input type=\"radio\" on-click=\"chooseone\" value=\"otakustay\" checked=\"{= online =}\" name=\"online\">otakustay</label>\n\t\t    <label><input type=\"radio\" on-click=\"chooseone\" value=\"firede\"    checked=\"{= online =}\" name=\"online\">firede</label>\n\t\t</div>',\n\n\t    initData: function () {\n\t        return {\n\t            online: 'errorrik'\n\t        };\n\t    },\n\n\t    chooseone: function () {\n            console.log(this.data.get('online'));\n        },\n\t});\n```\n\nselect\n\nselect 的使用方式和输入框类似，直接对 value 属性应用双向绑定。\n\n在浏览器中，select 的 value 属性并不控制其选中项，select 的选中项是由 option 的 selected 属性控制的。考虑到开发的方便，开发者不需要编写 option 的 selected 属性，San 会在下一个视图更新时间片中刷新 select 的选中状态。\n\n```\n    san.defineComponent({\n\t    template: '<select value=\"{= online =}\" on-change=\"chooseone\">\n\t\t    <option value=\"errorrik\">errorrik</option>\n\t\t    <option value=\"otakustay\">otakustay</option>\n\t\t    <option value=\"firede\">firede</option>\n\t\t</select>',\n\n\t    initData: function () {\n\t        return {\n\t            online: 'errorrik'\n\t        };\n\t    },\n\n\t    chooseone: function () {\n            console.log(this.data.get('online'));\n        },\n\t});\n```","source":"_posts/san2.md","raw":"---\nlayout: post\ntitle: \"San学习笔记 二\"\nsubtitle: \"事件处理及表单提交\"\ndate: 2018-1-6\nauthor: \"Ai Shuangying\"\nheader-img: \"hack.jpeg\"\ncdn: 'header-on'\ntags: \n    - San\n---\n\n\n最近关注了一个极简MVVM框架San，翻了一遍San的文档，做些笔记。\n[中文文档](https://ecomfe.github.io/san/tutorial/start/)\n\n----------\n\n### 事件处理\n-------------\n\n通过 on- 前缀，可以将事件的处理绑定到组件的方法上，无论是 DOM 事件还是组件的自定义事件，都通过 on- 前缀绑定，没有语法区分。\n\non- + 事件名 将 DOM 元素的事件绑定到组件方法上。当 DOM 事件触发时，组件方法将被调用，this 指向组件实例。\n\n```\n    san.defineComponent({\n\t    template: '\n\t    \t<ul>\n\t\t\t    <li s-for=\"item, index in todos\">\n\t\t\t        <h3>{{ item.title }}</h3>\n\t\t\t        <p>{{ item.desc }}</p>\n\t\t\t        <i class=\"fa fa-trash-o\" on-click=\"rmTodo(item)\"></i>\n\t\t\t    </li>\n\t\t\t</ul>',\n\n\t    rmTodo: function (todo) {\n\t        service.rmTodo(todo.id);\n\t        this.data.remove('todos', todo);\n\t    }\n\t});\n```\n\n$event 是 San 保留的一个特殊变量，指定 $event 将引用到 DOM Event 对象。从而你可以拿到事件触发的 DOM 对象、鼠标事件的鼠标位置等事件信息。\n\n```\n\tsan.defineComponent({\n\t    template: '<button type=\"button\" on-click=\"clicker($event)\">click here</button>',\n\n\t    clicker: function (e) {\n\t        alert(e.target.tagName); // BUTTON\n\t    }\n\t});\n```\n\n\n自定义事件的绑定\n\n```\n\t//定义一个Label组件，此组件会通过调用 fire 方法来派发一个事件\n\tvar Label = san.defineComponent({\n\t    template: '<template class=\"ui-label\" title=\"{{text}}\">{{text}}</template>',\n\n\t    attached: function () {\n\t        this.fire('done', this.data.get('text') + ' done');\n\t    }\n\t});\n\n\tvar MyComponent = san.defineComponent({\n    \tcomponents: {\n\t        'ui-label': Label  \t//这里引入自定义组件Label\n\t    },\n\n\t    template: '<div><ui-label bind-text=\"name\" on-done=\"labelDone($event)\"></ui-label></div>',\n\t    //这里绑定了text为字符串name，绑定了done事件\n\n\t    labelDone: function (doneMsg) {\n\t        alert(doneMsg);\t//组件自身的done事件会派发一个事件，发出一个字符串\n\t    }\n\t});\t\n```\n\n\n\n#### 修饰符\n\n在元素的事件声明中使用 capture 修饰符，事件将被绑定到捕获阶段。\n\n```\n    var MyComponent = san.defineComponent({\n\t    template: ''\n\t        + '<div on-click=\"capture:mainClick\">'\n\t            + '<button on-click=\"capture:btnClick\">click</button>'\n\t        + '</div>',\n\n\t    mainClick: function (title) {\n\t        alert('Main');\n\t    },\n\n\t    btnClick: function (title) {\n\t        alert('Button');\n\t    }\n\t});\n\t// 会先触发mainClick事件再触发btnClick事件，因为是按点击事件的捕获顺序执行的\n```\n\n在组件的事件声明中使用 native 修饰符，事件将被绑定到组件根元素的 DOM 事件。\n\n```\n    var Button = san.defineComponent({\n\t    template: '<a class=\"my-button\"><slot/></a>'\n\t});\n\n\tvar MyComponent = san.defineComponent({\n\t    components: {\n\t        'ui-button': Button\n\t    },\n\n\t    template: '<div><ui-button on-click=\"native:clicker(title)\">{{title}}</ui-button></div>',\n\n\t    initData: function () {\n            return {\n                title: 'San'\n            };\n        },\n\n\t    clicker: function (title) {\n\t        alert(title);\n\t    }\n\t});\n\t//点击会显示：San\n```\n\n\n#### 表单\n-------------\n\n输入框的绑定方法比较简单，直接对输入框的 value 属性应用双向绑定就行了。\n\n```\n    <input type=\"text\" value=\"{= name =}\">\n```\n\ncheckbox\n\ncheckbox 常见的使用场景是分组，在组件模板中，我们把需要分组的 checkbox 将 checked 属性双向绑定到同名的组件数据中。\n\n我们期望 checkbox 绑定到的数据项是一个 Array<string> 。当 checkbox 被选中时，其 value 会被添加到绑定的数据项中；当 checkbox 被取消选中时，其 value 会从绑定数据项中移除。\n\n```\n    san.defineComponent({\n\t    template: '<div>\n\t\t    <label><input type=\"checkbox\" on-click=\"chooseone\" value=\"errorrik\" checked=\"{= online =}\">errorrik</label>\n\t\t    <label><input type=\"checkbox\" on-click=\"chooseone\" value=\"otakustay\" checked=\"{= online =}\">otakustay</label>\n\t\t    <label><input type=\"checkbox\" on-click=\"chooseone\" value=\"firede\" checked=\"{= online =}\">firede</label>\n\t\t</div>',\n\n\t    initData: function () {\n\t        return {\n\t            online: []\n\t        };\n\t    },\n\n\t    chooseone: function () {\n            console.log(this.data.get('online'));\n        },\n\n\t    attached: function () {\n\t        this.data.set('online', ['errorrik', 'otakustay']);\n\t    }\n\t});\n```\n\nradio\n\n与 checkbox 类似，我们在组件模板中，把需要分组的 radio 将 checked 属性绑定到同名的组件数据中。\n\n你需要手工指定分组 radio 的 name 属性，使浏览器能处理 radio 选择的互斥。可以把它设置成与绑定数据的名称相同。\n\n我们期望 radio 绑定到的数据项是一个 string 。当 radio 被选中时，绑定的数据项值被设置成选中的 radio 的 value 属性值。\n\n```\n    san.defineComponent({\n\t    template: '<div>\n\t\t    <label><input type=\"radio\" on-click=\"chooseone\" value=\"errorrik\"  checked=\"{= online =}\" name=\"online\">errorrik</label>\n\t\t    <label><input type=\"radio\" on-click=\"chooseone\" value=\"otakustay\" checked=\"{= online =}\" name=\"online\">otakustay</label>\n\t\t    <label><input type=\"radio\" on-click=\"chooseone\" value=\"firede\"    checked=\"{= online =}\" name=\"online\">firede</label>\n\t\t</div>',\n\n\t    initData: function () {\n\t        return {\n\t            online: 'errorrik'\n\t        };\n\t    },\n\n\t    chooseone: function () {\n            console.log(this.data.get('online'));\n        },\n\t});\n```\n\nselect\n\nselect 的使用方式和输入框类似，直接对 value 属性应用双向绑定。\n\n在浏览器中，select 的 value 属性并不控制其选中项，select 的选中项是由 option 的 selected 属性控制的。考虑到开发的方便，开发者不需要编写 option 的 selected 属性，San 会在下一个视图更新时间片中刷新 select 的选中状态。\n\n```\n    san.defineComponent({\n\t    template: '<select value=\"{= online =}\" on-change=\"chooseone\">\n\t\t    <option value=\"errorrik\">errorrik</option>\n\t\t    <option value=\"otakustay\">otakustay</option>\n\t\t    <option value=\"firede\">firede</option>\n\t\t</select>',\n\n\t    initData: function () {\n\t        return {\n\t            online: 'errorrik'\n\t        };\n\t    },\n\n\t    chooseone: function () {\n            console.log(this.data.get('online'));\n        },\n\t});\n```","slug":"san2","published":1,"updated":"2018-01-28T08:57:07.472Z","comments":1,"photos":[],"link":"","_id":"cjcyjzpeb0000d6gvjtp49f4r","content":"<p>最近关注了一个极简MVVM框架San，翻了一遍San的文档，做些笔记。<br><a href=\"https://ecomfe.github.io/san/tutorial/start/\" target=\"_blank\" rel=\"noopener\">中文文档</a></p>\n<hr>\n<h3 id=\"事件处理\"><a href=\"#事件处理\" class=\"headerlink\" title=\"事件处理\"></a>事件处理</h3><hr>\n<p>通过 on- 前缀，可以将事件的处理绑定到组件的方法上，无论是 DOM 事件还是组件的自定义事件，都通过 on- 前缀绑定，没有语法区分。</p>\n<p>on- + 事件名 将 DOM 元素的事件绑定到组件方法上。当 DOM 事件触发时，组件方法将被调用，this 指向组件实例。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   san.defineComponent(&#123;</span><br><span class=\"line\">    template: &apos;</span><br><span class=\"line\">    \t&lt;ul&gt;</span><br><span class=\"line\">\t\t    &lt;li s-for=&quot;item, index in todos&quot;&gt;</span><br><span class=\"line\">\t\t        &lt;h3&gt;&#123;&#123; item.title &#125;&#125;&lt;/h3&gt;</span><br><span class=\"line\">\t\t        &lt;p&gt;&#123;&#123; item.desc &#125;&#125;&lt;/p&gt;</span><br><span class=\"line\">\t\t        &lt;i class=&quot;fa fa-trash-o&quot; on-click=&quot;rmTodo(item)&quot;&gt;&lt;/i&gt;</span><br><span class=\"line\">\t\t    &lt;/li&gt;</span><br><span class=\"line\">\t\t&lt;/ul&gt;&apos;,</span><br><span class=\"line\"></span><br><span class=\"line\">    rmTodo: function (todo) &#123;</span><br><span class=\"line\">        service.rmTodo(todo.id);</span><br><span class=\"line\">        this.data.remove(&apos;todos&apos;, todo);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>$event 是 San 保留的一个特殊变量，指定 $event 将引用到 DOM Event 对象。从而你可以拿到事件触发的 DOM 对象、鼠标事件的鼠标位置等事件信息。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">san.defineComponent(&#123;</span><br><span class=\"line\">    template: &apos;&lt;button type=&quot;button&quot; on-click=&quot;clicker($event)&quot;&gt;click here&lt;/button&gt;&apos;,</span><br><span class=\"line\"></span><br><span class=\"line\">    clicker: function (e) &#123;</span><br><span class=\"line\">        alert(e.target.tagName); // BUTTON</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>自定义事件的绑定</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//定义一个Label组件，此组件会通过调用 fire 方法来派发一个事件</span><br><span class=\"line\">var Label = san.defineComponent(&#123;</span><br><span class=\"line\">    template: &apos;&lt;template class=&quot;ui-label&quot; title=&quot;&#123;&#123;text&#125;&#125;&quot;&gt;&#123;&#123;text&#125;&#125;&lt;/template&gt;&apos;,</span><br><span class=\"line\"></span><br><span class=\"line\">    attached: function () &#123;</span><br><span class=\"line\">        this.fire(&apos;done&apos;, this.data.get(&apos;text&apos;) + &apos; done&apos;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">var MyComponent = san.defineComponent(&#123;</span><br><span class=\"line\">   \tcomponents: &#123;</span><br><span class=\"line\">        &apos;ui-label&apos;: Label  \t//这里引入自定义组件Label</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    template: &apos;&lt;div&gt;&lt;ui-label bind-text=&quot;name&quot; on-done=&quot;labelDone($event)&quot;&gt;&lt;/ui-label&gt;&lt;/div&gt;&apos;,</span><br><span class=\"line\">    //这里绑定了text为字符串name，绑定了done事件</span><br><span class=\"line\"></span><br><span class=\"line\">    labelDone: function (doneMsg) &#123;</span><br><span class=\"line\">        alert(doneMsg);\t//组件自身的done事件会派发一个事件，发出一个字符串</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h4 id=\"修饰符\"><a href=\"#修饰符\" class=\"headerlink\" title=\"修饰符\"></a>修饰符</h4><p>在元素的事件声明中使用 capture 修饰符，事件将被绑定到捕获阶段。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   var MyComponent = san.defineComponent(&#123;</span><br><span class=\"line\">    template: &apos;&apos;</span><br><span class=\"line\">        + &apos;&lt;div on-click=&quot;capture:mainClick&quot;&gt;&apos;</span><br><span class=\"line\">            + &apos;&lt;button on-click=&quot;capture:btnClick&quot;&gt;click&lt;/button&gt;&apos;</span><br><span class=\"line\">        + &apos;&lt;/div&gt;&apos;,</span><br><span class=\"line\"></span><br><span class=\"line\">    mainClick: function (title) &#123;</span><br><span class=\"line\">        alert(&apos;Main&apos;);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    btnClick: function (title) &#123;</span><br><span class=\"line\">        alert(&apos;Button&apos;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">// 会先触发mainClick事件再触发btnClick事件，因为是按点击事件的捕获顺序执行的</span><br></pre></td></tr></table></figure>\n<p>在组件的事件声明中使用 native 修饰符，事件将被绑定到组件根元素的 DOM 事件。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   var Button = san.defineComponent(&#123;</span><br><span class=\"line\">    template: &apos;&lt;a class=&quot;my-button&quot;&gt;&lt;slot/&gt;&lt;/a&gt;&apos;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">var MyComponent = san.defineComponent(&#123;</span><br><span class=\"line\">    components: &#123;</span><br><span class=\"line\">        &apos;ui-button&apos;: Button</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    template: &apos;&lt;div&gt;&lt;ui-button on-click=&quot;native:clicker(title)&quot;&gt;&#123;&#123;title&#125;&#125;&lt;/ui-button&gt;&lt;/div&gt;&apos;,</span><br><span class=\"line\"></span><br><span class=\"line\">    initData: function () &#123;</span><br><span class=\"line\">           return &#123;</span><br><span class=\"line\">               title: &apos;San&apos;</span><br><span class=\"line\">           &#125;;</span><br><span class=\"line\">       &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    clicker: function (title) &#123;</span><br><span class=\"line\">        alert(title);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">//点击会显示：San</span><br></pre></td></tr></table></figure>\n<h4 id=\"表单\"><a href=\"#表单\" class=\"headerlink\" title=\"表单\"></a>表单</h4><hr>\n<p>输入框的绑定方法比较简单，直接对输入框的 value 属性应用双向绑定就行了。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;input type=&quot;text&quot; value=&quot;&#123;= name =&#125;&quot;&gt;</span><br></pre></td></tr></table></figure>\n<p>checkbox</p>\n<p>checkbox 常见的使用场景是分组，在组件模板中，我们把需要分组的 checkbox 将 checked 属性双向绑定到同名的组件数据中。</p>\n<p>我们期望 checkbox 绑定到的数据项是一个 Array<string> 。当 checkbox 被选中时，其 value 会被添加到绑定的数据项中；当 checkbox 被取消选中时，其 value 会从绑定数据项中移除。</string></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   san.defineComponent(&#123;</span><br><span class=\"line\">    template: &apos;&lt;div&gt;</span><br><span class=\"line\">\t    &lt;label&gt;&lt;input type=&quot;checkbox&quot; on-click=&quot;chooseone&quot; value=&quot;errorrik&quot; checked=&quot;&#123;= online =&#125;&quot;&gt;errorrik&lt;/label&gt;</span><br><span class=\"line\">\t    &lt;label&gt;&lt;input type=&quot;checkbox&quot; on-click=&quot;chooseone&quot; value=&quot;otakustay&quot; checked=&quot;&#123;= online =&#125;&quot;&gt;otakustay&lt;/label&gt;</span><br><span class=\"line\">\t    &lt;label&gt;&lt;input type=&quot;checkbox&quot; on-click=&quot;chooseone&quot; value=&quot;firede&quot; checked=&quot;&#123;= online =&#125;&quot;&gt;firede&lt;/label&gt;</span><br><span class=\"line\">\t&lt;/div&gt;&apos;,</span><br><span class=\"line\"></span><br><span class=\"line\">    initData: function () &#123;</span><br><span class=\"line\">        return &#123;</span><br><span class=\"line\">            online: []</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    chooseone: function () &#123;</span><br><span class=\"line\">           console.log(this.data.get(&apos;online&apos;));</span><br><span class=\"line\">       &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    attached: function () &#123;</span><br><span class=\"line\">        this.data.set(&apos;online&apos;, [&apos;errorrik&apos;, &apos;otakustay&apos;]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>radio</p>\n<p>与 checkbox 类似，我们在组件模板中，把需要分组的 radio 将 checked 属性绑定到同名的组件数据中。</p>\n<p>你需要手工指定分组 radio 的 name 属性，使浏览器能处理 radio 选择的互斥。可以把它设置成与绑定数据的名称相同。</p>\n<p>我们期望 radio 绑定到的数据项是一个 string 。当 radio 被选中时，绑定的数据项值被设置成选中的 radio 的 value 属性值。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   san.defineComponent(&#123;</span><br><span class=\"line\">    template: &apos;&lt;div&gt;</span><br><span class=\"line\">\t    &lt;label&gt;&lt;input type=&quot;radio&quot; on-click=&quot;chooseone&quot; value=&quot;errorrik&quot;  checked=&quot;&#123;= online =&#125;&quot; name=&quot;online&quot;&gt;errorrik&lt;/label&gt;</span><br><span class=\"line\">\t    &lt;label&gt;&lt;input type=&quot;radio&quot; on-click=&quot;chooseone&quot; value=&quot;otakustay&quot; checked=&quot;&#123;= online =&#125;&quot; name=&quot;online&quot;&gt;otakustay&lt;/label&gt;</span><br><span class=\"line\">\t    &lt;label&gt;&lt;input type=&quot;radio&quot; on-click=&quot;chooseone&quot; value=&quot;firede&quot;    checked=&quot;&#123;= online =&#125;&quot; name=&quot;online&quot;&gt;firede&lt;/label&gt;</span><br><span class=\"line\">\t&lt;/div&gt;&apos;,</span><br><span class=\"line\"></span><br><span class=\"line\">    initData: function () &#123;</span><br><span class=\"line\">        return &#123;</span><br><span class=\"line\">            online: &apos;errorrik&apos;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    chooseone: function () &#123;</span><br><span class=\"line\">           console.log(this.data.get(&apos;online&apos;));</span><br><span class=\"line\">       &#125;,</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>select</p>\n<p>select 的使用方式和输入框类似，直接对 value 属性应用双向绑定。</p>\n<p>在浏览器中，select 的 value 属性并不控制其选中项，select 的选中项是由 option 的 selected 属性控制的。考虑到开发的方便，开发者不需要编写 option 的 selected 属性，San 会在下一个视图更新时间片中刷新 select 的选中状态。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   san.defineComponent(&#123;</span><br><span class=\"line\">    template: &apos;&lt;select value=&quot;&#123;= online =&#125;&quot; on-change=&quot;chooseone&quot;&gt;</span><br><span class=\"line\">\t    &lt;option value=&quot;errorrik&quot;&gt;errorrik&lt;/option&gt;</span><br><span class=\"line\">\t    &lt;option value=&quot;otakustay&quot;&gt;otakustay&lt;/option&gt;</span><br><span class=\"line\">\t    &lt;option value=&quot;firede&quot;&gt;firede&lt;/option&gt;</span><br><span class=\"line\">\t&lt;/select&gt;&apos;,</span><br><span class=\"line\"></span><br><span class=\"line\">    initData: function () &#123;</span><br><span class=\"line\">        return &#123;</span><br><span class=\"line\">            online: &apos;errorrik&apos;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    chooseone: function () &#123;</span><br><span class=\"line\">           console.log(this.data.get(&apos;online&apos;));</span><br><span class=\"line\">       &#125;,</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<p>最近关注了一个极简MVVM框架San，翻了一遍San的文档，做些笔记。<br><a href=\"https://ecomfe.github.io/san/tutorial/start/\" target=\"_blank\" rel=\"noopener\">中文文档</a></p>\n<hr>\n<h3 id=\"事件处理\"><a href=\"#事件处理\" class=\"headerlink\" title=\"事件处理\"></a>事件处理</h3><hr>\n<p>通过 on- 前缀，可以将事件的处理绑定到组件的方法上，无论是 DOM 事件还是组件的自定义事件，都通过 on- 前缀绑定，没有语法区分。</p>\n<p>on- + 事件名 将 DOM 元素的事件绑定到组件方法上。当 DOM 事件触发时，组件方法将被调用，this 指向组件实例。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   san.defineComponent(&#123;</span><br><span class=\"line\">    template: &apos;</span><br><span class=\"line\">    \t&lt;ul&gt;</span><br><span class=\"line\">\t\t    &lt;li s-for=&quot;item, index in todos&quot;&gt;</span><br><span class=\"line\">\t\t        &lt;h3&gt;&#123;&#123; item.title &#125;&#125;&lt;/h3&gt;</span><br><span class=\"line\">\t\t        &lt;p&gt;&#123;&#123; item.desc &#125;&#125;&lt;/p&gt;</span><br><span class=\"line\">\t\t        &lt;i class=&quot;fa fa-trash-o&quot; on-click=&quot;rmTodo(item)&quot;&gt;&lt;/i&gt;</span><br><span class=\"line\">\t\t    &lt;/li&gt;</span><br><span class=\"line\">\t\t&lt;/ul&gt;&apos;,</span><br><span class=\"line\"></span><br><span class=\"line\">    rmTodo: function (todo) &#123;</span><br><span class=\"line\">        service.rmTodo(todo.id);</span><br><span class=\"line\">        this.data.remove(&apos;todos&apos;, todo);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>$event 是 San 保留的一个特殊变量，指定 $event 将引用到 DOM Event 对象。从而你可以拿到事件触发的 DOM 对象、鼠标事件的鼠标位置等事件信息。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">san.defineComponent(&#123;</span><br><span class=\"line\">    template: &apos;&lt;button type=&quot;button&quot; on-click=&quot;clicker($event)&quot;&gt;click here&lt;/button&gt;&apos;,</span><br><span class=\"line\"></span><br><span class=\"line\">    clicker: function (e) &#123;</span><br><span class=\"line\">        alert(e.target.tagName); // BUTTON</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>自定义事件的绑定</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//定义一个Label组件，此组件会通过调用 fire 方法来派发一个事件</span><br><span class=\"line\">var Label = san.defineComponent(&#123;</span><br><span class=\"line\">    template: &apos;&lt;template class=&quot;ui-label&quot; title=&quot;&#123;&#123;text&#125;&#125;&quot;&gt;&#123;&#123;text&#125;&#125;&lt;/template&gt;&apos;,</span><br><span class=\"line\"></span><br><span class=\"line\">    attached: function () &#123;</span><br><span class=\"line\">        this.fire(&apos;done&apos;, this.data.get(&apos;text&apos;) + &apos; done&apos;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">var MyComponent = san.defineComponent(&#123;</span><br><span class=\"line\">   \tcomponents: &#123;</span><br><span class=\"line\">        &apos;ui-label&apos;: Label  \t//这里引入自定义组件Label</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    template: &apos;&lt;div&gt;&lt;ui-label bind-text=&quot;name&quot; on-done=&quot;labelDone($event)&quot;&gt;&lt;/ui-label&gt;&lt;/div&gt;&apos;,</span><br><span class=\"line\">    //这里绑定了text为字符串name，绑定了done事件</span><br><span class=\"line\"></span><br><span class=\"line\">    labelDone: function (doneMsg) &#123;</span><br><span class=\"line\">        alert(doneMsg);\t//组件自身的done事件会派发一个事件，发出一个字符串</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h4 id=\"修饰符\"><a href=\"#修饰符\" class=\"headerlink\" title=\"修饰符\"></a>修饰符</h4><p>在元素的事件声明中使用 capture 修饰符，事件将被绑定到捕获阶段。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   var MyComponent = san.defineComponent(&#123;</span><br><span class=\"line\">    template: &apos;&apos;</span><br><span class=\"line\">        + &apos;&lt;div on-click=&quot;capture:mainClick&quot;&gt;&apos;</span><br><span class=\"line\">            + &apos;&lt;button on-click=&quot;capture:btnClick&quot;&gt;click&lt;/button&gt;&apos;</span><br><span class=\"line\">        + &apos;&lt;/div&gt;&apos;,</span><br><span class=\"line\"></span><br><span class=\"line\">    mainClick: function (title) &#123;</span><br><span class=\"line\">        alert(&apos;Main&apos;);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    btnClick: function (title) &#123;</span><br><span class=\"line\">        alert(&apos;Button&apos;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">// 会先触发mainClick事件再触发btnClick事件，因为是按点击事件的捕获顺序执行的</span><br></pre></td></tr></table></figure>\n<p>在组件的事件声明中使用 native 修饰符，事件将被绑定到组件根元素的 DOM 事件。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   var Button = san.defineComponent(&#123;</span><br><span class=\"line\">    template: &apos;&lt;a class=&quot;my-button&quot;&gt;&lt;slot/&gt;&lt;/a&gt;&apos;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">var MyComponent = san.defineComponent(&#123;</span><br><span class=\"line\">    components: &#123;</span><br><span class=\"line\">        &apos;ui-button&apos;: Button</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    template: &apos;&lt;div&gt;&lt;ui-button on-click=&quot;native:clicker(title)&quot;&gt;&#123;&#123;title&#125;&#125;&lt;/ui-button&gt;&lt;/div&gt;&apos;,</span><br><span class=\"line\"></span><br><span class=\"line\">    initData: function () &#123;</span><br><span class=\"line\">           return &#123;</span><br><span class=\"line\">               title: &apos;San&apos;</span><br><span class=\"line\">           &#125;;</span><br><span class=\"line\">       &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    clicker: function (title) &#123;</span><br><span class=\"line\">        alert(title);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\">//点击会显示：San</span><br></pre></td></tr></table></figure>\n<h4 id=\"表单\"><a href=\"#表单\" class=\"headerlink\" title=\"表单\"></a>表单</h4><hr>\n<p>输入框的绑定方法比较简单，直接对输入框的 value 属性应用双向绑定就行了。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;input type=&quot;text&quot; value=&quot;&#123;= name =&#125;&quot;&gt;</span><br></pre></td></tr></table></figure>\n<p>checkbox</p>\n<p>checkbox 常见的使用场景是分组，在组件模板中，我们把需要分组的 checkbox 将 checked 属性双向绑定到同名的组件数据中。</p>\n<p>我们期望 checkbox 绑定到的数据项是一个 Array<string> 。当 checkbox 被选中时，其 value 会被添加到绑定的数据项中；当 checkbox 被取消选中时，其 value 会从绑定数据项中移除。</string></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   san.defineComponent(&#123;</span><br><span class=\"line\">    template: &apos;&lt;div&gt;</span><br><span class=\"line\">\t    &lt;label&gt;&lt;input type=&quot;checkbox&quot; on-click=&quot;chooseone&quot; value=&quot;errorrik&quot; checked=&quot;&#123;= online =&#125;&quot;&gt;errorrik&lt;/label&gt;</span><br><span class=\"line\">\t    &lt;label&gt;&lt;input type=&quot;checkbox&quot; on-click=&quot;chooseone&quot; value=&quot;otakustay&quot; checked=&quot;&#123;= online =&#125;&quot;&gt;otakustay&lt;/label&gt;</span><br><span class=\"line\">\t    &lt;label&gt;&lt;input type=&quot;checkbox&quot; on-click=&quot;chooseone&quot; value=&quot;firede&quot; checked=&quot;&#123;= online =&#125;&quot;&gt;firede&lt;/label&gt;</span><br><span class=\"line\">\t&lt;/div&gt;&apos;,</span><br><span class=\"line\"></span><br><span class=\"line\">    initData: function () &#123;</span><br><span class=\"line\">        return &#123;</span><br><span class=\"line\">            online: []</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    chooseone: function () &#123;</span><br><span class=\"line\">           console.log(this.data.get(&apos;online&apos;));</span><br><span class=\"line\">       &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    attached: function () &#123;</span><br><span class=\"line\">        this.data.set(&apos;online&apos;, [&apos;errorrik&apos;, &apos;otakustay&apos;]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>radio</p>\n<p>与 checkbox 类似，我们在组件模板中，把需要分组的 radio 将 checked 属性绑定到同名的组件数据中。</p>\n<p>你需要手工指定分组 radio 的 name 属性，使浏览器能处理 radio 选择的互斥。可以把它设置成与绑定数据的名称相同。</p>\n<p>我们期望 radio 绑定到的数据项是一个 string 。当 radio 被选中时，绑定的数据项值被设置成选中的 radio 的 value 属性值。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   san.defineComponent(&#123;</span><br><span class=\"line\">    template: &apos;&lt;div&gt;</span><br><span class=\"line\">\t    &lt;label&gt;&lt;input type=&quot;radio&quot; on-click=&quot;chooseone&quot; value=&quot;errorrik&quot;  checked=&quot;&#123;= online =&#125;&quot; name=&quot;online&quot;&gt;errorrik&lt;/label&gt;</span><br><span class=\"line\">\t    &lt;label&gt;&lt;input type=&quot;radio&quot; on-click=&quot;chooseone&quot; value=&quot;otakustay&quot; checked=&quot;&#123;= online =&#125;&quot; name=&quot;online&quot;&gt;otakustay&lt;/label&gt;</span><br><span class=\"line\">\t    &lt;label&gt;&lt;input type=&quot;radio&quot; on-click=&quot;chooseone&quot; value=&quot;firede&quot;    checked=&quot;&#123;= online =&#125;&quot; name=&quot;online&quot;&gt;firede&lt;/label&gt;</span><br><span class=\"line\">\t&lt;/div&gt;&apos;,</span><br><span class=\"line\"></span><br><span class=\"line\">    initData: function () &#123;</span><br><span class=\"line\">        return &#123;</span><br><span class=\"line\">            online: &apos;errorrik&apos;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    chooseone: function () &#123;</span><br><span class=\"line\">           console.log(this.data.get(&apos;online&apos;));</span><br><span class=\"line\">       &#125;,</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>select</p>\n<p>select 的使用方式和输入框类似，直接对 value 属性应用双向绑定。</p>\n<p>在浏览器中，select 的 value 属性并不控制其选中项，select 的选中项是由 option 的 selected 属性控制的。考虑到开发的方便，开发者不需要编写 option 的 selected 属性，San 会在下一个视图更新时间片中刷新 select 的选中状态。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">   san.defineComponent(&#123;</span><br><span class=\"line\">    template: &apos;&lt;select value=&quot;&#123;= online =&#125;&quot; on-change=&quot;chooseone&quot;&gt;</span><br><span class=\"line\">\t    &lt;option value=&quot;errorrik&quot;&gt;errorrik&lt;/option&gt;</span><br><span class=\"line\">\t    &lt;option value=&quot;otakustay&quot;&gt;otakustay&lt;/option&gt;</span><br><span class=\"line\">\t    &lt;option value=&quot;firede&quot;&gt;firede&lt;/option&gt;</span><br><span class=\"line\">\t&lt;/select&gt;&apos;,</span><br><span class=\"line\"></span><br><span class=\"line\">    initData: function () &#123;</span><br><span class=\"line\">        return &#123;</span><br><span class=\"line\">            online: &apos;errorrik&apos;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">    chooseone: function () &#123;</span><br><span class=\"line\">           console.log(this.data.get(&apos;online&apos;));</span><br><span class=\"line\">       &#125;,</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>"}],"PostAsset":[],"PostCategory":[],"PostTag":[{"post_id":"cjciskgdf0000n3fae346roxm","tag_id":"cjciskgdm0002n3favzfac445","_id":"cjciskgdt0006n3fac19c0vlr"},{"post_id":"cjciskgdk0001n3fa8l72gip3","tag_id":"cjciskgdm0002n3favzfac445","_id":"cjciskgdv0008n3faq9ym548h"},{"post_id":"cjciskgdo0003n3facwxcti62","tag_id":"cjciskgdu0007n3fax0ddmhtr","_id":"cjciskgdw000bn3faqqmhxk3g"},{"post_id":"cjciskgdo0003n3facwxcti62","tag_id":"cjciskgdv0009n3fave3k5fej","_id":"cjciskgdw000cn3fakd7fc4s8"},{"post_id":"cjciskgdq0004n3farkuz5mof","tag_id":"cjciskgdu0007n3fax0ddmhtr","_id":"cjciskgdx000en3faenv2wu01"},{"post_id":"cjciskgdq0004n3farkuz5mof","tag_id":"cjciskgdw000dn3fad6vmco32","_id":"cjciskgdx000fn3fa8rw9v51i"},{"post_id":"cjcvor88n0000jjfalz106v6h","tag_id":"cjcvor88u0001jjfagp3r6ve2","_id":"cjcvor88x0002jjfatkbeagwm"},{"post_id":"cjcyjzpeb0000d6gvjtp49f4r","tag_id":"cjcvor88u0001jjfagp3r6ve2","_id":"cjcyjzpeg0001d6gvzekzhbgx"}],"Tag":[{"name":"LeetCode","_id":"cjciskgdm0002n3favzfac445"},{"name":"Node.js","_id":"cjciskgdu0007n3fax0ddmhtr"},{"name":"Koa","_id":"cjciskgdv0009n3fave3k5fej"},{"name":"MongoDB","_id":"cjciskgdw000dn3fad6vmco32"},{"name":"San","_id":"cjcvor88u0001jjfagp3r6ve2"}]}}